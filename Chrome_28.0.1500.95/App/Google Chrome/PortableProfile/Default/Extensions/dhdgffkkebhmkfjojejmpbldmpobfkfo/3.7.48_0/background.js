var trup=null,init=null,fire=null,lfgs=null,sycl=null,cfgo=null,uris=null,clip=null,dast=null,perm=null,blak=null,scbr=null,D=!1;Registry.require("statistics");Registry.require("convert");Registry.require("xmlhttprequest");Registry.require("cache");Registry.require("storage");Registry.require("uri");Registry.require("compat");Registry.require("parser");Registry.require("helper");Registry.require("syncinfo");Registry.require("notify");Registry.require("i18n");Registry.require("native");
(function(){var na=function(a){D|=60<=a;K.debug(!1);q.debug(D,!1);P.debug(D)},p=Registry.prepare(!0),E=$.Deferred,N=function(a){var b=E();b.resolve(a);return b.promise()},W=function(){var a=E();a.reject();return a.promise()},ga=function(){var a=[],b=!0,c=function(a,b,c){var k={title:a.join("\n\n")};console.warn(a.join("\n"));chrome.browserAction.setIcon(b);chrome.browserAction.setTitle(k);b=function(b,c,f){b={name:"1",sub_menu_item:!0,pos:"left",items:[]};b.items.push({name:a[0],image:"info"});1<
a.length&&b.items.push({name:a[1]});f({items:[b],options:{enabled:!1}})};c||chrome.extension.onMessage.addListener(b)};return{run:function(){try{if(Registry.verify("48").length){var a=["Tampermonkey detected that Chrome is caching some outdated code parts.","In order to avoid unexpected behavior TM will be kept paused until Chrome was restarted."],g={path:chrome.extension.getURL("images/icon_grey_paused.png")};b=!1;c(a,g)}else chrome.extension.inIncognitoContext&&p.RUNTIME.CHROME&&
28>p.RUNTIME.BROWSER_VERSION&&(a=["Tampermonkey detected that it can not work in incognito mode with your browser version.","Please update your browser to version 28 or higher."],g={path:chrome.extension.getURL("images/icon_grey_paused.png")},b=!1,c(a,g))}catch(f){b=!1,console.error(f.message)}"chromeStorage"!=p.DB.USE||p.DB.NO_WARNING||window.setTimeout(function(){q.isWorking().fail(function(){confirm("Tampermonkey detected that your Chrome profile is broken!\n\nUnfortunately all extension data including your settings and userscripts is stored at the profile.\n\nDo you want to visit the FAQ entry that explains how to recover from that?")&&
chrome.tabs.create({url:"http://tampermonkey.net/faq#Q206"},function(){});var a={path:chrome.extension.getURL("images/icon_grey_paused.png")};c(["Tampermonkey detected that your Chrome profile is broken!"],a,!0)})},1E3);return b},pause:c,setWarning:function(b,c,f){a.push({text:b,description:c,url:f})},getWarnings:function(){return a}}}();if(ga.run()){var y=p.WEBREQUEST;D&&console.debug("Starting background fred @"+oa);var A=Registry.get("helper"),Q=Registry.get("cache"),X=Registry.get("statistics"),
q=Registry.get("storage"),P=Registry.get("notify"),R=Registry.get("native"),za=Registry.get("icon");dast=q;var oa=A.createUUID(),S={},pa={};Q.create("requires").setOptions({timeout:1800,check_interval:300}).init();Q.create("resources").setOptions({timeout:1800,check_interval:300}).init();Q.create("rundata").setOptions({timeout:180,check_interval:120,retimeout_on_get:!0}).init();var T=function(a,b){for(var c=function(a){return a?A.filter(a.replace(/-/g,"."),/[\.0-9]/g):""},d=c(a),c=c(b),d=d.split("."),
c=c.split("."),g=d.length<c.length?d.length:c.length,f=0;f<g;f++){d.length<g&&(d[f]=0);c.length<g&&(c[f]=0);if(Number(d[f])>Number(c[f]))return 1;if(Number(d[f])<Number(c[f]))return-1}return c.length<d.length?1:0};chrome.extension.manifest=function(){var a=chrome.extension.getURL("manifest.json"),b;try{if(a&&-1!=a.search("{"))b=JSON.parse(a);else{var c=new XMLHttpRequest;c.open("GET",a,!1);c.send(null);b=JSON.parse(c.responseText)}}catch(d){console.log("getVersion"+d.message),b={version:"0.0.0.0",
name:"Tampermonkey"}}return b}();chrome.extension.getVersion=function(){return chrome.extension.manifest.version};chrome.extension.getName=function(){return chrome.extension.manifest.name};chrome.tabs.sendMessageEx=function(a,b,c,d){d=void 0===d?5:d;var g=function(){chrome.tabs.sendMessage(a,b,function(a){if(!a){if(0<d--){window.setTimeout(g,400);return}a={}}c&&c(a)})};g()};var Ba=function(){var a=E(),b=chrome.extension.getVersion(),c=q.getSchemaVersion(),d=c;q.isWiped().then(function(a){a&&(a=["Tampermonkey detected inconsistencies that indicate that Chrome wiped the extension database!",
"You can continue to use Tampermonkey normally, but your settings and scripts might be lost. Click here to get more information.","http://tampermonkey.net/faq.php#Q207"],console.warn(a.join("\n")),ga.setWarning.apply(this,a));return q.getVersion("0.0.0.0")}).always(function(g){var f=1==T(b,g),k=[],m=0,e=function(){if(m<k.length){var b=k[m].schema;k[m].cond(b)?k[m].fn().done(function(){b&&(console.log("Converted database from",d,"to",b),d=b);window.setTimeout(e,p.MISC.TIMEOUT)}).fail(function(){a.reject()}):
window.setTimeout(e,p.MISC.TIMEOUT);m++}},n=function(){console.warn("Incognito mode detected. Database conversion can only be done in non-incognito mode! Stopping now...");var a={path:chrome.extension.getURL("images/icon_grey_paused.png")};ga.pause(["Tampermonkey needs to convert its database but this can't be done in incogonito mode!","Please open a non-incognito mode window and/or restart your browser."],a)},k=[{cond:function(){return f&&"chromeStorage"==p.DB.USE&&!q.getValue(p.CONSTANTS.STORAGE.LEGACY_VERSION)&&
1==T("3.5.3603",g)},fn:function(){var a=E();chrome.extension.inIncognitoContext?(n(),a.reject()):(console.log("Update database..."),d="3.5.3603",q.migrate("sql","chromeStorage").done(function(){console.log("Copied config for default usage of chrome.storage");a.resolve()}));return a.promise()}},{cond:function(){return f&&1==T("3.6.3650",d)&&1==T("3.5.3650",g)},fn:function(){var a=E();if(chrome.extension.inIncognitoContext)n(),a.reject();else{d="3.6.3650";var b=[];[{o:"TM_config",n:p.CONSTANTS.STORAGE.CONFIG},
{o:"TM_update_check",n:p.CONSTANTS.STORAGE.UPDATE},{o:"TM_version"},{o:"TM_unload_ts"}].forEach(function(a){if(a.n){var c=q.getValue(a.o);void 0!==c&&b.push(q.setValue(a.n,c))}b.push(q.deleteValue(a.o))});var c=/@re$/,f=[];q.listValues().forEach(function(a){-1!=a.search(c)&&(a=a.replace(c,""),f.push(a))});f.forEach(function(a){var c=q.getValue(a+"@st"),f=q.getValue(a),g=q.getValue(a+"@re"),d=q.getValue(a+"@source"),k=w.getUidByName(a)||A.createUUID();b.push(q.deleteValue(a+"@st"));b.push(q.deleteValue(a));
b.push(q.deleteValue(a+"@re"));b.push(q.deleteValue(a+"@source"));f&&g&&d?(b.push(q.setValue(p.CONSTANTS.PREFIX.SCRIPT_UID+k,a)),b.push(q.setValue(p.CONSTANTS.PREFIX.COND+k,g)),b.push(q.setValue(p.CONSTANTS.PREFIX.STORE+k,c)),b.push(q.setValue(p.CONSTANTS.PREFIX.SCRIPT+k,d)),b.push(q.setValue(p.CONSTANTS.PREFIX.META+k,f))):console.warn("invalid script entry",{source:d,meta:f,cond:g})});c=/@st$/;q.listValues().forEach(function(a){-1!=a.search(c)&&b.push(q.deleteValue(a))});$.when.apply($,b).done(function(){console.log("Converted database from",
g,"to",d);a.resolve()})}return a.promise()}},{schema:"3.7.0",cond:function(a){return 1==T(a,d)},fn:function(){var a=E();if(chrome.extension.inIncognitoContext)n(),a.reject();else{var b=[],c=RegExp("^"+p.CONSTANTS.PREFIX.META);q.listValues().forEach(function(a){if(-1!=a.search(c)){var f=q.getValue(a);f.options&&f.options.override&&!f.options.override.orig_run_at&&(f.options.override.orig_run_at=f.options.run_at||"document-end",f.options.run_at=null,b.push(q.setValue(a,f)))}});$.when.apply($,b).done(function(){a.resolve()})}return a.promise()}},
{schema:"4010",cond:function(a){return 1==T(a,d)},fn:function(){var a=E();chrome.extension.inIncognitoContext?(n(),a.reject()):a.resolve();return a.promise()}},{cond:function(){return f||1==T(d,c)},fn:function(){var a=E();q.setVersion(b,d).done(function(){a.resolve()});return a.promise()}},{cond:function(){return f},fn:function(){console.log("First run of version "+b+"!");Aa.scheduleNotification(g,"0.0.0.0"==g);return N()}},{cond:function(){return!0},fn:function(){var b=E();a.resolve();window.setTimeout(b.resolve,
p.MISC.TIMEOUT);return b.promise()}}];e()});return a.promise()},qa=function(){var a={get:function(a,c){var d=(0==a)+"#"+c,g=Q.items.rundata.getj(d);if(g)g.oldret.user_agent[a]=g.oldret.user_agent[g.frameId],g=g.oldret;else{for(var g=v.determineScriptsToRun(c),f=[],k=0,m={},e={},n=0;n<g.length;n++){var h=g[n];if(!h.enabled)k++;else if(0==a||!0!==h.options.noframes&&(null!==h.options.noframes||!0!==h.options.override.orig_noframes))h.options.user_agent&&""!=h.options.user_agent&&(e[a]=h.options.user_agent),
m[h.name]=!0,f.push(h)}g={runners:f,disabled:k,script_map:m,user_agent:e};Q.items.rundata.setj(d,{frameId:a,oldret:g})}return g},getUserAgent:function(b,c){return a.get(b,c).user_agent}};return a}(),t=function(){var a={},b=1,c=b++,d=b++,g=b++,f=b++,k=b++,m=b++,e=b++,n=b++,H=b++;b++;var u=function(){var a={frames:{0:{state:c}},tabs:{reset_ts:(new Date).getTime()},scripts:{},urls:{},maps:{},contexts:{onUnload:{}},stats:{running:0,disabled:0},extra:{}};Object.defineProperties(a.urls,{length:{value:0,
enumerable:!1,writable:!0,configurable:!0}});return a},r={_info:function(){return a},listeners:{_onReset:[],_onCommited:[],_onCompleted:[],add:{onReset:function(a){r.listeners._onReset.push(a);return r.listeners._onReset.length-1},onCommited:function(a){r.listeners._onCommited.push(a);return r.listeners._onCommited.length-1},onCompleted:function(a){r.listeners._onCompleted.push(a);return r.listeners._onCompleted.length-1}},remove:{onReset:function(a){r.listeners._onReset[a]=null},onCommited:function(a){r.listeners._onCommited[a]=
null},onCompleted:function(a){r.listeners._onCompleted[a]=null}}},events:{reset:function(b,f){a[b]=u();a[b].frames[0].state=c;A.each(r.listeners._onReset,function(a,c){a&&a(b,f)})},request:function(b,c,f){h.values.enabled&&(a[b]=a[b]||u(),a[b].frames[c]=a[b].frames[c]||{},a[b].frames[c].state=d,f=B.woHash(f),f=qa.getUserAgent(c,f),f[c]&&r.set.extra(b,c,"user_agent",f[c]))},response:function(b,f,d){if(h.values.enabled){a[b]=a[b]||u();a[b].frames[f]=a[b].frames[f]||{};var k=a[b].frames[f].state||c;
a[b].frames[f].state=g;0===f&&(a[b].tabs.response_ts=(new Date).getTime());k<g&&(d=B.woHash(d),r.scripts.determine(b,f,d))}},commited:function(b,d,k){if(h.values.enabled){var m=B.parse(k);if("http:"===m.protocol||"https:"===m.protocol||"file:"===m.protocol)a[b]=a[b]||u(),a[b].frames[d]=a[b].frames[d]||{},m=a[b].frames[d].state||c,a[b].frames[d].state=f,m<g&&(k=B.woHash(k),r.scripts.determine(b,d,k)),A.each(r.listeners._onCommited,function(a,c){a&&a(b)})}},loading:function(b,f,d){if(h.values.enabled){var m=
B.parse(d);"http:"!==m.protocol&&"https:"!==m.protocol&&"file:"!==m.protocol||0!==f||"file:"!==m.protocol||(a[b]=a[b]||u(),a[b].frames[f]=a[b].frames[f]||{},m=a[b].frames[f].state||c,a[b].frames[f].state=k,m<g&&(d=B.woHash(d),r.scripts.determine(b,f,d)))}},prepare:function(b,f,c,g){if(h.values.enabled){var d=0===f?f:c;a[b]=a[b]||u();a[b].frames[d]=a[b].frames[d]||{};g=B.woHash(g);a[b].frames[d].state=m;d=a[b].scripts[g];d||(r.scripts.determine(b,f,g),d=a[b].scripts[g]);f=d.runners.length;r.scripts.updateMaps(b,
c,d.script_map);r.scripts.updateUrls(b,c,g);return f}},run:function(b,f,c,g,d){if(h.values.enabled){var k=0===f?f:c;a[b]=a[b]||u();a[b].frames[k]=a[b].frames[k]||{};a[b].frames[k].state=e;var m=B.woHash(g);if(g=a[b].scripts[m])r.scripts.updateStats(b,c,g.runners.length,g.disabled),r.scripts.run(b,f,c,m,g.runners,function(){delete a[b].scripts[m];d&&d()});else{var n;D&&(n=a[b].scripts);console.warn("tv: no script run info for tab "+b+" @ "+m,n)}}},complete:function(b,f,g){g=B.parse(g);if(h.values.enabled&&
("http:"===g.protocol||"https:"===g.protocol||"file:"===g.protocol)){if(0===f){a[b]=a[b]||u();a[b].frames[f]=a[b].frames[f]||{};var d=a[b].frames[f].state||c;a[b].frames[f].state=n;if(!t.get.empty(b)&&t.get.stats(b).running){if(d<e){console.warn("tv: no script run info!");return}"file:"===g.protocol?window.setTimeout(function(){chrome.tabs.sendMessage(b,{method:"onLoad",frameId:f},function(a){})},500):(chrome.tabs.sendMessage(b,{method:"onLoad",frameId:f},function(a){}),L.runCheck&&chrome.contentSettings.javascript.clear({}))}}A.each(r.listeners._onCompleted,
function(a,f){a&&a(b)})}},unload:function(b,f,c){f=0===f?f:c;a[b]=a[b]||u();a[b].frames[f]=a[b].frames[f]||{};a[b].frames[f].state=H;if(a[b]&&a[b].contexts.onUnload[c]){for(f=0;f<a[b].contexts.onUnload[c].length;f++)a[b].contexts.onUnload[c][f]();a[b].contexts.onUnload[c]=[]}},remove:function(b){delete a[b]}},scripts:{updateStats:function(b,f,c,g){a[b].stats.running+=c;a[b].stats.disabled+=g;a[b].contexts.onUnload[f]=a[b].contexts.onUnload[f]||[];a[b].contexts.onUnload[f].push(function(){a[b].stats.running-=
c;a[b].stats.disabled-=g});a[b].tabs.ts=(new Date).getTime()},updateMaps:function(b,f,c){var g=1,d=function(f,c){void 0===a[b].maps[c]&&1===g&&(a[b].maps[c]=0);a[b].maps[c]+=g};A.each(c,d);a[b].contexts.onUnload[f]=a[b].contexts.onUnload[f]||[];a[b].contexts.onUnload[f].push(function(){a[b]&&(g=-1,A.each(c,d))})},updateUrls:function(b,f,c){var g=1,d=function(){void 0===a[b].urls[c]&&1===g&&(a[b].urls[c]=0);a[b].urls[c]+=g;a[b].urls.length=-1};d();a[b].contexts.onUnload[f]=a[b].contexts.onUnload[f]||
[];a[b].contexts.onUnload[f].push(function(){a[b]&&(g=-1,d())})},determine:function(b,f,c){f=qa.get(f,c);a[b].scripts[c]=f;return f.runners.length},run:function(a,b,f,c,g,d){for(var k=[],m=1,e=function(){0===--m&&d&&d()},s=p.RUNTIME.ALLOWS_FAST_DOCUMENT_START&&h.values.runtime_fastDocumentStart,u=0;u<g.length;u++){var n=g[u];if(!n.options.user_agent&&(!n.evilness||n.evilness<h.values.script_blacklist_severity)){var r=new Ca(s&&("document-start"===n.options.run_at||!n.options.run_at&&"document-start"===
n.options.override.orig_run_at));m++;(n=r.contentLoad({tabId:a,frameId:b,contextId:f,url:c},n,e))&&k.push(n)}}b=0;for(f=null;f=k[b];b++)chrome.tabs.sendMessage(a,f,function(){});e()}},set:{extra:function(b,f,c,g){a[b]=a[b]||u();null===f?a[b].extra[c]=g:(a[b].extra[c]=a[b].extra[c]||{},a[b].extra[c][f]=g)},blocker:function(a,b){r.set.extra(a,null,"blocker",!0)},forbidden:function(a,b,f){0===b&&r.set.extra(a,null,"forbidden",!0)},fire:{count:function(a,b){r.set.extra(a,null,"fire_count",b)}}},get:{extra:function(b,
f,c,g){void 0===g&&(g=null);var d=null,d=(a[b]?a[b].extra:{})[c];null!==f&&d&&(d=d[f]);return d||g},empty:function(b){var f=!0;if(a[b]&&0!=a[b].urls.length){if(-1==a[b].urls.length)return a[b].urls.length=0,A.each(a[b].urls,function(f,c){"length"!==c&&0<f&&a[b].urls.length++}),r.get.empty(b);f=!1}return f},fire:{count:function(a){return r.get.extra(a,null,"fire_count")}},urls:function(b){return a[b]?a[b].urls:{}},stats:function(b,f){var c={};if(a[b]&&(c.running=a[b].stats.running,c.disabled=a[b].stats.disabled,
f)){c.unique=0;for(var g in a[b].maps)a[b].maps.hasOwnProperty(g)&&0<a[b].maps[g]&&c.unique++}return c},tabs:function(){var b={};A.each(a,function(a,f){b[f]={ts:a.response_ts}});return b},blocker:function(a){return r.get.extra(a,null,"blocker")},forbidden:function(a,b,f){return r.get.extra(a,null,"forbidden")},user_agent:function(a,b){return r.get.extra(a,b,"user_agent")}}};return r}(),ra=function(){return{isScriptUrl:function(a){if(!a||-1!=a.search(/\#bypass=true/)||-1!=a.search(p.REQUESTS.GET_INTERNAL_PAGE_REGEXP()))return!1;
a=a.split(/[\?#$]/)[0];var b=-1!=a.search(/\.user\.(js\#|js\?|js$)/)||-1!=a.search(/\.tamper\.(js\#|js\?|js$)/);return b?!(-1!=a.search(/^htt[ps]{1,2}:\/\/code\.google\.com/)||-1!=a.search(/^htt[ps]{1,2}:\/\/github\.com/)&&-1==a.search(/^htt[ps]{1,2}:\/\/github\.com\/[a-zA-Z0-9%-]\/[a-zA-Z0-9%-]\/raw\//)):b}}}(),z={id:0,useXmlHttpReq:!0,useIframeMessage:!1,callbacks:{},listener:function(a,b){b=a?a.data:b;try{var c=JSON.parse(b),d=z.callbacks[c.id];d?(d.cb&&d.cb(c.content),d.iframe&&d.iframe.parentNode.removeChild(d.iframe),
delete z.callbacks[c.id]):console.warn("localFile: Warn: getSource callback "+c.id+" not found!")}catch(g){console.error("localFile: Error: getSource processing of "+b+" failed!")}},initialize:function(){z.useIframeMessage&&(window.addEventListener("message",z.listener,!1),window.addEventListener("unload",z.clean,!1))},clean:function(){z.useIframeMessage&&(window.removeEventListener("message",z.listener,!1),window.removeEventListener("unload",z.clean,!1));z.callbacks={}},getSource:function(a){"string"===
typeof a&&(a={url:a});return z.useXmlHttpReq?z.getSourceXmlHttp(a):z.getSourceIframe(a)},getSourceXmlHttp:function(a){var b=(new Date).getTime();a.url+=-1!=a.url.search("\\?")?"&":"?";a.url+="ts="+b;var c=function(b){a.cb(V.arrbuf2str(b.response,a.encoding)||"")},b={method:"GET",retries:0,responseType:"arraybuffer",url:a.url};if(a.cb)O(b,{onload:c});else return c=O(b,{}),4==c.readyState&&403==c.status&&(delete b.responseType,c=O(b,{})),4!=c.readyState||200!=c.status&&0!=c.status?null:c.response},
getSourceIframe:function(a){0==z.id&&z.initialize();var b=document.createElement("iframe");b.src=a.url+"?gimmeSource=1";document.getElementsByTagName("body")[0].appendChild(b);var c=JSON.stringify({id:z.id});z.callbacks[z.id]={cb:a.cb,ts:(new Date).getTime(),iframe:b,url:a.url};(function(){var a=z.id;b.onload=function(){if(null!=a)try{b.contentWindow.postMessage(c,b.src),a=null}catch(g){D&&console.error("localFile: ERROR:"+g.message)}};window.setTimeout(function(){null!=a&&(z.callbacks[a]&&z.listener(null,
JSON.stringify({id:a,content:null})),a=null)},3E3)})();z.id++}};lfgs=z;var ba=function(){var a={init:function(){var b=E(),c=function(){"server"===h.values.script_blacklist_type&&window.setTimeout(a.checkUpdate,2E4)};c();h.addChangeListener("script_blacklist_type",c);b.resolve();return b.promise()},getEvilnessOf:function(a){if("off"===h.values.script_blacklist_type)return!1;if(!a)return 0;var c=!1,d=0,g=function(f){var g=!1;if(f.length)return(g="/"==f.substr(0,1)?v.matchUrl(a,f):-1!=a.search(f))&&
console.debug('black: entry "'+f+'" matched'),c|=g,!0!=c};A.each(h.values.require_blacklist,g);c?d=11:"server"===h.values.script_blacklist_type&&A.each(h.values.script_blacklist_server,function(a){if(a&&(A.each(a.rules,function(a){g(a);return!0!=c}),c))return d=a.severity,!1});return Number(d)},checkUpdate:function(a){var c=E(),d=U.getConfig(),g;if(a||864E5<(new Date).getTime()-d.black.last){var f=function(a){var b=E();O({method:"GET",url:a,retries:p.XMLHTTPREQUEST.RETRIES,overrideMimeType:"text/plain; charset=x-user-defined"},
{onload:function(a){b.resolve(a)}});return b.promise()};f("http://blacklist.tampermonkey.net/get.php?version=get").then(function(c){if(4==c.readyState&&200==c.status){try{g=JSON.parse(c.responseText).version}catch(m){console.log("black: unable to parse version response! "+c.responseText)}console.log("black: local version: "+d.black.version+" remote: "+g);if(g>d.black.version||a)return f("http://blacklist.tampermonkey.net/get.php")}}).then(function(a){if(a&&4==a.readyState&&200==a.status)try{var b=
JSON.parse(a.responseText);b&&b.blacklist&&1==b.version&&(h.values.script_blacklist_server=b.blacklist,d=U.getConfig(),d.black.last=(new Date).getTime(),d.black.version=g,U.setConfig(d));console.log("black: updated blacklist to ",b)}catch(f){console.log("black: blacklist update failed! ",a.responseText)}}).always(function(){c.resolve()})}else c.resolve();return c.promise()}};return a}();blak=ba;var I=function(){var a={fireDB:null,status:{initialized:!1,action:"Initializing"},resetStatus:function(b){void 0===
b&&(b=!!a.fireDB);a.status={initialized:b,update:!1,download:!1,action:"",error:"",progress:{n:0,of:0}}},isReady:function(){return a.status.initialized&&!a.status.update&&!a.status.download},checkUpdate:function(b,c,d,g){var f=b||c;if(f||0!=h.values.fire_updatePeriod&&h.values.fire_enabled){var k=U.getConfig(),m=function(){g&&g(""==a.status.error)};if(a.status.update||a.status.download){d&&d(!0);var e=function(){a.isReady()?m():window.setTimeout(e,1E3)};g&&e()}else if(f||(new Date).getTime()-k.fire.last>
h.values.fire_updatePeriod){var n=0,H=function(){a.update(b,function(b){""==a.status.error&&(k=U.getConfig(),k.fire.last=(new Date).getTime(),k.fire.db_version=n,k.fire.entries=b,U.setConfig(k));m()})},f={method:"GET",url:a.updateURL()+"&db_version=get",retries:p.XMLHTTPREQUEST.RETRIES,overrideMimeType:"text/plain; charset=x-user-defined"};O(f,{onload:function(a){if(4==a.readyState){a.status=200;try{n=JSON.parse(a.responseText).db_version}catch(b){console.log("bg: fire: unable to parse DB version response! "+
a.responseText)}console.log("bg: fire: local DB version: "+k.fire.db_version+" remote: "+n);a=n>k.fire.db_version||c;d&&d(a);a?H():m()}}})}else m()}},updateURL:function(){return h.values.fire_getURL+"?ts=0"},update:function(b,c){var d=null,g=2,f=null,k=1,m=null,s=0,n={},h=function(){d&&window.clearTimeout(d);d=null},u=function(){h();d=window.setTimeout(f,12E4)},r=function(b){return{method:"GET",url:a.updateURL()+"&part="+b,retries:p.XMLHTTPREQUEST.RETRIES,overrideMimeType:"text/plain; charset=x-user-defined"}},
aa=function(b){h();a.resetStatus();a.status.error=b;c&&c();console.log(e.getMessage("TamperFire_update_failed___")+" Error: "+b+" @ file:"+r(k).url);P.show("TamperFire",e.getMessage("TamperFire_update_failed___"),chrome.extension.getURL("images/icon128.png"),3E4)},M=function(b){u();if(b.progress&&-1!=b.progress.totalSize){null==m&&(m=b.progress.totalSize);var f=60*m,c=b.progress.done+6*m*(k-1);c>f&&(c=f);a.status.progress={n:c,of:f};D&&0==++s%50&&console.log("bg: fire download: "+b.progress.done+
" bytes "+c+"/"+f)}},l=function(b){u();if(4==b.readyState){b.status=200;h();var d={};b=b.responseText;try{d=JSON.parse(b)}catch(m){if(-1!=b.search("<body>")){var s=b.indexOf("<body>"),r=b.lastIndexOf("</body>");-1!=s&&-1!=r&&(b=b.substr(s+6,r-(s+6)))}try{d=JSON.parse(b)}catch(l){aa("Parse Error! Update URL: "+a.updateURL());return}}b=null;if(d.scripts){for(var M in d.scripts)n[M]=d.scripts[M];d=null;if(10>k)D&&console.log("bg: fire: download of file "+k+" succced"),k++,g=2,f();else{a.resetStatus();
a.status.update=!0;a.status.action=e.getMessage("Update_in_progress");var p=function(b){!1===b?a.resetStatus(!1):(a.status.update=!0,a.insertValuesFromJSON({scripts:n},function(b){a.resetStatus();console.log(e.getMessage("TamperFire_is_up_to_date"));P.show("TamperFire",e.getMessage("TamperFire_is_up_to_date"),chrome.extension.getURL("images/icon128.png"),3E4);c&&c(b)}),n=null)};a.clean(function(){a.initTables(p)})}}else aa("Invalid Content! Update URL: "+a.updateURL())}else console.log(b)},f=function(){0<
g?(a.status.action=e.getMessage("Downloading"),a.status.download=!0,u(),O(r(k),{onload:l,onreadychange:M}),g--):aa("Download failed!")};console.log(e.getMessage("TamperFire_update_started"));P.show("TamperFire",e.getMessage("TamperFire_update_started"),chrome.extension.getURL("images/icon128.png"),3E4);b||chrome.tabs.create({url:chrome.extension.getURL("fire.html")},function(){});f()},init:function(b){a.resetStatus(!1);a.initTables(function(c){c=!1!==c;b&&b(c);c&&window.setTimeout(a.checkUpdate,2E4)})},
clean:function(b){var c=function(){b&&b()},d=function(){a.fireDB.db.transaction(function(a){a.executeSql("DROP TABLE scripts",[],c,c)})},g=function(){a.fireDB.db.transaction(function(a){a.executeSql("DROP TABLE excludes",[],d,d)})},f=function(){a.fireDB.db.transaction(function(a){a.executeSql("DROP TABLE includes",[],g,g)})},k=function(){a.fireDB.db.transaction(function(a){a.executeSql("DROP TABLE scriptexcludes",[],f,f)})};(function(){a.fireDB.db.transaction(function(a){a.executeSql("DROP TABLE scriptincludes",
[],k,k)})})()},initTables:function(b){var c=function(){a.status.initialized=!0;b&&b()},d=null;try{d=openDatabase("tmFire","1.0","TamperFire",41943040)}catch(g){console.warn("Unable to open TamperFire database! ",g.message);b&&b(!1);return}a.fireDB={db:d,onSuccess:function(a,b){},onError:function(a,b,f,c){console.error("fireDB Error "+JSON.stringify(b));f&&console.warn(" @ statement "+f);c&&console.warn("        with "+JSON.stringify(c))},createScriptTable:function(f){var c=function(f,c){a.fireDB.onError(f,
c);b&&b(!1)};a.fireDB.db.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS scripts(sid INTEGER PRIMARY KEY ASC, value TEXT)",[],f,c)})},createScriptIncludesTable:function(f){var c=function(f,c){a.fireDB.onError(f,c);b&&b(!1)};a.fireDB.db.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS scriptincludes(iid INTEGER, sid INTEGER, FOREIGN KEY(sid) REFERENCES scripts(sid),FOREIGN KEY(iid) REFERENCES includes(iid))",[],f,c)})},createIncludesTable:function(f){var c=function(f,
c){a.fireDB.onError(f,c);b&&b(!1)};a.fireDB.db.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS includes(iid INTEGER PRIMARY KEY ASC, generic BOOLEAN, regex TEXT)",[],f,c)})},createScriptExcludesTable:function(f){var c=function(f,c){a.fireDB.onError(f,c);b&&b(!1)};a.fireDB.db.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS scriptexcludes(eid INTEGER, sid INTEGER, FOREIGN KEY(sid) REFERENCES scripts(sid),FOREIGN KEY(eid) REFERENCES excludes(eid))",[],f,c)})},createExcludesTable:function(f){var c=
function(f,c){a.fireDB.onError(f,c);b&&b(!1)};a.fireDB.db.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS excludes(eid INTEGER PRIMARY KEY ASC, regex TEXT)",[],f,c)})}};var f=function(){a.fireDB.createScriptExcludesTable(c)},k=function(){a.fireDB.createScriptIncludesTable(f)},m=function(){a.fireDB.createExcludesTable(k)};a.fireDB.createScriptTable(function(){a.fireDB.createIncludesTable(m)})},insertValuesFromJSON:function(b,c){var d=[],g=[],f={},k={},m=[],s=[],n=[],H=[],u=0,r=0;console.log(e.getMessage("TamperFire_import_started"));
for(var aa in b.scripts)b.scripts.hasOwnProperty(aa)&&d.push(aa);a.status.action=e.getMessage("Processing_scripts");a.status.progress={n:0,of:d.length};var M=0,l,p=0,q=function(){for(var a in f){var b=u++;m.push([a,f[a].generic,b]);for(var c in f[a].sids)n.push([b,f[a].sids[c]])}},t=function(){for(var a in k){var b=r++;s.push([a,b]);for(var f in k[a].sids)H.push([b,k[a].sids[f]])}},v=function(b,f,c,g){if(c.length){a.resetStatus();a.status.update=!0;a.status.action=e.getMessage("Writing_scripts");
a.status.progress={n:b,of:m.length+s.length+n.length+H.length};var d=function(){v(b,f,c,g)},k=c.length-1;1E4<k-l&&(k=l+1E4);D&&console.log("bg: write TF "+k);f(c.slice(l,k),function(){l>=c.length-1?g&&g():window.setTimeout(d,0)});l=k;a.status.progress.n=b+l}else g&&g()},x=function(b){g.length?(a.scripts.setValues(g,b),g=[]):b&&b()},w=function(){var b=function(){c&&c(d.length)},f=function(){l=0;v(p,a.scriptExcludes.setValues,H,b);p+=H.length},g=function(){l=0;v(p,a.scriptIncludes.setValues,n,f);p+=
n.length},k=function(){l=0;v(p,a.excludes.setValues,s,g);p+=s.length};q();t();x(function(){l=0;v(p,a.includes.setValues,m,k);p+=m.length})},y=function(){1E4<g.length?x(y):(M++,0==M%96?window.setTimeout(z,0):z())},z=function(){D&&0==M%2048&&console.log("bg: import TF script "+d[M]);a.status.progress.n=M;if(M<d.length){var c=b.scripts[d[M]];g.push([d[M],JSON.stringify(c)]);for(var m=0;m<c.excludes.length;m++){var e=B.getRegExpFromInclude(c.excludes[m],{safe:!0,tryToFixUrl:h.values.tryToFixUrl,safeUrls:h.values.safeUrls});
k[e]||(k[e]={sids:[]});k[e].sids.push(d[M])}for(m=0;m<c.includes.length;m++){var r=c.includes[m].trim(),e=B.getRegExpFromInclude(r,{safe:!0,tryToFixUrl:h.values.tryToFixUrl,safeUrls:h.values.safeUrls});if(!f[e]){var s=0;if(-1!=r.search("^[https*]]{1,}[://]{0,}[w.]{0,4}[*|.]{1,}[$|/]")||-1!=r.search("^[.*/]{1,}$")||-1!=r.search("^[https*]{1,}[://]{0,}[w.]{0,4}[.|*|/]{1,}$")||-1!=r.search("^"+A.escapeForRegExp("*://*[$|/]"))||""==r.replace(/(https|http|\*).:\/\/\*/,"")||"*"==r)s=1;f[e]={sids:[],generic:s.toString()}}f[e].sids.push(d[M])}y()}else w()};
z()},count:function(b,c,d,g){a.getValues(b,c,[d],function(a){g(a.length)})},setValue:function(b,c,d,g,f,k){a.setValues(b,[c,g],[g,f],k)},setValues:function(b,c,d,g){for(var f=0,k=[],m=[],e=0;e<c.length;e++)k.push(c[e]),m.push("?");var h=function(c){if(f<d.length){var e="INSERT INTO "+b+"("+k.join(", ")+") VALUES ("+m.join(", ")+");";c.executeSql(e,d[f],h,function(b,c){a.fireDB.onError(b,c,e,d[f]);h(b)});f++}else g&&g()};a.fireDB.db.transaction(h)},getValues:function(b,c,d,g){var f=0,k=null,m=[],e=
function(a,b){if(b.rows)for(var c=0;c<b.rows.length;c++)m.push(b.rows.item(c));f<d.length?h():g(m)},h=function(g){k||(k=g);var m=[];g=[];for(var h=f;h<d.length&&20>h-f;h++)g.push(c+"=?"),m.push(d[h]);k.executeSql("SELECT * FROM "+b+" WHERE "+g.join(" OR "),m,e,a.fireDB.onError);f+=20};a.fireDB.db.transaction(h)},getMax:function(b,c,d){var g='MAX("'+c+'")',f=function(a,b){var c=0;b.rows&&b.rows.length&&(c=b.rows.item(0)[g]);d(c)};a.fireDB.db.transaction(function(c){c.executeSql("SELECT "+g+' FROM "'+
b+'"',[],f,a.fireDB.onError)})},tab:{getItems:function(b,c){var d={},g=[],f=1,k=function(){for(var a in d)d.hasOwnProperty(a)&&g.push(d[a]);0==f&&c&&window.setTimeout(function(){c(g)},1)},e=function(a){for(var b=0;b<a.length;b++)d[a[b]["uso:script"]]=a[b];0==--f&&k()};t.get.empty(b)||A.each(t.get.urls(b),function(b,c){f++;a.url.getItems(c,e)});f--;k()},getCountCallbacks:{},resetFireCnt:function(b){a.tab.getCountCallbacks[b]=[];t.set.fire.count(b,null)},getCount:function(b,c){var d=t.get.fire.count(b);
d?c(d):(d=function(c){t.set.fire.count(b,c.length);c=c.length;if(a.tab.getCountCallbacks[b])for(;0<a.tab.getCountCallbacks[b].length;){var f=a.tab.getCountCallbacks[b].pop();f&&f(c)}},a.tab.getCountCallbacks[b]||(a.tab.getCountCallbacks[b]=[]),0==a.tab.getCountCallbacks[b].length&&a.tab.getItems(b,d),a.tab.getCountCallbacks[b].push(c))}},url:{getCount:function(b,c){D&&console.log("bg: TF: get count for URL "+b);var d=function(a,b){var g=0;b.rows&&b.rows.length&&(g=b.rows.item(0)["count(*)"]);c(g)},
g="",g=g+"SELECT count(*) FROM scripts WHERE sid IN ",g=g+"    (SELECT sid FROM scriptincludes WHERE iid IN (SELECT iid FROM includes WHERE generic=0 AND ? REGEXP regex)) ",g=g+"AND NOT sid IN ",g=g+"    (SELECT sid FROM scriptexcludes WHERE eid IN (SELECT eid FROM excludes WHERE ? REGEXP regex)) ";a.fireDB.db.transaction(function(c){c.executeSql(g,[b,b],d,a.fireDB.onError)})},getItems:function(b,c){D&&console.log("bg: TF: get scripts for URL "+b);var d=[],g,f=0,k=0;g="SELECT * FROM scripts T1 WHERE T1.sid IN     (SELECT sid FROM scriptincludes WHERE iid IN (SELECT iid FROM includes WHERE generic=0 AND ? REGEXP regex)) ";
g+="AND NOT T1.sid IN ";g+="    (SELECT sid FROM scriptexcludes WHERE eid IN (SELECT eid FROM excludes WHERE ? REGEXP regex)) ";var e="*"==b,h=e?"SELECT DISTINCT t1.value, t1.sid FROM scripts T1 JOIN scriptincludes T2 ON T1.sid=T2.sid WHERE T2.iid IN (SELECT iid FROM includes WHERE generic=0)":g,n=function(a,b){k=(new Date).getTime();D&&console.log("bg: TF db access: 1 -> "+(k-f)+"ms");if(b.rows&&b.rows.length)for(var g=0;g<b.rows.length;g++)try{var e=b.rows.item(g).value;d.push(JSON.parse(e))}catch(m){console.error("bg: error parsing TamperFire entry "+
item[g])}else console.warn("bg: warn: no scripts entry");c(d)};a.fireDB.db.transaction(function(c){f=(new Date).getTime();c.executeSql(h,e?[]:[b,b],n,a.fireDB.onError)})}},ids:{getItems:function(b,c){var d=[],g=function(a){if(a&&a.length)for(var b=0;b<a.length;b++)try{d.push(JSON.parse(a[b]))}catch(g){console.error("bg: error parsing TamperFire entry "+a)}else console.warn("bg: warn: no scripts entry");c(d)};b.length?a.scripts.getValues(b,null,g):c(d)}},includes:{setValues:function(b,c){a.setValues("includes",
["regex","generic","iid"],b,c)}},scriptIncludes:{setValues:function(b,c){a.setValues("scriptincludes",["iid","sid"],b,c)}},excludes:{setValues:function(b,c){a.setValues("excludes",["regex","eid"],b,c)}},scriptExcludes:{setValues:function(b,c){a.setValues("scriptexcludes",["eid","sid"],b,c)}},scripts:{getValues:function(b,c,d){a.getValues("scripts","sid",b,function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);d(b)})},setValue:function(b,c,d){a.setValue("scripts","sid",b,"value",c,d)},setValues:function(b,
c){a.setValues("scripts",["sid","value"],b,c)}}};return a}();fire=I;var Da=function(){for(var a=[],b=[],c=0;c<a.length;c++){var d=Registry.getRaw("system/"+a[c]+".tamper.js");d&&b.push(d)}return b},l={initialized:!1,listenerRegistered:!1,enabled:!1,syncing:0,period:null,syncDoneListener:[],scheduled:{to:null,force:null,t:0},SYNCED:{comment:!0},createTeslaData:function(a){for(var b=[],c=l.getLocalScriptList(),d=0;d<c.length;d++)if(c[d].url){var g=JSON.stringify(c[d].options),g=c[d].name.replace(/\|/g,
"!")+"|"+g+"|"+c[d].url.replace(/\|/g,"%7C");b.push(g)}a&&a(b)},enable:function(a){l.enabled?D&&l.initialized&&l.listenerRegistered&&console.log("sync: reenable?"):l.enabled=0==h.values.sync_type?!1:K.init(h.values.sync_type,h.values.sync_id);l.listenerRegistered||(K.addChangeListener(l.remoteChangeCb),l.listenerRegistered=!0);l.initialized||(l.initialized=!0);a&&a(l.enabled)},finalize:function(){},reset:function(a){K.reset(a)},addSyncDoneListener:function(a){l.syncDoneListener.push(a)},runAllSyncDoneListeners:function(a){for(;l.syncDoneListener.length;)l.syncDoneListener.splice(0,
1)[0](a)},scheduleSync:function(a,b){var c=(new Date).getTime();b=l.scheduled.force||b;l.scheduled.to?(window.clearTimeout(l.scheduled.to),l.scheduled.ts<c+a&&(a=l.scheduled.ts-c,1>a&&(a=1))):D&&console.debug("sync: schedule sync for run in "+a+" ms");var d=function(){l.sync(l.scheduled.force);l.scheduled.to=null;l.scheduled.force=null};l.scheduled.to=window.setTimeout(function(){h.values.sync_type==K.types.eCHROMESYNC?l.listenerRegistered?d():l.enable(d):d()},a);l.scheduled.force=b;l.scheduled.ts=
c+a},schedulePeriodicalCheck:function(){l.period||(D&&console.debug("sync: schedule sync for periodical run every 18000000 ms"),l.period=window.setInterval(l.sync,18E6))},disablePeriodicalCheck:function(){l.period&&(D&&console.debug("sync: disable periodical sync"),window.clearInterval(l.period),l.period=null)},getLocalObjFromScript:function(a){var b=a.downloadURL?a.downloadURL.split("#")[0]:null,c=a.fileURL?a.fileURL.split("#")[0]:null,d=A.select([c,b],function(a){if(!a||"file:"!==B.parse(a).protocol)return a})[0],
b={uuid:a.uuid,name:a.name,options:{},durl:b,furl:c,url:d},g;for(g in l.SYNCED)!0===l.SYNCED[g]&&null!==a.options[g]&&(b.options[g]=a.options[g]);return b},getLocalScriptList:function(){var a=[];w.getUidList().forEach(function(b){b=w.getByUid(b);b.script&&b.cond&&a.push(l.getLocalObjFromScript(b.script))});return a},getRemoteScriptList:function(a){K.list(a)},checkSyncAccount:function(a,b,c){var d=null;b=function(a){null==d&&(d=window.setTimeout(function(){l.enable(function(){l.scheduleSync(3E3,a)});
d=null},200))};"sync_enabled"==a?c?(h.values.sync_type==K.types.ePASTEBIN&&l.schedulePeriodicalCheck(),b()):(l.enabled=!1,l.disablePeriodicalCheck()):"sync_type"==a?(c==K.types.ePASTEBIN?l.schedulePeriodicalCheck():c==K.types.eCHROMESYNC&&l.disablePeriodicalCheck(),b()):"sync_id"==a&&h.values.sync_type==K.types.ePASTEBIN&&b()},sync:function(a){if(0<l.syncing)a&&l.addSyncDoneListener(function(b){b&&l.scheduleSync(50,a)});else if(l.enabled){l.syncing++;var b=null,c=null,d=[],g=!0,f={},k=function(){if(0<
d.length){var a=d.splice(0,1);window.setTimeout(a[0],1)}},m=function(a){(c=a)?k():(D&&console.error("sync: unable to get remotelist!"),g=!1,H())};d.push(function(){l.getRemoteScriptList(m);b=l.getLocalScriptList()});var s=function(a){if(a){(a=a.split("#")[0])&&(a=a.toLowerCase());for(var c=0;c<b.length;c++){var f=b[c].furl?b[c].furl.toLowerCase():null,g=b[c].durl?b[c].durl.toLowerCase():null;if(f==a||g==a)return b[c]}}return null},n=function(a){if(a){a=a.split("#")[0];for(var b=0;b<c.length;b++)if(c[b].url==
a)return c[b]}return null};d.push(function(){for(var a=1,b=function(b){0==--a&&k()},g=0;g<c.length;g++){var d=c[g],m=!1,h=!1,n=s(d.url);if(n){m=!0;f[d.url]=!0;for(var H in l.SYNCED)if(!0===l.SYNCED[H]&&n.options[H]!=d.options[H]){h=!0;break}}if(m)if(d.options.removed)D&&console.debug("sync: remove local script "+(d.name||d.url)),w.setByUid(n.uuid,null,!1);else if(h)if(D&&console.debug("sync: update local script "+(d.name||d.url)),h=w.getByUid(n.uuid),h.script&&h.cond){for(H in l.SYNCED)!0===l.SYNCED[H]&&
(h.script.options[H]=d.options[H]);w.setByUid(h.script.uuid,h.script,!1)}else console.log(e.getMessage("fatal_error")+"("+n.name+")!!!");m||d.options.removed||(a++,l.importScript(d,b))}b()});h.values.sync_type!=K.types.ePASTEBIN&&d.push(function(){for(var a=1,c=function(b){0==--a&&k()},g=0;g<b.length;g++){var d=!1,e=b[g],m=e.url;m&&!f[m]&&(n(m)&&(d=!0),d||(a++,l.exportScript(e,c)))}c()});var H=function(){D&&console.debug("sync: finished");0==--l.syncing&&l.runAllSyncDoneListeners(g)};d.push(H);k()}},
importScript:function(a,b){D&&console.debug("sync: import "+(a.name||a.url));var c={imported:h.values.sync_type},d={},g;for(g in l.SYNCED)!0===l.SYNCED[g]&&(d[g]=a.options[g]);v.installFromUrl(a.url,{ask:!1,internal:!0,sync:c,force_options:d}).always(function(a){b&&b(a)})},exportScript:function(a,b){D&&console.debug("sync: export "+(a.name||a.url));K.add(a,function(){b&&b(!0)})},removeScript:function(a,b){D&&console.debug("sync: remove "+(a.name||a.url));K.remove(a,b)},remoteChangeCb:function(a,b){l.enabled&&
h.values.sync_type==K.types.eCHROMESYNC&&l.scheduleSync(500,!0)},scriptAddedCb:function(a,b){if(l.enabled){var c=l.getLocalObjFromScript(b);c.url&&B.parse(c.url).protocol.match(/https?:/)&&l.exportScript(c)}},scriptChangedCb:function(a,b,c){if(l.enabled&&(a=l.getLocalObjFromScript(b),a.url))for(var d in l.SYNCED)if(!0===l.SYNCED[d]&&b.options[d]!=c.options[d]){l.exportScript(a);break}},scriptRemovedCb:function(a,b){if(l.enabled){var c=l.getLocalObjFromScript(b);c.url&&l.removeScript(c)}}};sycl=l;
var Ea=function(a){h.addChangeListener("scriptblocker_overwrite",L.init);h.addChangeListener("sync_enabled",l.checkSyncAccount);h.addChangeListener("sync_type",l.checkSyncAccount);h.addChangeListener("sync_id",l.checkSyncAccount);h.addChangeListener("fire_enabled",function(a,c,d){d&&!I.status.initialized&&I.init()});h.addChangeListener("logLevel",function(){na(h.values.logLevel)});h.addChangeListener("i18n",function(){e.setLocale(h.values.i18n)});h.addChangeListener("native_import_path",function(){R.setPath(h.values.native_import_path)});
h.addChangeListener("incognito_mode",function(){sa()});h.addChangeListener("require_blacklist",v.blackCheckAll);h.addChangeListener("script_blacklist_server",v.blackCheckAll);h.addChangeListener("script_blacklist_type",v.blackCheckAll)},h=function(){var a;a="// ==UserScript==\n// @name       My Fancy New Userscript\n";a+="// @namespace  http://use.i.E.your.homepage/\n";a+="// @version    0.1\n";a+="// @description  enter something useful\n";a+="// @match      <$URL$>\n";a+="// @copyright  2012+, You\n";
a+="// ==/UserScript==\n\n";var b={},c={enabled:!0,configMode:0,safeUrls:!0,tryToFixUrl:!0,debug:!1,logLevel:0,showFixedSrc:!1,webrequest_modHeaders:"yes",webrequest_fixCSP:"yes",scriptblocker_overwrite:"no",notification_showUpdate:"changelog",notification_silentScriptUpdate:!0,scriptTemplate:a,scriptUpdateCheckPeriod:864E5,scriptUpdateHideNotificationAfter:15E3,scriptUpdateCheckDisabled:!1,runtime_fastDocumentStart:!0,runtime_unsafeWindow:"auto",autoReload:!1,appearance_badges:"running",fire_enabled:!1,
fire_sort_cache_enabled:!0,fire_getURL:"http://fire.tampermonkey.net/get.php",fire_updatePeriod:12096E5,fire_topOnly:!0,editor_enabled:!0,editor_keyMap:"windows",editor_indentUnit:4,editor_indentWithTabs:!1,editor_tabMode:"smart",editor_enterMode:"indent",editor_electricChars:!0,editor_autoSave:!1,editor_easySave:!0,native_import:!0,native_import_path:null,native_import_post_action:"disable",i18n:null,incognito_mode:"temporary",layout:"default",sync_enabled:!1,sync_type:2,sync_id:"",statistics_enabled:!0,
require_timeout:1E4,require_blacklist:["/^https?:\\/\\/example.com\\/.*/"],script_blacklist_server:[],script_blacklist_type:"server",script_blacklist_severity:4,forbiddenPages:"*.paypal.tld/* https://*deutsche-bank-24.tld/* https://*bankamerica.tld/* *://apis.google.com/_/+1/*button* *://www.facebook.com/plugins/* *://platform.twitter.com/widgets/*".split(" ")},d=function(a,g){var d=q.getValue(p.CONSTANTS.STORAGE.CONFIG,{}),e=void 0===d[a]?c[a]:d[a];b[a]&&JSON.stringify(e)!=JSON.stringify(g)&&b[a].forEach(function(b){window.setTimeout(function(){b(a,
e,g)},1)});d[a]=g;q.setValue(p.CONSTANTS.STORAGE.CONFIG,d)},g={init:function(){var a=E();g.values={};for(var b in c)c.hasOwnProperty(b)&&function(){var a=b;g.values.__defineGetter__(a,function(){var b=q.getValue(p.CONSTANTS.STORAGE.CONFIG,{});return void 0===b[a]?c[a]:b[a]});g.values.__defineSetter__(a,function(b){d(a,b)})}();g.images={};g.images.icon="images/icon.png";g.initialized=!0;var e=Da(),h;for(h in e){var n=e[h];window.setTimeout(function(){v.doSave({url:null,src:n,ask:!1,replace:!0,defaultscript:!0})},
1)}a.resolve();return a.promise()},addChangeListener:function(a,c){b[a]||(b[a]=[]);b[a].push(c)}};return g}(),O=function(a,b){return da(a,b,{internal:!0})},Ca=function(a){var b=this;this.getResources=function(c,d){var g=function(a,b){b.loaded=!0;b.resURL="";b.resText="";if(4!=a.readyState||200!=a.status&&0!=a.status)D&&console.debug("ri: Failed to load: '"+b.url+"' "+a.status+" "+a.statusText);else{var c=null,f=a.responseHeaders?a.responseHeaders.split("\n"):null,g;for(g in f){var d=f[g].split(":"),
k=d.shift()||"",d=d.join(":")||"";if("content-type"==k.trim().toLowerCase()&&-1!=d.search("image")){c=d.trim();break}}try{b.resText=V.UTF8.decode(a.response)}catch(e){b.resText=""}c||(-1!=b.url.search(".ico$")||-1!=b.url.search(".jpg$")?c="image/x-icon":-1!=b.url.search(".gif$")?c="image/gif":-1!=b.url.search(".png$")?c="image/png":A.isLocalImage(b.url)&&(c="image/x-icon"));0!=a.status&&Q.items.resources.set(b.url,{content:a.response,headers:a.responseHeaders});try{b.resURL=c?"data:"+c+";base64,"+
V.Base64.encode(a.response):V.Base64.encode(a.response)}catch(m){b.resURL=b.url}}},f,k,e;for(e in c.resources)if(f=c.resources[e],k=!1,!f.loaded){var s=B.parse(f.url);if("tampermonkey:"==s.protocol)-1==s.pathname.search("\\.\\.")?f.url=chrome.extension.getURL(f.url.replace(/^tampermonkey:\/\//,"")):k=!0;else if("chrome-extension:"==s.protocol)if(c.fileURL){var n=B.parse(c.fileURL),l=n.pathname.split("/");l.pop();l=l.join("/")+s.pathname;f.url=n.protocol+"//"+n.hostname+(n.port?":"+n.port:"")+l+s.search}else k=
!0;n=null;k?n={readyState:4,status:404,response:"",responseHeaders:""}:(k=Q.items.resources.get(f.url))&&(n={readyState:4,status:200,response:k.content,responseHeaders:k.headers});if(n)g(n,f),a||b.getResources(c,d);else if(a&&(D&&console.warn("ri: uncached @require detected -> fast script start disabled"),a=!1),"file:"==s.protocol){var u=function(k){g({readyState:4,status:k?0:404,response:k},f);a||b.getResources(c,d)};a?u(z.getSource(f.url)):z.getSource({url:f.url,cb:u})}else u=function(k){k.response=
V.arrbuf2str(k.response)||"";g(k,f);a||b.getResources(c,d)},s={method:"GET",url:f.url,retries:p.XMLHTTPREQUEST.RETRIES,responseType:"arraybuffer"},a?u(O(s,{})):(s.timeout=h.values.require_timeout,O(s,{onload:u,onerror:u,ontimeout:function(){u({readyState:4,status:504,response:null})}}));if(!a)return}if(a)return!0;d(!0)};this.getRequires=function(c,d){var g=function(a,b){b.loaded=!0;b.textContent="";4!=a.readyState||200!=a.status&&0!=a.status||(b.textContent=a.responseText,0!=a.status&&Q.items.requires.set(b.url,
{content:a.responseText,headers:a.responseHeaders}))},f,k,e;for(e in c.requires)if(f=c.requires[e],k=!1,!f.loaded&&f.url){var s=B.parse(f.url);if("tampermonkey:"==s.protocol)-1==s.pathname.search("\\.\\.")?f.url=chrome.extension.getURL(f.url.replace(/^tampermonkey:\/\//,"")):k=!0;else if("chrome-extension:"==s.protocol)if(c.fileURL){var n=B.parse(c.fileURL),l=n.pathname.split("/");l.pop();l=l.join("/")+s.pathname;f.url=n.protocol+"//"+n.hostname+(n.port?":"+n.port:"")+l+s.search}else k=!0;n=null;
k?n={readyState:4,status:404,responseText:""}:(k=null,ba.getEvilnessOf(f.url)<h.values.script_blacklist_severity?(k=Q.items.requires.get(f.url))&&(n={readyState:4,status:200,responseText:k.content}):(k={content:'// this @require ("'+encodeURIComponent(f.url)+'") is blacklisted!\n'},n={readyState:4,status:0,responseText:k.content}));if(n)g(n,f),a||b.getRequires(c,d);else if("file:"==s.protocol){var u=function(k){g({readyState:4,status:k?0:404,responseText:k},f);a||b.getRequires(c,d)};a?u(z.getSource({url:f.url,
encoding:"UTF-8"})):z.getSource({url:f.url,encoding:"UTF-8",cb:u})}else u=function(k){g(k,f);a||b.getRequires(c,d)},s={method:"GET",retries:p.XMLHTTPREQUEST.RETRIES,url:f.url},a?u(O(s,{})):(s.timeout=h.values.require_timeout,O(s,{onload:u,onerror:u,ontimeout:function(){u({readyState:4,status:504,response:null})}}));if(!a)return}if(a)return!0;d(!0)};this.contentLoad=function(c,d,g){var f=function(){d.requires.forEach(function(a){delete a.textContent;delete a.loaded});d.resources.forEach(function(a){delete a.resURL;
delete a.resText;delete a.loaded});g&&g()},k=function(a){if(a)return console.log("run script "+d.name+" @ "+c.url),b.injectScript(d,f)},e=function(a){if(a)return b.info=c,k(b.getRequires(d,k))},e=e(b.getResources(d,e));return a?e:void 0};this.getUrlContents=function(a){var b="",b=new XMLHttpRequest;b.open("GET","/"+a,!1);b.send(null);return b=b.responseText};this.injectScript=function(c,d){var g=[];c.requires.forEach(function(a){a=a.textContent||"";a=ha.mkCompat(a,c.options.compatopts_for_requires?
c:null,!1);g.push(a)});var f="\n"+g.join("\n")+"\n",k=w.getStorageByUid(c.uuid),e=ha.mkCompat(c.textContent,c,!1),s={};h.values.debug&&(e="debugger;\n"+e);for(var n in c)"includes"!=n&&"matches"!=n&&"requires"!=n&&"excludes"!=n&&"textContent"!=n&&("options"==n?(s[n]=JSON.parse(JSON.stringify(c[n])),s[n].run_at=s[n].run_at||c.options.override.orig_run_at||"document-end"):s[n]=c[n]);var l={method:"executeScript",header:c.header,code:e,requires:f,version:chrome.extension.getVersion(),storage:k,script:s,
id:b.info.contextId};if(a)return d(),l;window.setTimeout(function(){chrome.tabs.sendMessage(b.info.tabId,l,d)},1)}},ta=function(a){a&&(a+=(-1==a.search("\\?")?"?":"&")+"ts="+(new Date).getTime());return a},ua=function(){var a=chrome.extension.getViews({type:"popup"});a&&a.length&&chrome.extension.sendMessage({method:"updateActions"},function(a){})},U=function(){return{getConfig:function(){var a={db_version:0,last:0,entries:0},b={version:0,last:0},c={scripts:0,fire:a},d=q.getValue(p.CONSTANTS.STORAGE.UPDATE,
c);"object"!==typeof d&&(d=c);d||(d=c);void 0==d.fire&&(d.fire=a);void 0==d.black&&(d.black=b);void 0==d.scripts&&(d.scripts=0);return d},setConfig:function(a){a&&q.setValue(p.CONSTANTS.STORAGE.UPDATE,a)}}}(),Y={check:function(a,b,c,d){if(a||0!=h.values.scriptUpdateCheckPeriod){var g=function(a){if(b){a=e.getMessage("Script_Update");var g=e.getMessage("Check_for_userscripts_updates")+"...";P.show(a,g,chrome.extension.getURL("images/icon128.png"),1E4)}console.log("update: check for script updates "+
(c?" for "+c:""));Y.updateUserscripts(0,b,c,function(a,b){if(a)try{var f=function(a){a.clicked&&v.doSave({url:b.url,uuid:c,replace:!c,src:b.code,ask:!h.values.notification_silentScriptUpdate,hash:b.newhash})},g=e.getMessage("There_is_an_update_for_0name0_avaiable_",b.name)+"\n"+e.getMessage("Click_here_to_install_it_"),k=e.getMessage("Just_another_service_provided_by_your_friendly_script_updater_")+":";h.values.notification_silentScriptUpdate?f({clicked:!0}):P.show(k,g,chrome.extension.getURL("images/icon128.png"),
h.values.scriptUpdateHideNotificationAfter,f)}catch(r){console.error("update: notification error "+r.message)}d&&d(a)})};(function(){var b=U.getConfig();if(a||(new Date).getTime()-b.scripts>h.values.scriptUpdateCheckPeriod){var c=function(){g();b=U.getConfig();b.scripts=(new Date).getTime();U.setConfig(b)};l.enabled?(l.addSyncDoneListener(c),l.scheduleSync(50,!1)):c()}else d&&(console.warn("update: check -> no force but callback"),window.setTimeout(d,1))})();window.setTimeout(Y.check,3E5)}},srcCmp:function(a,
b){var c=Z.createScriptFromSrc(b);if(!c.name||""==c.name||void 0===c.version)return-2;var d=w.getMetaByUid(a);return d&&d.system?null:c.options.compat_uW_gmonkey?-2:-1!=c.name.search("@")?-2:d&&c.version==d.version?0:d&&-1==T(c.version,d.version)?-1:1},updateUserscripts:function(a,b,c,d){var g=1,f=0,k=function(){0==g&&0==f&&(b&&(D&&console.debug("No update found"),P.show("Narf!",e.getMessage("No_update_found__sry_"),chrome.extension.getURL("images/icon128.png"),1E4)),d&&window.setTimeout(d,1))},m=
function(a){var b={method:"GET",retries:p.XMLHTTPREQUEST.RETRIES,url:v.determineSourceURL(a.script,!0)};g++;(function(){var c=v.determineSourceURL(a.script);da(b,{onload:function(b){g--;if(4==b.readyState&&200==b.status){var m=Y.srcCmp(a.script.uuid,b.responseText);if(1==m||a.hash_different){f++;d&&d(!0,{name:a.script.name,url:c,code:b.responseText,newhash:a.meta?a.meta["uso:hash"]:null});return}0==m&&a.meta&&(a.script.hash=a.meta["uso:hash"],w.setByUid(a.script.uuid,a.script,!1))}else console.log(e.getMessage("UpdateCheck_of_0name0_Url_0url0_failed_",
[a.script.name,c]));k()}})})()},s=function(a,b){var c=v.determineMetaURL(a,!0);c?da({method:"GET",retries:0,url:c,headers:{Accept:"text/x-userscript-meta"}},{onload:function(f){a.meta=null;if(4==f.readyState&&200==f.status){var g=Z.processMetaHeader(f.responseText);a.meta=g;a.metasrc=f.responseText}else console.log("update: unable to find meta data @ "+c+" req.status = "+f.status);b(a)}}):(a.meta=null,b(a))},n=function(a){g++;s(a.script,function(b){var c=!!b.meta,f=c&&!!b.meta.version,d=f&&(!a.script.version||
1==T(b.meta.version,a.script.version)),e=c&&(a.script.hash||!f)&&!!b.meta["uso:hash"]&&b.meta["uso:hash"]!=a.script.hash;if(!c||e||!f||d)a.meta=b.meta,a.metasrc=b.metasrc,a.hash_different=e,m(a);g--;k()})},l=!1;w.getUidList().forEach(function(a){var b=w.getByUid(a);b.script&&b.cond?(a=!h.values.scriptUpdateCheckDisabled&&!b.script.enabled&&!c,c&&b.script.uuid!==c||a||!v.determineMetaURL(b.script)&&!v.determineSourceURL(b.script)||(l=!0,n(b))):console.warn("update: inconsistent script entry",a,b)});
!l&&c&&d&&window.setTimeout(d,1);g--}};trup=Y;var la=function(){var a={},b=function(b){for(var c=0;0==c||void 0!==a[c];)c="_"+A.createUUID();a[c]=b;return c},c=function(a){var b=E();chrome.tabs.getSelected(null,function(c){c=c?c.index:void 0;chrome.tabs.create({url:chrome.extension.getURL("ask.html")+"?aid="+a,active:!0,index:c},function(a){a||(console.error("chrome.tabs.create failed -> giving up now!"),b.reject("chrome.tabs.create failed -> giving up now!"));b.resolve({close:function(){chrome.tabs.remove(a.id)}})})});
return b.promise()},d=function(){var b=(new Date).getTime(),c=a;a={};for(var f in c){var d=c[f];d&&b-d.ts<g&&(a[f]=d)}},g=18E4,f=!1,k=function(a,g){f||e.init();var d=E(),k={ts:(new Date).getTime(),com:d,preparat:g,type:a},k=b(k);return c(k).then(function(a){return d.promise().always(function(b){b.ok&&a.close()})})},e={init:function(){f||(f=!0,window.setInterval(d,3E5))},onMessage:function(b){var c=E(),f=b.aid,g=a[f];if(g)if(g.aborter&&(window.clearTimeout(g.aborter),delete g.aborter),"ping"==b.method)a[f].ts=
(new Date).getTime(),c.resolve({pong:!0});else if("preparat"==b.method)c.resolve({preparat:g.preparat,i18n:h.values.i18n,type:g.type});else if("install"==b.method)g.com.resolve({ok:!0}),c.resolve({}),delete a[f];else if("import"==b.method)g.com.resolve({ok:!0,import_ids:b.import_ids}),c.resolve({}),delete a[f];else{if("unload"==b.method||"abort"==b.method){c.resolve({});var d=function(){g.com.resolve({ok:!1});delete a[f]};"abort"==b.method?d():g.aborter=window.setTimeout(d,1E4)}}else c.reject({error:"unknown_id",
action:"close"});return c.promise()},install:function(a){return k("install",a)},"import":function(a){return k("import",a)}};return e}(),v=function(){var a=function(a){a.sort(function(a,b){return a.position-b.position});return a},b=function(a){void 0===a.ask&&(a.ask=!0);if(void 0===a.url||null==a.url)a.url="";void 0===a.hash&&(a.hash="");""===a.force_url&&(a.force_url=null);var b=Z.createScriptFromSrc(a.src),c,m={heading:null,errors:[],info:[],warnings:[],flags:{}},s=E(),n=(new Date).getTime(),l=a.save&&
!a.ask&&h.values.editor_easySave,p=a.uuid,r;b.name&&void 0!=b.version?r=N():(m.errors.push(e.getMessage("Invalid_UserScript__Sry_")+"\n\n"),a.name&&m.errors.push(e.getMessage("Script_name_0url0",a.name)+"\n\n"),a.url&&m.errors.push(e.getMessage("Downloaded_from_0url0",a.url)),console.warn("scriptman: invalid userscript",m,b),r=W());r.then(function(){a.replace&&!p&&(p=w.getUidsByName(b.name,b.namespace)[0]);c=p?w.getMetaByUid(p):null;if(!p)if(a.replace)p=A.createUUID();else return console.error("scriptman: neither UUID nor replace option set"),
W();return!a.clean&&!a.defaultscript&&c&&c.system?W():N()}).then(function(){return a.clean&&a.name&&a.name!=b.name||-1!=b.name.search("\n")?(m.errors.push(e.getMessage("Invalid_UserScript_name__Sry_")),W()):N()}).then(function(){return b.options.compat_uW_gmonkey?(m.errors.push(e.getMessage("This_script_uses_uW_gm_api_")),W()):N()}).then(function(){if(c){c.name!=b.name&&(m.flags.renamed=!0);if(c.lastModified&&void 0!==a.lastModified&&c.lastModified!==a.lastModified){var d=e.getMessage("some_secs");
try{var h=Math.max(1,Math.floor((n-c.lastModified)/1E3));isNaN(h)||(d=h)}catch(s){}m.warnings.push(e.getMessage("CONFLICT__This_script_was_modified_0t0_seconds_ago_",d));m.flags.forceAsk=!0}m.flags.hashChanged=a.hash&&c.hash!=a.hash;b.version!=c.version||m.flags.hashChanged||(a.save?m.flags.modification=!0:m.flags.reset=!0);a.clean&&(m.flags.factory=!0)}else m.flags.first_install=!0;b.includes.length||b.matches.length||(d="/"+B.staticVars.urlAllHttp_+"/",l||a.internal||m.warnings.push(e.getMessage("This_script_does_not_provide_any__include_information_")+
"\n"+e.getMessage("Tampermonkey_assumes_0urlAllHttp0_in_order_to_continue_",d)),b.includes.push(d));m.flags.internal=a.internal;m.flags.ask=a.ask;return N()}).then(function(){b.uuid=p;b.hash=a.hash;b.lastUpdated=n;b.system=a.defaultscript;b.evilness=v.getEvilness(b);b.position=v.determineLastPosition()+1;m.flags.factory||m.flags.reset||(a.force_url&&(b.updateURL=null,b.downloadURL=a.force_url),c&&(b.options.override=c.options.override,b.options.comment=c.options.comment));b.options.override.orig_includes=
b.includes;b.options.override.orig_excludes=b.excludes;b.options.override.orig_matches=b.matches;b=v.mergeCludes(b);b.options.override.orig_noframes=b.options.noframes;b.options.override.orig_run_at=b.options.run_at||"document-end";b.options.noframes=null;b.options.run_at=null;return N()}).then(function(){if(c&&(b.fileURL=c.fileURL,b.hash=c.hash,b.position=c.position,c.sync&&(b.sync=c.sync),!m.flags.factory&&!m.flags.reset)){b.enabled=c.enabled;b.options.noframes=c.options.noframes;b.options.run_at=
c.options.run_at;b.options.awareOfChrome||(b.options.compat_forvarin=c.options.compat_forvarin);var h=d.determineMetaURL(c),n=d.determineMetaURL(b);h==n||l||a.internal||m.warnings.push(e.getMessage("The_update_url_has_changed_from_0oldurl0_to__0newurl0",[h,n]))}return N()}).then(function(){return!c||m.flags.factory||b.version!=c.version||m.flags.hashChanged||!a.defaultscript&&!a.noreinstall?N():W()}).then(function(){c?(m.flags.factory||m.flags.reset?(m.flags.reset?(m.heading=e.getMessage("You_are_about_to_reinstall_a_UserScript_"),
m.flags.reinstall=!0):(m.heading=e.getMessage("You_are_about_to_install_a_UserScript_"),m.flags.install=!0),a.internal||m.warnings.splice(0,0,e.getMessage("All_script_settings_will_be_reset_"))):m.flags.modification?m.heading=e.getMessage("You_are_about_to_modify_a_UserScript_"):-1==T(b.version,c.version)?(m.heading=e.getMessage("You_are_about_to_downgrade_a_UserScript"),m.flags.downgrade=!0,l||a.internal||m.warnings.splice(0,0,e.getMessage("The_downgraded_script_might_have_problems_to_read_its_stored_data_"))):
(m.heading=e.getMessage("You_are_about_to_update_a_UserScript_"),m.flags.update=!0),m.info.push({label:e.getMessage("Installed_Version_"),value:"v"+c.version})):(m.heading=e.getMessage("You_are_about_to_install_a_UserScript_"),l||a.internal||m.warnings.splice(0,0,e.getMessage("Malicious_scripts_can_violate_your_privacy_")),m.flags.install=!0);m.flags.install?m.action=e.getMessage("Install"):m.flags.reinstall?m.action=e.getMessage("Reinstall"):m.flags.modification?m.action=e.getMessage("Modify"):m.flags.downgrade?
m.action=e.getMessage("Downgrade"):m.flags.update&&(m.action=e.getMessage("Update"));return N()}).then(function(){a.url&&(b.fileURL=a.url);a.sync&&(b.sync=a.sync);if(a.force_options)for(var c in b.options)void 0!==a.force_options[c]&&(b.options[c]=a.force_options[c]);return N()}).then(function(){var a=!1,c;for(c in b.options)if(-1!=c.search("compat_")&&!0===b.options[c]){a=!0;break}a&&m.info.push({label:e.getMessage("Note"),value:e.getMessage("A_recheck_of_the_GreaseMonkey_FF_compatibility_options_may_be_required_in_order_to_run_this_script_")});
return N()}).done(function(){s.resolve({script:b,messages:m,short_info:[{label:e.getMessage("Author"),prop:"author"},{label:e.getMessage("Description"),prop:"description"},{label:e.getMessage("Source"),prop:"fileURL"}]})}).fail(function(){s.reject({messages:m})});return s.promise()},c=function(a){var b=E(),c=a.messages,d=a.script,e=function(){var a=w.setByUid(d.uuid,d)||{};(c.flags.first_install||c.flags.factory)&&w.setStorageByUid(d.uuid,{ts:(new Date).getTime()});return a},h={},l={lastModified:h.lastModified,
installed:!0,renamed:c.flags.renamed};c.warnings.length||c.flags.ask?la.install(a).done(function(a){a.ok&&(h=e());l.installed=a.ok;b.resolve(l)}).fail(function(a){b.reject(a)}):(h=e(),b.resolve(l));return b.promise()},d={determineSourceURL:function(a,b){if(!a)return null;var c=A.select([a.downloadURL,a.fileURL],function(a){if(!a||"file:"!==B.parse(a).protocol)return a})[0];return c&&b?ta(c):c},determineMetaURL:function(a,b){if(!a)return null;var c;a.fileURL&&(c=a.fileURL.replace(".user.js",".meta.js"),
a.fileURL==c&&(c=a.fileURL.replace(".tamper.js",".meta.js")),a.fileURL==c&&(c=null));return(c=A.select([a.updateURL,a.downloadURL,c],function(a){if(!a||"file:"!==B.parse(a).protocol)return a})[0])&&b?ta(c):c},mergeCludes:function(a){var b,c=a.options.override;a.includes=c.merge_includes&&c.orig_includes?c.orig_includes.slice():[];a.excludes=c.merge_excludes&&c.orig_excludes?c.orig_excludes.slice():[];a.matches=c.merge_matches&&c.orig_matches?c.orig_matches.slice():[];for(b=0;b<c.use_includes.length;b++){var d=
a.excludes.indexOf(c.use_includes[b]);0<=d&&a.excludes.splice(d,1);a.includes.push(c.use_includes[b])}if("undefined"!==typeof c.use_matches)for(b=0;b<c.use_matches.length;b++)d=a.excludes.indexOf(c.use_matches[b]),0<=d&&a.excludes.splice(d,1),a.matches.push(c.use_matches[b]);for(b=0;b<c.use_excludes.length;b++)a.excludes.push(c.use_excludes[b]);return a},doSave:function(a){return b(a).then(c)},importFromJson:function(a){if(!a||!a.scripts||!a.scripts.length)return W();for(var f=E(),d={},e=[],h=0,n;n=
a.scripts[h];h++)try{var l=n.name,p=V.UTF8.decode(V.Base64.decode(n.source)),r=b({name:l,src:p,replace:!0,url:n.file_url||n.update_url,ask:!1}).done(function(a){d[A.createUUID()]=a}).fail(function(a){console.warn("import: Error @ script",n.name,a)});e.push(r)}catch(q){console.log("import: Error while importing script",n.name)}$.when.apply($,e).always(function(){la["import"](d).done(function(a){var b=[];if(a.ok)for(var g=0,e;e=a.import_ids[g];g++)d[e]&&(d[e].messages.warnings=[],b.push(c(d[e])));$.when.apply($,
b).always(function(){f.resolve()})}).fail(function(a){f.reject(a)})});return f.promise()},installFromUrl:function(a,b){if(!B.parse(a).protocol.match(/(https?|file):/))return console.warn("scriptman: can't install from ",a),W();var c=E();b=b||{};O({method:"GET",retries:p.XMLHTTPREQUEST.RETRIES,url:a},{onload:function(e){if(4==e.readyState)if(200==e.status||0==e.status){e={url:a,src:e.responseText,ask:!0,replace:!0};if(b)for(var h in b)b.hasOwnProperty(h)&&(e[h]=b[h]);d.doSave(e).done(function(a){c.resolve(a.installed)}).fail(function(){c.reject()})}else c.reject()},
onerr:c.reject});return c.promise()},determineLastPosition:function(){var a=0;w.getUidList().forEach(function(b){var c=w.getByUid(b);c.script&&c.cond?c.script.position&&c.script.position>a&&(a=c.script.position):console.warn("scriptman: inconsistent script entry",b)});var b=new Z.Script;b.position>a&&(a=b.position);return a},matchUrl:function(a,b,c){var d,e;try{!c&&1<b.length&&"/"==b.substr(0,1)?d=RegExp(".*"+b.replace(/^\//g,"").replace(/\/$/g,"")+".*","i"):c?(e=B.getRegExpFromMatch(b),d=RegExp(e)):
(e=B.getRegExpFromInclude(b,{tryToFixUrl:h.values.tryToFixUrl,safeUrls:h.values.safeUrls}),d=RegExp(e,"i"))}catch(n){return console.warn("scriptman: invalid regexp ",b),!1}return""===a.replace(d,"")},validUrl:function(a,b,c){var e,h=!1;if(b.inc||b.match){for(e in b.inc)if("string"!==typeof b.inc[e])console.warn("scriptman: include["+e+"] '"+b.inc[e]+"' "+(c?"@"+c+" ":"")+"can't be compared to '"+a+"'");else if(d.matchUrl(a,b.inc[e])){D&&console.log("scriptman: @include '"+b.inc[e]+"' matched"+(c?
" ("+c+")":""));h=!0;break}if(b.match)for(e in b.match)if("string"!==typeof b.match[e])console.warn("scriptman: match["+e+"] '"+b.match[e]+"' "+(c?"@"+c+" ":"")+"can't be compared to '"+a+"'");else if(d.matchUrl(a,b.match[e],!0)){D&&console.log("scriptman: @match '"+b.match[e]+"' matched"+(c?" ("+c+")":""));h=!0;break}if(!h)return h}else h=!0;for(e in b.exc)if(d.matchUrl(a,b.exc[e])){D&&console.log("scriptman: @exclude '"+b.exc[e]+"' matched"+(c?" ("+c+")":""));h=!1;break}return h},getEvilness:function(a){var b=
0;return a.fileURL&&(b=ba.getEvilnessOf(a.fileURL))||a.downloadURL&&(b=ba.getEvilnessOf(a.downloadURL))||a.updateURL&&(b=ba.getEvilnessOf(a.updateURL))?(D&&console.log("scriptman: found blacklisted script",a),b):0},blackCheckAll:function(){w.getUidList().forEach(function(a){var b=w.getByUid(a);if(b.script&&b.cond){var c=v.getEvilness(b.script);if(c!==b.script.evilness){if(c||void 0!==b.script.evilness)D&&console.log("scriptman: write blacklist state of ",b.script.name,c),c&&h.values.statistics_enabled&&
X.tS(b.script.name,c,"b");b.script.evilness=c;w.setByUid(a,b.script,!1)}}})},reorderScripts:function(b,c){for(var e=d.determineScriptsToRun(),h=0;h<e.length;h++){var l=e[h];l.uuid==b&&(l.position=Number(c)+(l.position<c?0.5:-0.5))}for(var e=a(e),n=1,h=0;h<e.length;h++)l=e[h],l.position=n++,w.setByUid(l.uuid,l,!1)},determineScriptsToRun:function(b){var c=[];D&&console.log("scriptman: determineScriptsToRun @"+b);w.getUidList().forEach(function(a){if(b){var e=q.getValue(p.CONSTANTS.PREFIX.COND+a,null);
if(!e||!d.validUrl(b,e,a))return}e=w.getByUid(a);e.script&&e.cond?c.push(e.script):console.warn("scriptman: inconsistent script entry",a,e)});return a(c)},determineOrigin:function(a){if(a=a.fileURL||a.downloadURL||a.updateURL){var b=a.match(/https?:\/\/userscripts.org\/scripts\/(source|version)\/([0-9]{1,9}).user.js/);if(b&&3==b.length)return{id:b[2],token:"uso",url:"http://userscripts.org/scripts/show/"+b[2],issue_url:"http://userscripts.org/scripts/issues/"+b[2]};if((b=a.match(/https?:\/\/greasyfork.org\/scripts\/([0-9]{1,9})\/code.user.js/))&&
2==b.length)return{id:b[1],token:"gf",url:"https://greasyfork.org/scripts/"+b[1],issue_url:"https://greasyfork.org/scripts/"+b[1]+"/feedback"};if((a=a.match(/https?:\/\/openuserjs.org\/install\/([^/]+)\/([^/]+)\/(.*).user.js/))&&4==a.length)return a.shift(),{id:a.join("/"),token:"ouj",url:"https://openuserjs.org/scripts/"+a[0]+"/"+a[1]+"/"+a[2]}}}};return d}(),w=function(){var a={getUidList:function(){var a=RegExp("^"+p.CONSTANTS.PREFIX.SCRIPT_UID),c=[];q.listValues().forEach(function(d){-1!=d.search(a)&&
c.push(d.replace(a,""))});return c},getUidsByName:function(b,c){var d=[];a.getUidList().forEach(function(g){var f=a.getMetaByUid(g);!f||f.name!=b||c&&c!=f.namespace||d.push(g)});return d},getUidByName:function(b){console.warn("sb: deprecated fn");return a.getUidsByName(b)[0]},getStorageByName:function(b){console.warn("sb: deprecated fn");b=a.getUidByName(b);return a.getStorageByUid(b)},getStorageByUid:function(a){a=q.getValue(p.CONSTANTS.PREFIX.STORE+a,{ts:0,data:{}});"undefined"===typeof a.ts&&(a.ts=
0);"undefined"===typeof a.data&&(a.data={});return a},setStorageByName:function(b,c){console.warn("sb: deprecated fn");var d=a.getUidByName(b);return a.setStorageByUid(d,c)},setStorageByUid:function(a,c){c?q.setValue(p.CONSTANTS.PREFIX.STORE+a,c):q.deleteValue(p.CONSTANTS.PREFIX.STORE+a)},getMetaByName:function(b){console.warn("sb: deprecated fn");b=a.getUidByName(b);return a.getMetaByUid(b)},getMetaByUid:function(a){return q.getValue(p.CONSTANTS.PREFIX.META+a,null)},getByName:function(b){console.warn("sb: deprecated fn");
b=a.getUidByName(b);return a.getByUid(b)},getByUid:function(a){if(!a)return console.error("sb: no UUID set"),{};var c,d=q.getValue(p.CONSTANTS.PREFIX.META+a,null);if(d){var g=function(a){if(a)for(var b=0,c=null;c=a[b];b++)delete c.loaded,delete c.textContent,delete c.resURL,delete c.resText};g(d.requires);g(d.resources);d.uuid=a;d.textContent=q.getValue(p.CONSTANTS.PREFIX.SCRIPT+a,d.textContent);d.textContent&&(c=d)}return{script:c,cond:q.getValue(p.CONSTANTS.PREFIX.COND+a,null)}},setByName:function(b,
c,d){console.warn("sb: deprecated fn");b=a.getUidByName(b)||(c?c.uuid:null)||A.createUUID();return a.setByUid(b,c,d)},setByUid:function(b,c,d){var g={};if(!b)return console.error("sb: no UUID set",c),g;void 0===d&&(d=!0);if(c){var f=q.getValue(p.CONSTANTS.PREFIX.META+b),e=!f;q.setValue(p.CONSTANTS.PREFIX.SCRIPT_UID+b,c.name);q.setValue(p.CONSTANTS.PREFIX.COND+b,{inc:c.includes,match:c.matches,exc:c.excludes});q.setValue(p.CONSTANTS.PREFIX.SCRIPT+b,c.textContent);c.textContent=null;d&&(g.lastModified=
(new Date).getTime(),c.lastModified=g.lastModified);q.setValue(p.CONSTANTS.PREFIX.META+b,c);d&&(e?l.scriptAddedCb(c.name,c):l.scriptChangedCb(c.name,c,f),h.values&&h.values.statistics_enabled&&(b=null,e&&c.fileURL&&(b=B.parse(c.fileURL),d=b.hostname&&5<b.hostname.length?b.hostname.substr(0,1)+"***"+b.hostname.substr(b.hostname.length-3,3):"*",b=b.protocol+"//"+d+(b.port?":"+b.port:"")+b.pathname+(b.search?"?***":"")),X.tS(c.name,b,e?"i":"u")))}else c=a.getByUid(b),q.deleteValue(p.CONSTANTS.PREFIX.SCRIPT_UID+
b),q.deleteValue(p.CONSTANTS.PREFIX.COND+b),q.deleteValue(p.CONSTANTS.PREFIX.SCRIPT+b),q.deleteValue(p.CONSTANTS.PREFIX.META+b),q.deleteValue(p.CONSTANTS.PREFIX.STORE+b),d&&(c.script&&c.cond&&l.scriptRemovedCb(c.script.name,c.script),h.values&&h.values.statistics_enabled&&X.tS(c.script.name,null,"r"));Q.items.rundata.removeAll();return g}};return a}();scbr=w;var va=function(){var a=function(a,c){var d=null,g=a.sender,f=function(c){try{a.postMessage(c)}catch(d){console.error("bg: Error sending port ("+
a.name+") message: "+JSON.stringify(c))}};"xhr"==c.method?da(c.details,{onload:function(a){f({success:!0,data:a})},onreadychange:function(a){f({change:!0,data:a})},onprogress:function(a){f({progress:!0,data:a})},onerr:function(a){f({error:!0,data:a})},ontimeout:function(a){f({timeout:!0,data:a})},ondone:function(){a.disconnect()}}):"addStorageListener"==c.method?"undefined"!=typeof g.tab?(q.addClientListener(g.tab.id,c.id,c.uuid,(new Date).getTime(),f),d=function(){q.removeClientListeners(c.uuid,
c.id,!1)}):(console.log(e.getMessage("Unable_to_load_storage_due_to_empty_tabID_")),f({error:!0})):"removeStorageListener"==c.method?"undefined"!=typeof g.tab?(q.removeClientListeners(c.uuid,c.id),f({error:!1})):(console.warn("Unable to remove storage listener due to empty tabID!"),f({error:!0})):"saveStorageKey"==c.method&&("undefined"!=typeof g.tab?c.uuid&&(g=w.getStorageByUid(c.uuid),g.data[c.key]=c.value,g.ts=c.ts,w.setStorageByUid(c.uuid,g),q.notifyClientListeners(c.uuid,null,function(a){var b=
{data:{},ts:0},d=w.getStorageByUid(c.uuid);b.data[c.key]=d.data[c.key];b.ts=d.ts;b={storage:b};void 0===d.data[c.key]&&(b.removed=c.key);a(b)})):console.log(e.getMessage("Unable_to_save_storage_due_to_empty_tabID_")),f({}));d&&a.onDisconnect.addListener(d)};return function(b){F.late?b.onMessage.addListener(function(c){a(b,c)}):F.registerLateCallback(function(){va(b)})}}(),ia={ping:{allow:{insecure:!0},exec:function(a,b,c){c({pong:!0,instanceID:oa,config:{layout:h.values.layout}})}},openInTab:{allow:{script:!0,
extpage:!0},exec:function(a,b,c){var d=["active"],g={url:a.url};if(a.options){for(var f=0;f<d.length;f++)void 0!==a.options[d[f]]&&(g[d[f]]=a.options[d[f]]);a.options.insert&&(g.index=b.tab.index+1)}chrome.tabs.create(g,function(a){pa[a.id]=!0;c({tabId:a.id})})}},closeTab:{allow:{script:!0,extpage:!0},exec:function(a,b,c){a.tabId&&pa[a.tabId]&&chrome.tabs.remove(a.tabId);c({})}},getTab:{allow:{script:!0},exec:function(a,b,c){b.tab&&a.uid?(S[b.tab.id]||(S[b.tab.id]={}),S[b.tab.id][a.uid]||(S[b.tab.id][a.uid]=
{}),c({data:S[b.tab.id][a.uid]})):(console.log("bg: unable to process request",b,a),c({data:null}))}},getTabs:{allow:{script:!0},exec:function(a,b,c){if(a.uid){b={};for(var d in S)b[d]={},b[d]=S[d][a.uid];c({data:b})}else console.log("bg: unable to process request",b,a),c({data:null})}},setTab:{allow:{script:!0},exec:function(a,b,c){if(b.tab&&a.uid){S[b.tab.id]||(S[b.tab.id]={});var d={},g;for(g in a.tab)d[g]=a.tab[g];S[b.tab.id][a.uid]=d}else console.log("bg: unable to process request",b,a);c({})}},
copyToClipboard:{allow:{script:!0,extpage:!0},exec:function(a,b,c){"undefined"!=typeof b.tab?ma.copy(a.data):console.log("bg: unable to process request",b,a);c({})}},setOption:{allow:{extpage:!0},exec:function(a,b,c){b="options"==b.extpage||"options"==a.origin;h.values[a.name]=a.value;b?ea(function(a){c({items:a,options:h.values})}):c({})}},reportAnIssue:{allow:{extpage:!0},exec:function(a,b,c){var d,g;a.uuid&&(d=w.getByUid(a.uuid))&&d.script&&d.cond&&(g=v.determineOrigin(d.script))&&(h.values.statistics_enabled&&
X.tS(d.script.name,g.token+":"+g.id,"m"),chrome.tabs.create({url:g.issue_url||g.url,active:!0},function(){}));c({})}},buttonPress:{allow:{extpage:!0},exec:function(a,b,c){var d=function(){c({})};"reset_simple"==a.name?ca.reset(d):"reset_factory"==a.name?ca.factoryReset(d):"create_tesla_data"==a.name?l.createTeslaData(function(a){ma.copy({content:V.UTF8.encode(a.join("<br>")),type:"html"});d()}):"reset_chrome_sync"==a.name?l.reset(d):"install_tests"==a.name?(b=fa.framework.prepare(v.doSave,d))&&console.error(b):
"enabled"==a.name?(h.values[a.name]=!h.values[a.name],c({})):"run_script_updates"==a.name?a.scriptuid?(d=function(b){c({scriptuid:a.scriptuid,updatable:b})},Y.check(!0,!1,a.scriptuid,d)):(Y.check(!0,!0),c({})):(console.log("bg: Warning: unknown button "+a.name),c({}))}},modifyScriptOptions:{allow:{extpage:!0},exec:function(a,b,c){var d="options"==b.extpage||"options"==a.origin,g=void 0==a.reload||!0==a.reload,f=function(){g?(a.uuid&&void 0!==a.position&&v.reorderScripts(a.uuid,a.position),d?ea(function(a){c({items:a,
i18n:h.values.i18n,options:h.values})}):chrome.tabs.getSelected(null,function(b){var d=Fa(b);c({items:d,i18n:h.values.i18n,options:{enabled:h.values.enabled,layout:h.values.layout}});a.uuid&&h.values.autoReload&&chrome.tabs.sendMessage(b.id,{method:"reload",frameId:0},function(a){})})):c({})};if(a.uuid&&"modifyScriptOptions"==a.method){var k=w.getByUid(a.uuid);if(k.script&&k.cond){var m=!1,l=new Z.Script,n;for(n in l.options)l.options.hasOwnProperty(n)&&"undefined"!==typeof a[n]&&(k.script.options[n]=
a[n]);for(n in l.options.override)l.options.override.hasOwnProperty(n)&&-1!=n.search("merge_")&&"undefined"!==typeof a[n]&&(k.script.options.override[n]=a[n],m=!0);"undefined"!==typeof a.enabled&&(k.script.enabled=a.enabled);"undefined"!==typeof a.includes&&(k.script.options.override.use_includes=a.includes,k.script.options.override.use_excludes=a.excludes,k.script.options.override.use_matches=a.matches,m=!0);m&&(k.script=v.mergeCludes(k.script));w.setByUid(k.script.uuid,k.script)}}else if(a.nid&&
"modifyNativeScript"==a.method)return R.getUserscriptById(a.nid).done(function(d){if(d){if("installed"==a.actionid)"false"==a.value&&R.uninstall(d).always(f);else if("enabled"==a.actionid)R.setEnabled(d,a.value).always(f);else if("imported"==a.actionid&&"true"==a.value){var g=R.getUserscriptSource(d);g?v.doSave({src:g,ask:!0,replace:!0}).done(function(a){if(a.installed){if("disable"==h.values.native_import_post_action){R.setEnabled(d,!1).always(f);return}if("uninstall"==h.values.native_import_post_action){R.uninstall(d).always(f);
return}}f()}).fail(f):chrome.tabs.sendMessage(b.tab.id,{method:"showMsg",msg:e.getMessage("Please_double_check_the_native_script_import_settings__")},function(a){})}f()}else c({})}).fail(f),!0;f()}},modifyNativeScript:{allow:{extpage:!0},exec:function(a,b,c){return ia.modifyScriptOptions.exec(a,b,c)}},saveScript:{allow:{extpage:!0},exec:function(a,b,c){var d=void 0===a.reload||!!a.reload,g=function(a){d?ea(function(b){a.items=b;a.options=h.values;c(a)}):c({})};if(a.clean){D&&console.debug("bg: clean userscript "+
a.uuid);b=w.getByUid(a.uuid);var f=function(b){ea(function(d){c({cleaned:b.installed,items:d,options:h.values});b.installed&&q.notifyClientListeners(a.uuid,null,function(b){b({storage:w.getStorageByUid(a.uuid)})})})};b.script&&b.cond?v.doSave({name:a.name,uuid:a.uuid,src:b.script.textContent,clean:!0,ask:!0,save:!0}).always(function(a){f(a||{installed:!1})}):(console.error(e.getMessage("fatal_error")+" ("+a.uuid+")!!!"),f({installed:!1}))}else a.code?(f=c,d&&(f=function(a){v.reorderScripts();g(a)}),
a.new_script&&(a.uuid=null),v.doSave({name:a.name,uuid:a.uuid,replace:!0,force_url:a.force_url,src:a.code,ask:!h.values.editor_easySave,lastModified:a.lastModified,save:!0}).always(function(a){f(a||{installed:!1})})):(w.setByUid(a.uuid,null),w.setStorageByUid(a.uuid,null),v.reorderScripts(),g({}))}},importFromJson:{allow:{extpage:!0},exec:function(a,b,c){var d=void 0===a.reload||!!a.reload,g=null;v.importFromJson(a.json).fail(function(a){g=a||e.getMessage("An_error_occured_during_import_")}).always(function(){var a=
{};g?(a.err=g,c(a)):d?ea(function(b){a.items=b;a.options=h.values;c(a)}):c(a)})}},askCom:{allow:{extpage:!0},exec:function(a,b,c){la.onMessage(a.data).always(function(a){c(a)})}},installScript:{allow:{insecure:!0},exec:function(a,b,c){if("undefined"!=typeof b.tab){var d={};v.installFromUrl(a.url).done(function(a){d={data:null,found:!0,installed:a}}).fail(function(){chrome.tabs.sendMessage(b.tab.id,{method:"showMsg",msg:e.getMessage("Unable_to_get_UserScript__Sry_"),id:a.id},function(a){})}).always(function(){c(d)})}else console.log(e.getMessage("Unable_to_install_script_due_to_empty_tabID_"))}},
registerMenuCmd:{allow:{script:!0},exec:function(a,b,c){"undefined"!=typeof b.tab?(G.add({tabId:b.tab.id,url:b.tab.url,name:a.name,accessKey:a.accessKey,id:a.menuId,response:c}),ua()):(console.log("Unable to register menu cmd due to empty tabID!"),c({run:!1}))}},unRegisterMenuCmd:{allow:{script:!0},exec:function(a,b,c){G.clearById(a.id);c({});ua()}},execMenuCmd:{allow:{extpage:!0},exec:function(a,b,c){(a=G.getById(a.id))?a.response({run:!0,menuId:a.id}):console.error("bg: Error: unable to find MC id "+
a.id);c({})}},getWebRequestInfo:{allow:{script:!0},exec:function(a,b,c){"undefined"!=typeof b.tab?c({webRequest:y}):(console.log("Unable to run scripts due to empty tab id"),c({}))}},unLoad:{allow:{script:!0},exec:function(a,b,c){a.topframe||a.id&&t.events.unload(b.tab.id,b.tab.frameId,a.id)}},prepare:{allow:{script:!0},exec:function(a,b,c){if("undefined"!=typeof b.tab&&0<=b.tab.index){var d=a.topframe?0:null,g=a.url+a.params,f=0==h.values.forbiddenPages.length||v.validUrl(g,{exc:h.values.forbiddenPages}),
e=t.events.prepare(b.tab.id,d,a.id,g);if(f){if(e){f={enabledScriptsCount:e,raw:{},webRequest:y,logLevel:h.values.logLevel,unsafeWindow:h.values.runtime_unsafeWindow};if(a.raw)for(e=0;e<a.raw.length;e++)f.raw[a.raw[e]]=Registry.getRaw(a.raw[e]);c(f)}else c({logLevel:h.values.logLevel});t.events.run(b.tab.id,d,a.id,g,function(){J.setIcon(b.tab.id);J.setBadge(b.tab.id)});I.tab.resetFireCnt(b.tab.id)}else console.log("Forbidden page: '"+g+"' -> Do nothing!"),a.id&&t.set.forbidden(b.tab.id,d,a.id),c({})}else c({});
return!1}},scriptBlockerDetected:{allow:{script:!0},exec:function(a,b,c){a.xml_style_detected||-1!=a.url.search(".xml$")?console.warn("blocker: unable to get unsafeWindow..."):L.requestPermissionEx(function(a,b){var f=a&&b?e.getMessage("Please_reload_this_page_in_order_to_run_your_userscripts_"):null;c({alert:f})});t.set.blocker(b.tab.id);J.setIcon(b.tab.id)}},startFireUpdate:{allow:{extpage:!0},exec:function(a,b,c){I.checkUpdate(!0,a.force,function(a){c({suc:a})})}},getFireItems:{allow:{extpage:!0},
exec:function(a,b,c){var d=function(b,d,e){void 0==d&&(d=null);var g=function(a){try{c({image:a,cnt:b,scripts:d,progress:e,options:{fire_sort_cache_enabled:h.values.fire_sort_cache_enabled}}),d=[]}catch(g){console.warn("bg: warn: action menu closed? "+JSON.stringify(g))}};a.countonly?g(null):za.createIconEx(b,g)};if(!I.isReady())return d(0,[],{action:I.status.action,state:I.status.progress}),!0;var e=function(b){var c=Ga(a,b);d(b.length,c)};a.tabid?a.countonly?I.tab.getCount(a.tabid,d):I.tab.getItems(a.tabid,
e):a.url?"*"==a.url?I.getMax("scripts","sid",function(a){for(var b=[],c=0;1E3>c;c++)b.push(Math.floor(Math.random()*a+1).toString());I.ids.getItems(b,e)}):a.countonly?I.url.getCount(a.url,d):I.url.getItems(a.url,e):d([],[])}},notification:{allow:{script:!0,extpage:!0},exec:function(a,b,c){b=a.image&&""!=a.image?a.image:chrome.extension.getURL("images/icon128.png");P.show(a.title,a.msg,b,a.delay,function(a){c({clicked:a.clicked})})}},localFileCB:{allow:{script:!0},exec:function(a,b,c){z.useIframeMessage||
z.listener(null,a.data);c({})}},handler:function(a,b,c){if(!F.late)return F.registerLateCallback(function(){ia.handler(a,b,c)}),!0;var d=ia[a.method];if(d)if(d.allow&&d.exec){var e=p.SELF.ID,e=!p.REQUESTS.HAS_SENDER_ID&&b.tab||b.id===e,f=null,h=p.REQUESTS.INTERNAL_PAGE_URL,m=p.REQUESTS.GET_INTERNAL_PAGE_REGEXP(),h=e&&(!b.tab||0==b.tab.url.search(h));e&&h&&(b.tab?(m=b.tab.url.match(m))&&2==m.length&&(f=m[1]):f="*",b.extpage=f);if("background"==f||d.allow.insecure||d.allow.extpage&&h||d.allow.options&&
"options"==f||d.allow.script&&e&&!h){if(d=d.exec(a,b,c),void 0!==d)return d}else return D&&console.warn("back: this context doesn't have the permission to call '"+a.method+"' "),!1}else return console.log("b: invalid implementation of "+a.method),!1;else return console.log("back: unknown method "+a.method),!1;return!0}},Ha=function(){var a=[],b=["test"],c=!1;return{getLayouts:function(){c||(a.push({name:e.getMessage("Default"),value:"default"}),b.forEach(function(b){Registry.getRaw("layout/"+b+"/options.js")&&
a.push({name:b.charAt(0).toUpperCase()+b.slice(1),value:b})}),c=!0);return a}}}(),G={commands:[],add:function(a){G.commands.push(a)},list:function(){var a=[],b;for(b in G.commands)G.commands.hasOwnProperty(b)&&a.push(G.commands[b]);return a},listByTabId:function(a){var b=[],c;for(c in G.commands)if(G.commands.hasOwnProperty(c)){var d=G.commands[c];if(d.tabId==a){for(var e=!1,f=0;f<b.length;f++)if(b[f].name==d.name){e=!0;break}e||b.push(d)}}return b},clearByTabId:function(a){G.getByTabId(a)},getByTabId:function(a){var b=
[],c=G.commands;G.commands=[];for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];e.tabId!=a?G.commands.push(e):b.push(e)}return b},clearById:function(a){G.getById(a)},getById:function(a){var b=null,c=G.commands;G.commands=[];for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];e.id!=a?G.commands.push(e):b=e}return b}},Ga=function(a,b){var c=[],d="http://...";a.tabid&&!t.get.empty(a.tabid)?A.each(t.get.urls(a.tabid),function(a,b){d=b;return!0}):a.url&&(d=a.url);var g=b.length?" ("+b.length+")":"",g={name:e.getMessage("Available_Userscripts")+
g,main_menu_item:!0,scriptTab:!0};g.items=wa(b,!1,!0);c.push(g);var g={name:e.getMessage("Settings"),main_menu_item:!0},f={name:e.getMessage("General"),sub_menu_item:!0},h="",m="",l=U.getConfig();if(0==l.fire.db_version)m="?";else var n=1E3*l.fire.db_version,m=(new Date(n)).toString();h+=e.getMessage("Current_Index_")+":<br><br>";h+=e.getMessage("Date_")+": "+m+"<br>";h+=e.getMessage("Entries_")+": "+(l.fire.entries?l.fire.entries:"?")+"<br><br><br>";f.items=[{name:"TamperFire DB",fire:!0,fireInfo:!0,
value:h,versionDB:n},{name:e.getMessage("Check_for_Updates"),fname:e.getMessage("Force_Update"),fire:!0,fireUpdate:!0}];g.items=[f];c.push(g);c.push({name:"Search by URL",id:"searchByURL",search:!0,value:d,desc:""});return c},Fa=function(a){var b=a?a.url:null,c=b&&4<b.length&&""==b.substr(0,4).replace(/file|http/,"")?b:"",d=[],g={name:"enabled",sub_menu_item:!0,pos:"top",items:[]};g.items.push({name:e.getMessage("Enabled"),display:h.values.enabled?null:"greyed",id:"enabled",button:!0,reload:!0,enabler:!0});
d.push(g);if(h.values.fire_enabled){var g={name:"fire",sub_menu_item:!0,pos:"top",items:[]},f=null,f=h.values.fire_topOnly?chrome.extension.getURL("fire.html?url="+encodeURIComponent(b)):chrome.extension.getURL("fire.html?tab="+a.id);g.items.push({name:e.getMessage("_0_scripts_found"),image:"download",doneImage:"fire",tabid:a.id,tamperfire:!0,url:f,newtab:!0});d.push(g)}g={name:"scripts",sub_menu_item:!0,pos:"right",items:[]};f=xa(a);g.items=g.items.concat(f);h.values.enabled&&!f.length&&b&&(0==h.values.forbiddenPages.length||
v.validUrl(b,{exc:h.values.forbiddenPages})?g.items.push({name:e.getMessage("No_script_is_running"),image:"info"}):g.items.push({name:e.getMessage("This_page_is_blacklisted_at_the_security_settings"),image:"critical"}));h.values.enabled&&(100>h.values.configMode||!f.length)&&(g.items.push({name:e.getMessage("Get_new_scripts___"),image:"script_download",url:"http://userscripts.org",newtab:!0}),g.items.push({name:e.getMessage("Add_new_script___"),image:"script_add",url:chrome.extension.getURL("options.html")+
"?url="+encodeURIComponent(c)+"#open=new-user-script",newtab:!0}));d.push(g);b={name:"commands",id:"commands",sub_menu_item:!0,pos:"left",items:[]};g=a.id;a=[];var g=null==g||void 0==g?G.list():G.listByTabId(g),k;for(k in g)g.hasOwnProperty(k)&&(f=g[k],a.push({name:f.name,id:f.id,accessKey:f.accessKey,image:"menu_cmd",menucmd:!0}));a.length&&(b.items=a);b.items.push({name:e.getMessage("Check_for_userscripts_updates"),id:"run_script_updates",button:!0,image:"update"});b.items.push({name:e.getMessage("Report_a_bug"),
image:"bug",url:"http://tampermonkey.net/bug",newtab:!0});b.items.push({name:e.getMessage("Please_consider_a_donation"),image:"donation",url:"http://tampermonkey.net/donate.html",newtab:!0});d.push(b);k={name:"about",sub_menu_item:!0,pos:"bottom",items:[]};k.items.push({name:e.getMessage("Dashboard"),image:"utilities",url:chrome.extension.getURL("options.html")+"?"+["url="+encodeURIComponent(c),"selected=dashboard"].join("&"),newtab:!0});c="version="+chrome.extension.getVersion()+"&ext="+p.SELF.ID.substr(0,
4);k.items.push({image:"info",urls:[{name:" "+e.getMessage("Help"),url:"http://tampermonkey.net/faq.php?"+c,newtab:!0},{name:" "+e.getMessage("Changelog"),url:"http://tampermonkey.net/changelog.php?"+c,newtab:!0}]});d.push(k);return d},ea=function(a){var b=[],c;b.push({name:"Version",id:null,version:!0,value:chrome.extension.getVersion()});chrome.extension.inIncognitoContext&&"temporary"==h.values.incognito_mode&&b.push({globalhint:!0,image:"critical",value:e.getMessage("All_modifications_are_only_kept_until_this_incognito_session_is_closed_")});
ga.getWarnings().forEach(function(a){b.push({globalhint:!0,image:"critical",value:a.text,description:a.description,info_url:a.url})});var d={name:e.getMessage("Installed_userscripts"),main_menu_item:!0,scriptTab:!0,id:"dashboard"};R.getAllUserscripts().always(function(g){g=g||[];var f=xa(null,!0);c=f.length;g.forEach(function(a){f.push({name:a.name,uuid:a.id,icon:a.icon,code:null,position:0,positionof:c,enabled:a.enabled,version:a.version,description:a.description,nativeScript:!0})});f.push({name:e.getMessage("No_script_is_installed"),
image:"info",visible:!c});f.push({name:e.getMessage("Get_some_scripts___"),image:"edit_add",url:"http://userscripts.org",newtab:!0,visible:!c});f.push({name:e.getMessage("New_userscript"),id:null,image:"script_add",icon:chrome.extension.getURL("images/txt.png"),code:h.values.scriptTemplate,nnew:!0,uuid:"new-user-script",position:-1,positionof:c,enabled:!0,userscript:!0});d.items=f;b.push(d);g={name:e.getMessage("Settings"),main_menu_item:!0,id:"settings",selected_default:!0};var k,m,l,n,q,u,r,v,t,
x,w,y;r=null;k={name:e.getMessage("General"),sub_menu_item:!0,items:[]};k.items.push({name:e.getMessage("Config_Mode"),id:"configMode",level:0,option:!0,select:[{name:e.getMessage("Novice"),value:0},{name:e.getMessage("Beginner"),value:50},{name:e.getMessage("Advanced"),value:100}],value:h.values.configMode,desc:e.getMessage("Changes_the_number_of_visible_config_options")});k.items.push({name:e.getMessage("Language"),id:"i18n",level:0,option:!0,reload:!0,warning:{msg:e.getMessage("A_reload_is_required")},
select:[{name:"Browser Default",value:null},{name:e.getOriginalMessage("English"),value:"en"},{name:e.getOriginalMessage("German"),value:"de"},{name:e.getOriginalMessage("French"),value:"fr"},{name:e.getOriginalMessage("Italian"),value:"it"},{name:e.getOriginalMessage("Russian"),value:"ru"},{name:e.getOriginalMessage("Spanish"),value:"es"},{name:e.getOriginalMessage("Polish"),value:"pl"},{name:e.getOriginalMessage("Portuguese_Brazil"),value:"pt-br"},{name:e.getOriginalMessage("Chinese__Simplified_"),
value:"zh_CN"},{name:e.getOriginalMessage("Chinese__Traditional_"),value:"zh_TW"},{name:e.getOriginalMessage("Japanese"),value:"ja"}],value:h.values.i18n,validation:{image:"info",msg:e.getMessage("Your_language_is_not_supported__Click_here_to_get_intructions_how_to_translate_TM_"),url:"http://tampermonkey.net/faq.php#Q500"}});k.items.push({name:e.getMessage("Make_includes_more_safe"),id:"safeUrls",level:60,option:!0,checkbox:!0,enabled:h.values.safeUrls,desc:e.getMessage("Includes_more_safe_example")});
k.items.push({name:e.getMessage("Fix_includes"),id:"tryToFixUrl",level:60,option:!0,checkbox:!0,enabled:h.values.tryToFixUrl,desc:e.getMessage("Fix_includes_example")});k.items.push({name:e.getMessage("Auto_reload_on_script_enabled"),level:20,id:"autoReload",option:!0,checkbox:!0,enabled:h.values.autoReload,desc:e.getMessage("Auto_reload_on_script_enabled_desc")});k.items.push({name:e.getMessage("Anonymous_statistics"),level:0,id:"statistics_enabled",option:!0,checkbox:!0,enabled:h.values.statistics_enabled,
desc:e.getMessage("Allow_Tampermonkey_to_collect_anonymous_statistics_via_Google_Analytics")});k.items.push({name:e.getMessage("Debug_scripts"),level:100,id:"debug",option:!0,checkbox:!0,enabled:h.values.debug,desc:""});k.items.push({name:e.getMessage("Show_fixed_source"),level:100,id:"showFixedSrc",option:!0,checkbox:!0,enabled:h.values.showFixedSrc,desc:""});k.items.push({name:e.getMessage("LogLevel"),id:"logLevel",level:0,option:!0,select:[{name:e.getMessage("Debug"),value:60},{name:e.getMessage("Error"),
value:0}],value:h.values.logLevel,desc:""});m={name:e.getMessage("Native_Script_Import"),sub_menu_item:!0,need_save:!0,items:[]};r={};h.values.native_import&&(r=!0===p.RUNTIME.ALLOWS_FILE_SCHEME_ACCESS?{image:"button_ok",msg:e.getMessage("TM_has_access_to_file_URIs")}:{image:"critical",msg:e.getMessage("Tampermonkey_needs_access_to_file_URIs__Visit_the_FAQ_"),url:"http://tampermonkey.net/faq.php#Q204"});m.items.push({name:e.getMessage("Enable_Native_Script_Import"),id:"native_import",level:0,option:!0,
checkbox:!0,enabled:h.values.native_import,validation:r});m.items.push({name:e.getMessage("Post_Import_Action"),id:"native_import_post_action",level:0,option:!0,select:[{name:e.getMessage("None"),value:"none"},{name:e.getMessage("Disable_Extension"),value:"disable"},{name:e.getMessage("Uninstall_Extension"),value:"uninstall"}],value:h.values.native_import_post_action,desc:e.getMessage("What_action_should_be_done_after_a_native_userscript_was_imported_sucessfully_")});r={};h.values.native_import&&
(r=R.isPathValid()?{image:"button_ok",msg:e.getMessage("Everything_is_setup_correctly_")}:{image:"critical",msg:e.getMessage("Tampermonkey_needs_to_know_the_absolute_path_to_your_browser_profile_folder_Visit_the_FAQ_"),url:"http://tampermonkey.net/faq.php#Q205"});m.items.push({name:e.getMessage("Browser_Profile_Path"),id:"native_import_path",level:0,option:!0,text:!0,width:2,value:h.values.native_import_path,validation:r});p.OPTIONS.HAS_TESLA&&(w={name:e.getMessage("TESLA")+" BETA",sub_menu_item:!0,
level:50,need_save:!0,desc:e.getMessage("Tampermonkey_External_Script_List_Access"),items:[]},w.items.push({name:e.getMessage("Enable_TESLA"),id:"sync_enabled",level:50,option:!0,checkbox:!0,enabled:h.values.sync_enabled,desc:e.getMessage("Tampermonkey_External_Script_List_Access")}),w.items.push({name:e.getMessage("Sync_Type"),id:"sync_type",enabler:!0,level:50,option:!0,select:[{name:"pastebin.com",value:K.types.ePASTEBIN},{name:"Chrome Sync (Beta)",value:K.types.eCHROMESYNC,enable:{sync_id:0,create_tesla_data:0}}],
value:h.values.sync_type}),w.items.push({name:e.getMessage("Sync_Id"),id:"sync_id",enabledBy:"sync_type",level:50,text:!0,value:h.values.sync_id,option:!0}),w.items.push({name:e.getMessage("Create_Exportable_Data"),id:"create_tesla_data",enabledBy:"sync_type",button:!0,ignore:!0,level:60,warning:{msg:e.getMessage("Copy_exportable_data_to_clipboard_Ok_")}}));q={name:e.getMessage("Appearance"),sub_menu_item:!0,items:[]};q.items.push({name:e.getMessage("Layout"),id:"layout",level:0,option:!0,select:Ha.getLayouts(),
value:h.values.layout,desc:""});r={};"off"==h.values.notification_showUpdate&&(r={image:"critical",msg:e.getMessage("Are_you_sure_that_you_don_t_want_to_be_notified_of_updates_")});q.items.push({name:e.getMessage("Update_Notification"),id:"notification_showUpdate",level:50,option:!0,select:[{name:e.getMessage("Off"),value:"off"},{name:e.getMessage("Show_notification"),value:"notification"},{name:e.getMessage("Open_changelog"),value:"changelog"}],value:h.values.notification_showUpdate,validation:r});
q.items.push({name:e.getMessage("Icon_badge_info"),id:"appearance_badges",level:50,option:!0,select:[{name:e.getMessage("Off"),value:"off"},{name:e.getMessage("Running_scripts"),value:"running"},{name:e.getMessage("Unique_running_scripts"),value:"running_unique"},{name:e.getMessage("Disabled_scripts"),value:"disabled"},{name:"TamperFire",value:"tamperfire"}],value:h.values.appearance_badges,desc:""});p.OPTIONS.HAS_TAMPERFIRE&&(t={name:e.getMessage("TamperFire"),sub_menu_item:!0,items:[]},t.items.push({name:e.getMessage("Enable_TamperFire"),
id:"fire_enabled",level:0,option:!0,checkbox:!0,enabled:h.values.fire_enabled,desc:""}),t.items.push({name:e.getMessage("Use_top_frame_URL_only"),id:"fire_topOnly",level:0,option:!0,checkbox:!0,enabled:h.values.fire_topOnly,desc:""}),t.items.push({name:e.getMessage("Enable_Sort_Cache"),id:"fire_sort_cache_enabled",level:100,checkbox:!0,option:!0,enabled:h.values.fire_sort_cache_enabled,desc:""}),t.items.push({name:e.getMessage("Update_interval"),id:"fire_updatePeriod",level:50,option:!0,select:[{name:e.getMessage("Never"),
value:0},{name:e.getMessage("Every_Day"),value:864E5},{name:e.getMessage("Every_Week"),value:6048E5},{name:e.getMessage("Every_2_Weeks"),value:12096E5},{name:e.getMessage("Every_Month"),value:2592E6}],value:h.values.fire_updatePeriod,desc:""}));l={name:e.getMessage("Editor"),sub_menu_item:!0,level:20,items:[]};l.items.push({name:e.getMessage("Enable_Editor"),id:"editor_enabled",level:100,option:!0,checkbox:!0,enabled:h.values.editor_enabled,reload:!0,warning:{msg:e.getMessage("A_reload_is_required")},
desc:""});l.items.push({name:e.getMessage("Key_Mapping"),id:"editor_keyMap",level:50,option:!0,reload:!0,warning:{msg:e.getMessage("A_reload_is_required")},select:[{name:e.getMessage("Windows"),value:"windows"},{name:e.getMessage("Emacs"),value:"emacs"},{name:e.getMessage("Vim"),value:"vim"}],value:h.values.editor_keyMap});l.items.push({name:e.getMessage("Indentation_Width"),id:"editor_indentUnit",level:50,option:!0,select:[{name:e.getMessage("1"),value:1},{name:e.getMessage("2"),value:2},{name:e.getMessage("3"),
value:3},{name:e.getMessage("4"),value:4},{name:e.getMessage("5"),value:5},{name:e.getMessage("6"),value:6},{name:e.getMessage("7"),value:7},{name:e.getMessage("8"),value:8},{name:e.getMessage("9"),value:9},{name:e.getMessage("10"),value:10},{name:e.getMessage("11"),value:11}],value:h.values.editor_indentUnit,desc:""});l.items.push({name:e.getMessage("Indent_with"),id:"editor_indentWithTabs",level:50,option:!0,select:[{name:e.getMessage("Tabs"),value:"tabs"},{name:e.getMessage("Spaces"),value:"spaces"}],
value:h.values.editor_indentWithTabs,desc:""});l.items.push({name:e.getMessage("TabMode"),id:"editor_tabMode",level:50,option:!0,select:[{name:e.getMessage("Classic"),value:"classic"},{name:e.getMessage("Smart"),value:"smart"}],value:h.values.editor_tabMode,desc:""});l.items.push({name:e.getMessage("Reindent_on_typing"),id:"editor_electricChars",level:50,option:!0,checkbox:!0,enabled:h.values.editor_electricChars,desc:""});l.items.push({name:e.getMessage("Enable_autoSave"),id:"editor_autoSave",level:20,
option:!0,checkbox:!0,enabled:h.values.editor_autoSave,desc:""});l.items.push({name:e.getMessage("Enable_easySave"),id:"editor_easySave",level:20,option:!0,checkbox:!0,enabled:h.values.editor_easySave,desc:""});n={name:e.getMessage("Script_Update"),sub_menu_item:!0,level:0,items:[]};n.items.push({name:e.getMessage("Check_disabled_scripts"),id:"scriptUpdateCheckDisabled",level:0,option:!0,checkbox:!0,enabled:h.values.scriptUpdateCheckDisabled,desc:""});n.items.push({name:e.getMessage("Check_interval"),
id:"scriptUpdateCheckPeriod",level:0,option:!0,select:[{name:e.getMessage("Never"),value:0},{name:e.getMessage("Every_Hour"),value:36E5},{name:e.getMessage("Every_6_Hours"),value:216E5},{name:e.getMessage("Every_12_Hour"),value:432E5},{name:e.getMessage("Every_Day"),value:864E5},{name:e.getMessage("Every_Week"),value:6048E5}],value:h.values.scriptUpdateCheckPeriod,desc:""});n.items.push({name:e.getMessage("Dont_ask_me_for_simple_script_updates"),id:"notification_silentScriptUpdate",level:80,option:!0,
checkbox:!0,enabled:h.values.notification_silentScriptUpdate,desc:""});n.items.push({name:e.getMessage("Hide_notification_after"),id:"scriptUpdateHideNotificationAfter",level:50,option:!0,select:[{name:e.getMessage("Never"),value:0},{name:e.getMessage("15_Seconds"),value:15E3},{name:e.getMessage("30_Seconds"),value:3E4},{name:e.getMessage("1_Minute"),value:6E4},{name:e.getMessage("5_Minutes"),value:3E5},{name:e.getMessage("1_Hour"),value:36E5}],value:h.values.scriptUpdateHideNotificationAfter,desc:""});
p.RUNTIME.NEED_UNSAFEWINDOW_PROXY&&(r="auto"==h.values.runtime_unsafeWindow?{}:{image:"critical",msg:e.getMessage("This_option_is_essential_for_many_userscripts_to_work__Visit_the_FAQ_"),url:"http://tampermonkey.net/faq.php#Q404"},v={name:e.getMessage("Runtime"),sub_menu_item:!0,level:50,items:[]},v.items.push({name:e.getMessage("UnsafeWindow_retrieval_method"),id:"runtime_unsafeWindow",level:50,option:!0,select:[{name:e.getMessage("Auto"),value:"auto"},{name:e.getMessage("Native"),value:"native"},
{name:e.getMessage("Sandbox"),value:"sandbox"}],value:h.values.runtime_unsafeWindow,desc:e.getMessage("A_lot_of_userscripts_require_the_unsafeWindow_object_to_interact_with_the_pages_javascript_"),validation:r}));u={name:e.getMessage("Security"),sub_menu_item:!0,level:50,items:[]};p.OPTIONS.HAS_CSP&&(u.items.push({name:e.getMessage("Allow_overwrite_javascript_settings"),id:"scriptblocker_overwrite",level:50,option:!0,select:[{name:e.getMessage("Yes"),value:"yes"},{name:e.getMessage("No"),value:"no"}],
value:h.values.scriptblocker_overwrite,desc:e.getMessage("Tampermonkey_can_not_work_when_javascript_is_disabled")}),u.items.push({name:e.getMessage("Add_TM_to_CSP"),id:"webrequest_fixCSP",level:50,option:!0,select:[{name:e.getMessage("Yes"),value:"yes"},{name:e.getMessage("No"),value:"no"}],value:h.values.webrequest_fixCSP,desc:e.getMessage("Tampermonkey_might_not_be_able_to_provide_access_to_the_unsafe_context_when_this_is_disabled")}),u.items.push({name:e.getMessage("Allow_headers_to_be_modified_by_scripts"),
id:"webrequest_modHeaders",level:50,option:!0,select:[{name:e.getMessage("Yes"),value:"yes"},{name:e.getMessage("Auto"),value:"auto"},{name:e.getMessage("No"),value:"no"}],value:h.values.webrequest_modHeaders,desc:""}));chrome.extension.inIncognitoContext||(r="temporary"==h.values.incognito_mode?{}:{image:"critical",msg:"Permanent mode is still a BETA feature!"},u.items.push({name:e.getMessage("Store_data_in_incognito_mode"),id:"incognito_mode",level:50,option:!0,select:[{name:e.getMessage("Temporary"),
value:"temporary"},{name:e.getMessage("Permanent"),value:"permanent"}],value:h.values.incognito_mode,validation:r}));u.items.push({name:e.getMessage("Forbidden_Pages"),id:"forbiddenPages",level:50,option:!0,input:!0,array:!0,value:h.values.forbiddenPages,desc:""});r={name:e.getMessage("BlackCheck"),sub_menu_item:!0,level:50,items:[]};r.items.push({name:e.getMessage("Script_Blacklist_Source"),id:"script_blacklist_type",level:50,option:!0,select:[{name:e.getMessage("Off"),value:"off"},{name:e.getMessage("Server_And_Manual"),
value:"server"},{name:e.getMessage("Only_Manual"),value:"only_manual"}],value:h.values.script_blacklist_type});r.items.push({name:e.getMessage("Blacklist_Severity"),id:"script_blacklist_severity",level:0,option:!0,select:[{name:e.getMessage("severity_1"),value:1},{name:e.getMessage("severity_2"),value:2},{name:e.getMessage("severity_3"),value:3},{name:e.getMessage("severity_4"),value:4},{name:e.getMessage("severity_5"),value:5},{name:e.getMessage("severity_6"),value:6},{name:e.getMessage("severity_7"),
value:7},{name:e.getMessage("severity_8"),value:8},{name:e.getMessage("severity_9"),value:9},{name:e.getMessage("severity_10"),value:10}],value:h.values.script_blacklist_severity});r.items.push({name:e.getMessage("Manual_Script_Blacklist"),id:"require_blacklist",level:50,option:!0,input:!0,array:!0,value:h.values.require_blacklist,desc:""});x={name:e.getMessage("Userscripts"),sub_menu_item:!0,level:80,items:[]};x.items.push({name:e.getMessage("New_script_template_"),id:"scriptTemplate",level:80,option:!0,
input:!0,value:h.values.scriptTemplate});y={name:e.getMessage("Reset_Section"),sub_menu_item:!0,level:50,items:[]};y.items.push({name:e.getMessage("Restart_Tampermonkey"),id:"reset_simple",level:50,button:!0,reload:!0,value:0,warning:{msg:e.getMessage("This_will_restart_Tampermonkey_Ok_")}});y.items.push({name:e.getMessage("Factory_Reset"),id:"reset_factory",level:80,button:!0,reload:!0,value:0,warning:{msg:e.getMessage("This_will_remove_all_scripts_and_reset_all_settings_Ok_")}});y.items.push({name:e.getMessage("Chrome_Sync_Reset"),
id:"reset_chrome_sync",level:80,button:!0,reload:!0,value:0,warning:{msg:e.getMessage("This_will_remove_all_stored_data_from_google_sync_Ok_")}});fa&&y.items.push({name:e.getMessage("Install_Tests"),id:"install_tests",level:80,button:!0,reload:!1,ignore:!0,value:0,warning:{msg:e.getMessage("This_will_install_a_lot_of_test_scripts_")}});g.items=A.select([k,q,n,v,w,m,t,l,u,r,x,y],function(a){return!!a});b.push(g);a&&a(b)})},wa=function(a,b,c){var d=[],e;for(e in a){var f=a[e],k;k=b||c?f:{name:f.name,
uuid:f.uuid,system:f.system,enabled:f.enabled,position:f.position};k.blacklisted=f.evilness>=h.values.script_blacklist_severity;k.file_url=f.downloadURL||f.fileURL;k.positionof=a.length;k.userscript=f.options.user_agent?!1:!0;k.user_agent=f.options.user_agent;b&&(k.origin=v.determineOrigin(f));f.icon64||f.icon||(k.icon64=chrome.extension.getURL(k.user_agent?"images/user_agent.png":"images/txt.png"));if(f.options){var m=new Z.Script,l;for(l in m.options)m.options.hasOwnProperty(l)&&(k[l]=f.options[l])}if(b||
c)k.code=f.textContent,k.sync=f.sync,b&&h.values.showFixedSrc&&(k.code=ha.mkCompat(f.textContent,f,!1));d.push(k)}return d},xa=function(a,b){void 0==b&&(b=!1);var c=a?a.url:null,d=[];a?t.get.empty(a.id)?console.warn("bg: WARN: Tabs.get.urls["+a.id+"] is empty!"):A.each(t.get.urls(a.id),function(a,b){for(var c=v.determineScriptsToRun(b),e=0;e<c.length;e++){for(var h=!1,l=0;l<d.length;l++)if(d[l].name==c[e].name){h=!0;break}h||d.push(c[e])}}):d=v.determineScriptsToRun(c);return wa(d,b)},ma={copy:function(a){var b=
document.createElement("iframe");document.body.appendChild(b);try{b.contentDocument.designMode="on","html"==a.type?(b.setAttribute("sandbox","allow-same-origin"),b.contentDocument.documentElement.innerHTML=a.content,b.contentDocument.execCommand("selectAll",!1,null)):b.contentDocument.oncopy=function(b){b.clipboardData.setData(a.mimetype||"text/plain",a.content);b.preventDefault()},b.contentDocument.execCommand("copy",!1,null),b.contentDocument.designMode="off"}catch(c){console.error("bg: clipboard Error: "+
c.message)}b.parentNode.removeChild(b);b=null}};clip=ma;var C={permContentSettings:"contentSettings",permStorage:"storage",permissions:null,lock:!1,clear:function(){C.lock&&console.log("perm: clear, but locked");C.permissions=null},get:function(a){C.lock=!0;C.permissions={};chrome.permissions.getAll(function(b){A.each(b.permissions,function(a,b){C.permissions[a]=!0});C.lock=!1;a&&a()})},has:function(a,b){C.lock?window.setTimeout(function(){C.has(a,b)},50):C.permissions?b&&b(!!C.permissions[a]):C.get(function(){C.has(a,
b)})},ask:function(a,b,c,d){var e=chrome.extension.getURL("images/icon128.png");P.getPermission(b,c,e,6E4,a,function(b){b.granted?(C.permissions||(C.permissions={}),C.permissions[a]=!0,d&&d(b.granted)):d&&d(!1)})},remove:function(a,b){chrome.permissions.remove({permissions:[a]},function(c){C.permissions&&(C.permissions[a]=!1);b&&b(c)})}};perm=C;var L={asked:!1,runCheck:!1,hasPermission:!1,init:function(){C.has(C.permContentSettings,function(a){L.hasPermission=a;L.runCheck=L.hasPermission&&"yes"==
h.values.scriptblocker_overwrite;D&&console.log("bg: contentSettings: runCheck = "+L.runCheck+" hasPerm = "+L.hasPermission)})},askForPermission:function(a){C.ask(C.permContentSettings,e.getMessage("A_script_blocker_was_detected_"),e.getMessage("Click_here_to_allow_TM_to_override_the_script_blocker"),a)},requestPermissionEx:function(a){if("yes"!=h.values.scriptblocker_overwrite)a&&a();else{var b=function(b){a&&a(b,!0);b&&!L.runCheck&&(L.runCheck=!0,ca.reset())};C.has(C.permContentSettings,function(c){L.asked?
a&&a(c,!1):c?a(c,!1):L.askForPermission(b);L.asked=!0})}},remove:function(a){C.remove(C.permContentSettings,a)}},ca={run:function(a,b){var c=1,d=function(){0==--c&&(b&&b(),window.location.reload())};if("config"==a){var e=q.listValues(),f;for(f in e){var h=e[f];-1!=h.search(p.CONSTANTS.PREFIX.SCRIPT)&&-1!=h.search(p.CONSTANTS.PREFIX.COND)&&-1!=h.search(p.CONSTANTS.PREFIX.STORE)&&-1!=h.search(p.CONSTANTS.PREFIX.META)&&(c++,q.deleteValue(h).always(d))}}else"factory"==a&&(I.isReady()&&(c++,I.clean(d)),
L.hasPermission&&(c++,L.remove(d)),c++,q.factoryReset().always(d));d()},reset:function(a){ca.run(null,a)},factoryReset:function(a){ca.run("factory",a)},configReset:function(a){ca.run("config",a)}},J={t:500,tob:{},toi:{},setIcon:function(a,b){J.toi[a]&&window.clearTimeout(J.toi[a]);J.toi[a]=window.setTimeout(function(){J.setIconInternal(a,b);delete J.toi[a]},J.t)},setIconInternal:function(a,b){void 0==b&&(b=h);var c,d;d=null;var g=c=!1,f=!1;a&&!t.get.empty(a)&&(c=t.get.blocker(a),g=t.get.stats(a).running,
f=t.get.forbidden(a));f?(b.images.icon="images/icon_grey_forbidden.png",d=e.getMessage("At_least_one_part_of_this_page_is_listed_at_the_forbidden_pages_setting_")):c?(b.images.icon="images/icon_grey_blocker.png",d=e.getMessage("Some_scripts_might_be_blocked_by_the_javascript_settings_for_this_page_or_a_script_blocker_")):b.images.icon=g?"images/icon.png":"images/icon_grey.png";c={path:chrome.extension.getURL(b.images.icon)};d={title:d?d:chrome.extension.manifest.name};null!=a&&(c.tabId=a,d.tabId=
a);try{chrome.browserAction.setIcon(c),chrome.browserAction.setTitle(d)}catch(k){console.warn("bg: ERROR while setIcon! "+k.message)}},setBadge:function(a){J.tob[a]&&window.clearTimeout(J.tob[a]);J.tob[a]=window.setTimeout(function(){J.setBadgeInternal(a);delete J.tob[a]},J.t)},setBadgeInternal:function(a){var b=0,c=function(){D&&console.log("badge: set "+b);0==b?chrome.browserAction.setBadgeText({text:"",tabId:a}):chrome.browserAction.setBadgeText({text:b.toString(),tabId:a})};if("off"==h.values.appearance_badges)b=
0;else if("running"==h.values.appearance_badges)a&&!t.get.empty(a)&&(b=t.get.stats(a).running);else if("running_unique"==h.values.appearance_badges)a&&!t.get.empty(a)&&(b=t.get.stats(a,!0).unique);else if("disabled"==h.values.appearance_badges)a&&!t.get.empty(a)&&(b=t.get.stats(a).disabled);else if("tamperfire"==h.values.appearance_badges){var d=function(a){b=a;c()};if(!I.isReady()){d("?");return}I.tab.getCount(a,d);return}c()}},x={infoChanged:[],redirects:{},addInfoChangedListener:function(a){x.infoChanged.push(a)},
runInfoChangedListener:function(){for(var a=0;a<x.infoChanged.length;a++)x.infoChanged[a](y)},headerCheck:function(a){if(0<=a.tabId&&!1==y.verified){D&&console.log("bg: verify that webRequest is working at "+a.type+" to "+a.url);for(var b=!1,c=RegExp("^"+y.testprefix),d=0;d<a.requestHeaders.length;d++){var e=a.requestHeaders[d];0==e.name.search(c)&&(D&&console.log("bg: found "+e.name+" @webRequest :)"),b=!0)}if(b||!(0<y.verifyCnt--)){y.headers=b;y.verified=!0;x.runInfoChangedListener();D&&console.debug("bg: verified webRequest "+
(y.headers?"":"not ")+"being working");try{chrome.webRequest.onSendHeaders.removeListener(x.headerCheck)}catch(f){y.headers=!1,y.verified=!0,x.runInfoChangedListener()}}}},detectRedirectToCache:function(a){F.registerLateCallback(function(){x.detectRedirect(a)})},detectRedirect:function(a){var b=a.responseHeaders,c=a.requestId,d=!1,e=!1,f=!1,k="xmlhttprequest"==a.type,m="main_frame"==a.type||"sub_frame"==a.type;if(!k&&!m&&"no"==h.values.webrequest_fixCSP)return{};k&&x.redirects[c]&&(d=!0);for(var l=
0;l<b.length;l++){var n=b[l],q=n.name.toLowerCase();if("location"==q)if(m)e=!0;else{if(k){(function(){d&&window.clearTimeout(x.redirects[c].to);x.redirects[c]={url:n.value,to:window.setTimeout(function(){delete x.redirects[c]},1E4)}})();break}}else"yes"!=h.values.webrequest_fixCSP||"x-webkit-csp"!=q&&"x-content-security-policy"!=q&&"content-security-policy"!=q||(f=n.value.replace(/script-src /,"script-src "+p.REQUESTS.INTERNAL_PAGE_URL+p.SELF.ID+" 'unsafe-inline' 'unsafe-eval' "),D&&console.log('csp: replace "'+
n.value+'" with "'+f+'"'),n.value=f,b[l]=n,f=!0)}!e&&m&&t.events.response(a.tabId,a.frameId,a.url);k&&d&&(b.push({name:"TM-finalURL",value:x.redirects[c].url}),f=!0);return f?{responseHeaders:b}:{}},headerFix:function(a){t.get.empty(a.tabId);var b="main_frame"==a.type,c=L.runCheck;(b||"sub_frame"==a.type)&&c&&(c=B.parse(a.url).origin+"/*",chrome.contentSettings.javascript.set({primaryPattern:c,setting:"allow"}));var c=b&&t.get.user_agent(a.tabId,a.frameId),d=y.headers&&"xmlhttprequest"==a.type;if(!c&&
!d)return{};var e=!1,b={},f=[],h=RegExp("^"+y.prefix),l;c&&(l=t.get.user_agent(a.tabId,a.frameId));for(var p=0;p<a.requestHeaders.length;p++){var n=a.requestHeaders[p];d&&0==n.name.search(h)?f.push(n):c&&"user-agent"==n.name.toLowerCase()?(e=!0,b[n.name]=l):b[n.name]=n.value}if(d){for(p=0;p<f.length;p++)n=f[p],e=!0,b[n.name.replace(h,"")]=n.value;y.verified||(e=!0,b[y.testprefix]="true")}if(e){a=[];for(var q in b)b.hasOwnProperty(q)&&""!=q&&a.push({name:q,value:b[q]});return{requestHeaders:a}}return{}},
sucRequest:function(a){0<a.tabId&&console.log("bg: "+a.requestId+" print "+a.type+" request of tabId "+a.tabId+" to "+a.url)},checkRequestForUserscript:function(a){if(0<a.tabId&&"POST"!=a.method&&ra.isScriptUrl(a.url))return v.installFromUrl(a.url),{redirectUrl:"javascript:history.back()"};t.events.reset(a.tabId,!0);t.events.request(a.tabId,a.frameId,a.url);return{}},removeWebRequestListeners:function(){if(y.use)try{x.preCleanup(),chrome.webRequest.onBeforeRequest.removeListener(x.checkRequestForUserscript),
chrome.webRequest.onBeforeSendHeaders.removeListener(x.headerFix),chrome.webRequest.onHeadersReceived.removeListener(x.detectRedirect),y.headers&&!1==y.verified&&chrome.webRequest.onSendHeaders.removeListener(x.headerCheck)}catch(a){}y.headers=!1;y.verified=!0;x.runInfoChangedListener()},preInit:function(){y.use&&(x.tmp_cache=!0,chrome.webRequest.onHeadersReceived.addListener(x.detectRedirectToCache,{urls:["http://*/*","https://*/*"]},["responseHeaders","blocking"]),chrome.webRequest.handlerBehaviorChanged())},
preCleanup:function(){y.use&&x.tmp_cache&&(chrome.webRequest.onHeadersReceived.removeListener(x.detectRedirectToCache),delete x.tmp_cache)},init:function(a,b){if(y.use)try{x.preCleanup();var c={urls:["http://*/*","https://*/*"],types:["xmlhttprequest"]};chrome.webRequest.onBeforeRequest.addListener(x.checkRequestForUserscript,{urls:["http://*/*","https://*/*","file://*/*"],types:["main_frame"]},["blocking"]);chrome.webRequest.onBeforeSendHeaders.addListener(x.headerFix,{urls:["http://*/*","https://*/*",
"file://*/*"]},["requestHeaders","blocking"]);chrome.webRequest.onHeadersReceived.addListener(x.detectRedirect,{urls:["http://*/*","https://*/*"]},["responseHeaders","blocking"]);b&&(a||chrome.webRequest.onSendHeaders.addListener(x.headerCheck,c,["requestHeaders"]));chrome.webRequest.handlerBehaviorChanged();y.verified=a;y.headers=b;y.id=A.createUUID();y.testprefix=y.prefix+A.createUUID();y.prefix=y.prefix+y.id+"_";x.runInfoChangedListener()}catch(d){D&&console.error("bg: error initializing webRequests "+
d.message),x.removeWebRequestListeners()}},finalize:function(){x.removeWebRequestListeners()}},ja={retries:5,onCommitedListener:function(a){t.events.commited(a.tabId,a.frameId,a.url)},wait:function(){chrome.webNavigation&&chrome.webNavigation.onCommitted?chrome.webNavigation.onCommitted.addListener(ja.onCommitedListener):p.RUNTIME.OPERA||0==ja.retries--||(D&&console.log("bg: waitForWebNav()"),window.setTimeout(ja.wait,300))}},F={late:!1,callbacks:[],init:function(){},registerLateCallback:function(a){D&&
console.log("toea: register callback");F.callbacks.push(a)},setReady:function(){D&&console.debug("toea: run "+F.callbacks.length+" callbacks");F.late=!0;for(var a=0;a<F.callbacks.length;a++)F.callbacks[a]();F.callbacks=[]}},Ia=function(){var a=!1,b=null,c=function(){a||(D&&console.debug("Unloader.onbeforeunload()"),b&&b(),a=!0)};return{init:function(a){b=a;window.addEventListener("beforeunload",c,!1)}}}(),Aa=function(){var a=chrome.extension.getVersion(),b=null,c=!1,d=!1,g=function(){if(F.late){var f=
"version="+a+"&ext="+p.SELF.ID.substr(0,4)+"&updated=true",k;c?(k="http://tampermonkey.net/installed.php?"+f,d=!0):(f+="&old="+b,k="http://tampermonkey.net/changelog.php?"+f);"off"!=h.values.notification_showUpdate&&("notification"==h.values.notification_showUpdate?P.showUpdate(e.getMessage("Updated_to__0version0",a),e.getMessage("Click_here_to_see_the_recent_changes"),chrome.extension.getURL("images/icon128.png"),function(a){a.clicked&&chrome.tabs.create({url:k},function(){})}):"changelog"==h.values.notification_showUpdate&&
chrome.tabs.create({url:k,active:d},function(){}))}else F.registerLateCallback(g)},f=function(){var a=null,b,c=E(),d=function(d){b&&(d||null!==a)&&(d||window.clearTimeout(b),b=null,c.resolve(!!a))};chrome.idle.queryState(p.MISC.IDLE_TIMEOUT,function(b){a="active"==b;d()});b=window.setTimeout(function(){d(!0)},300);return c.promise()},k=function(a){F.late?(D&&console.log("onInstalled listener ",a),a||(a={reason:"mandatory_argument_is_not_set"}),"chrome_update"==a.reason?h.values.statistics_enabled&&
X.tB({updated:!0}):"install"!=a.reason&&"update"!=a.reason||u.scheduleNotification(a.previousVersion,"install"==a.reason)):F.registerLateCallback(function(){k(a)})},l=function(){var a=E(),b=function(){var b=(new Date).getTime(),c=q.getValue(p.CONSTANTS.STORAGE.LAST_START,0);a.resolve(b-c<=p.MISC.IDLE_TIMEOUT)};F.late?b():F.registerLateCallback(b);return a.promise()}(),s=function(){var a=!1,b=!1;f().then(function(a){b=a;return l}).then(function(b){a=b}).always(function(){d=!b||a;g();t=!0})},n=null,
t=!1,u={scheduleNotification:function(a,d){t||(b=a,c|=d,n&&window.clearTimeout(n),n=window.setTimeout(s,1E3))}};chrome.runtime&&chrome.runtime.onInstalled&&chrome.runtime.onInstalled.addListener(k);(function(){F.registerLateCallback(function(){q.setValue(p.CONSTANTS.STORAGE.LAST_START,(new Date).getTime())})})();return u}(),ya=function(a,b,c){F.late?(ra.isScriptUrl(c.url)&&v.installFromUrl(c.url),"loading"==b.status?t.events.loading(c.id,0,c.url):"complete"==b.status&&t.events.complete(c.id,0,c.url)):
window.setTimeout(function(){ya(a,b,c)},100)},Ja=function(a,b){t.events.remove(a)},sa=function(){var a="temporary"==h.values.incognito_mode&&chrome.extension.inIncognitoContext;q.setTemporary(a);a&&(h.values.native_import=!1,h.values.sync_enabled=!1,h.values.fire_updatePeriod=0,h.values.scriptUpdateCheckPeriod=0,h.values.sync_type=0,h.values.statistics_enabled=!1)},Ka=function(){na(h.values.logLevel);e.setLocale(h.values.i18n);R.setPath(h.values.native_import_path);h.values.statistics_enabled&&(X.init(),
window.onerror=function(a,c,d){X.tE(a,chrome.extension.manifest.version+" "+c,d)});L.init();t.listeners.add.onReset(function(a,c){G.clearByTabId(a);q.notifyClientListeners(null,a);c||J.setIcon(a)});var a=function(a){J.setIcon(a);J.setBadge(a)};t.listeners.add.onCommited(a);t.listeners.add.onCompleted(a);h.values.sync_enabled&&h.values.sync_type&&(l.enable(),l.scheduleSync(1E3,!0),l.schedulePeriodicalCheck());h.values.fire_enabled&&I.init();ba.init();x.addInfoChangedListener(function(a){ka&&ka.setWebRequest(a)});
x.init("auto"!=h.values.webrequest_modHeaders,"no"!=h.values.webrequest_modHeaders)},B=Registry.get("uri");uris=B;var V,da,ka,ha,Z,K,e,fa;init=function(){F.init();x.preInit();chrome.tabs.onUpdated.addListener(ya);chrome.tabs.onRemoved.addListener(Ja);chrome.extension.onMessage.addListener(ia.handler);chrome.extension.onConnect.addListener(va);chrome.extension.onConnectExternal.addListener(function(a){a.disconnect()});Ia.init(function(){x.finalize();l.finalize()});V=Registry.get("convert");e=Registry.get("i18n");
ka=Registry.get("xmlhttprequest");da=ka.run;ha=Registry.get("compat",p);Z=Registry.get("parser");K=Registry.get("syncinfo");fa=Registry.get("test");chrome.browserAction.setIcon({path:chrome.extension.getURL("images/icon_grey.png")});chrome.browserAction.setPopup({popup:"action.html"});chrome.browserAction.setTitle({title:"Tampermonkey"});q.init().then(function(){return Ba()}).then(function(){return h.init()}).then(function(){cfgo=h;sa();Ka();Ea();J.setIcon();window.setTimeout(Y.check,1E4);ja.wait();
D&&console.debug("Listeners registered!");window.setTimeout(F.setReady,1);if(fa&&Registry.isDevVersion("test")){var a=fa.framework.prepare(v.doSave);a&&console.error(a)}})};init()}})();
