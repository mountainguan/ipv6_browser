window.requestFileSystem||(window.requestFileSystem=window.webkitRequestFileSystem);
Registry.require("layout xmlhttprequest crcrc curtain layout/default/tabview layout/default/htmlutil helper statistics convert i18n syncinfo uri layout/default/layout_helper".split(" "),function(){var oa=Registry.prepare(),p=Registry.get("crcrc").cr,k=Registry.get("crcrc").crc,ea=Registry.get("layout/default/tabview"),l=Registry.get("layout/default/htmlutil"),fa=Registry.get("statistics"),ga=Registry.get("convert"),ha=Registry.get("syncinfo"),z=Registry.get("curtain"),e=Registry.get("i18n"),x=Registry.get("helper"),
pa=Registry.get("uri"),V=Registry.get("layout"),W=Registry.get("layout/default/layout_helper"),R=W.images,ia=$.Deferred;V.render(function(){W.addStyle();W.addFont();var S=!1,s={},D=[],X="0.0.0",J={},ja={},K=[],u={},H=function(a,b){if(u[a]&&u[a][b])return u[a][b].apply(this,Array.prototype.slice.call(arguments,2));console.log("option: WARN: unable to find callback '"+b+"' for id '"+a+"'")},N,ka=function(){N=x.getUrlArgs(!0)};window.onhashchange=ka;ka();(function(){D.push(function(){s.statistics_enabled&&
(fa.init(oa.SELF.ID),window.onerror=function(a,b,c){fa.tE(a,X+" "+b,c)})})})();var la=function(){for(;D.length;){var a=D[0];D=D.slice(1);a()}},V=function(a){var b=p("input",a.name,a.id,"Save");b.inserted||(b.type="button",b.section=a,b.value=e.getMessage("Save"),b.addEventListener("click",function(){var a=Array.prototype.slice.call(this.section.getElementsByTagName("textarea")),b=function(b){b.each(function(b,d){a.push(d)})};b($("#"+this.section.id).find("input"));b($("#"+this.section.id).find("select"));
for(b=0;b<a.length;b++){var f=null,g=a[b],e=g.key;if("textarea"==g.tagName.toLowerCase())if(g.array)for(var g=g.value.split("\n"),f=[],h=0;h<g.length;h++)g[h]&&""!=g[h].trim()&&f.push(g[h]);else f=g.value;else"checkbox"==g.getAttribute("type")?f=g.checked:"select"==g.getAttribute("type")?(f=0,0<=g.selectedIndex&&g.selectedIndex<g.options.length&&(f=g.selectedIndex),f=g[f]?g[f].value:g.options[0].value):"button"!=g.getAttribute("type")&&(f=g.value);e&&Y(e,f)}},!1));return b},ra=function(a){var b,c,
d,f,g,q;d=[];var h=[];f=p("tbody",a.name,a.id,"body");g=p("tfoot",a.name,a.id,"foot");q=p("thead",a.name,a.id,"head");if(a.scriptTab){var m=qa(a);b=k("table","scripttable",a.name,a.id,"main");c=k("th","",a.name,a.id,"thead_sel");c.appendChild(m.selAll);var t=k("td","",a.name,a.id,"tfoot_sel"),n=k("th","",a.name,a.id,"thead_en"),l=k("td","",a.name,a.id,"tfoot_en");l.setAttribute("colspan","9");l.appendChild(m.actionBox);m=k("th","settingsth",a.name,a.id,"thead_name");m.textContent=e.getMessage("Name");
var B=k("th","settingsth",a.name,a.id,"thead_ver");B.textContent=e.getMessage("Version");var v=k("th","settingsth",a.name,a.id,"thead_type");v.textContent=e.getMessage("Type");var w=k("th","settingsth",a.name,a.id,"thead_sync");w.textContent="";var L=k("th","settingsth",a.name,a.id,"thead_sites");L.width="25%";L.textContent=e.getMessage("Sites");var r=k("th","settingsth",a.name,a.id,"thead_features");r.textContent=e.getMessage("Features");var y=k("th","settingsth",a.name,a.id,"thead_edit");y.textContent=
e.getMessage("Homepage");var ma=k("th","settingsth",a.name,a.id,"thead_updated");ma.textContent=e.getMessage("Last_Updated");var C=k("th","settingsth",a.name,a.id,"thead_sort");C.textContent=e.getMessage("Sort");var A=k("th","settingsth",a.name,a.id,"thead_del");A.textContent=e.getMessage("Actions");D.push(function(){s.sync_enabled&&(w.textContent=e.getMessage("Imported"))});d=d.concat([c,n,m,B,v,w,L,r,y,ma,C,A]);c=k("tr","settingstr filler",a.name,a.id,"filler");for(n=0;n<d.length;n++)c.appendChild(d[n]);
h=h.concat([t,l]);d=k("tr","settingstr filler",a.name,a.id,"footer");for(n=0;n<h.length;n++)d.appendChild(h[n]);a=k("td","settingstd filler",a.name,a.id,"filler_td"+a.id);c.appendChild(a);q.appendChild(c);g.appendChild(d)}else b=k("table","settingstable",a.name,a.id,"main"),c=k("tr","settingstr filler",a.name,a.id,"filler"),f.appendChild(c);b.appendChild(q);b.appendChild(f);b.appendChild(g);return{table:b,head:q,body:f,foot:g}},va=function(a,b,c,d){var f=[],g=function(){[0,1].forEach(function(){f.unshift(null)})};
if(b.divider)return null;b.image&&(b.imageURL=R.get(b.image));if(b.checkbox){var e=function(){enableScript(this.key,this.checked)};d=function(){var a=!0;this.warning&&(a=Z(this.warning),a||(this.checked=!this.checked));a&&(Y(this.key,this.checked,this.reload),this.reload&&window.location.reload())};c&&c.need_save&&(d=e=null);var h=l.createCheckbox(b.name,b,b.option?d:e);f.push(h.elem)}else if(b.button)h=l.createButton(b.name,b,function(){var a=!0;this.warning&&(a=Z(this.warning));a&&sa(this.key,!0,
this.ignore,this.reload)}),f.push(h);else if(b.input)h=l.createTextarea(b.name,b),f.push(h.elem),c&&(c.need_save=!0);else if(b.text)h=l.createInput(b.name,b),f.push(h.elem),c&&(c.need_save=!0);else if(b.password)h=l.createPassword(b.name,b),f.push(h.elem),c&&(c.need_save=!0);else if(b.select)e=function(){var a=!0;this.warning&&(a=Z(this.warning),a||(this.value=this.oldvalue));a&&(Y(this.key,this.value,this.reload),this.reload&&window.location.reload())},c&&c.need_save&&(e=null,b.enabler&&(e=function(){var a=
document.getElementsByName("enabled_by_"+this.key),b=(this.selectedIndex<this.options.length?this.options[this.selectedIndex]:this.options[0]).getAttribute("enables"),c=b?JSON.parse(b):{};x.each(a,function(a){void 0===c[a.key]||1==c[a.key]?a.setAttribute("style",x.staticVars.visible):a.setAttribute("style",x.staticVars.invisible)})})),h=l.createDropDown(b.name,b,b.select,e),f.push(h.elem),a&&b.enabler&&function(){var a=e,b=h;D.push(function(){a.apply(b.select,[])})}();else if(b.url)d=p("a",b.name,
b.id),d.href="#",d.url=b.url,d.newtab=b.newtab,d.inserted||(e=function(){aa(this.url,this.newtab)},d.addEventListener("click",e)),d.textContent=b.name,f.push(d),g();else if(b.main_menu_item)g=p("span",b.name,b.id),g.textContent=b.name,c=ra(b),current_elem=p("div",b.name,b.id,"tab_content"),current_elem.appendChild(c.table),g=d.appendTab(b.id,g,current_elem),!S&&b.selected_default&&g.select(),T(c.body,b.items,null,d);else if(b.sub_menu_item){c=k("div","section",b.name,b.id);var g=k("div","section_head",
b.name,b.id,"head"),m=k("table","section_content",b.name,b.id,"content");g.textContent=b.name;b.desc&&(g.title=b.desc);c.appendChild(g);c.appendChild(m);T(m,b.items,b,d);b.need_save&&m.appendChild(V(m));f.push(c)}else if(b.userscript||b.nativeScript||b.user_agent){if(a.setAttribute("class","scripttr"),b.nnew&&a.setAttribute("style","display: none;"),f=ta(b,a,d),b.userscript||b.user_agent)K[b.uuid]={sort:{dom:a,pos:b.position},script:b}}else b.version?(X=b.value,k("div","version","version","version").textContent=
"v"+X+" by Jan Biniok"):b.globalhint?(d=k("span","global_hint","globalhint","globalhint"),g=p("span","globalhintt","globalhintt"),c=p("span","globalhintt","globalhintt"),c.textContent=b.value,b.description&&(c.title=b.description),c.url=b.info_url,b.image&&g.appendChild(l.createImage(b.imageURL,"globalhint","icon")),b.info_url&&!c.inserted&&(e=function(){aa(this.url,!0)},c.addEventListener("click",e)),g.appendChild(c),d.appendChild(g),document.body.appendChild(d)):(d=p("span","",b.uuid||b.id+b.name),
d.textContent=b.name,f.push(d),g());f.forEach(function(a){if(a){a.setAttribute("style",b.level>s.configMode?x.staticVars.invisible:x.staticVars.visible);if(b.hint){var c=p("span","",b.uuid||b.id+b.name,"hint");c.textContent=b.hint;a.appendChild(c)}b.validation&&ua(b,a);b.width&&a.setAttribute("class","width-172-"+b.width)}});a&&(m=a.getAttribute("class"),g=" hide",!1===b.visible?m=(m||"")+g:m&&(m=m.replace(g,"")),a.setAttribute("class",m));return f},T=function(a,b,c,d){for(var f in b){var g=b[f],
e=a?p("tr","",g.uuid||g.id+g.name,"pi"):null,h=va(e,g,c,d);h&&h.length&&(a.appendChild(e),x.each(h,function(a,b){var c=p("td","",g.uuid||g.id+g.name,b);a&&c.appendChild(a);e.appendChild(c)}))}},Z=function(a){if(a.once){if(ja[a.msg])return!0;ja[a.msg]=!0}var b=confirm(a.msg),c={};b&&a.ok?c=a.ok:!b&&a.cancel&&(c=a.cancel);if(a.ok||a.cancel)b=!0;c.url&&sendMessage({method:"openInTab",url:c.url},function(a){});return b},ua=function(a,b){var c;a.validation&&(a.validation.url&&(c=function(){aa(this.url,
!0)}),a.validation.image&&(a.validation.imageURL=R.get(a.validation.image)));if(c=l.createValidation(a,c))c.url=a.validation?a.validation.url:void 0,b.appendChild(c)},xa=function(a){var b={name:"utils",id:"utils"},c=p("div",b.name,b.id,"tab_util_h");c.textContent=e.getMessage("Utilities");var d=p("div",b.name,b.id,"tab_util");a.appendTab("util_tab"+b.id,c,d).show();a=k("div","tv_util",b.name,b.id,"tab_util_cont");var f=function(){var a={created_by:"Tampermonkey",version:"1",scripts:[]},c;for(c in K){var d=
K[c].script;if((d.userscript||b.user_agent)&&d.id&&!d.system){var g={name:d.name,options:d.options,enabled:d.enabled,position:d.position};d.file_url&&""!=d.file_url.trim()&&(g.file_url=d.file_url);d.code&&""!=d.code.trim()?(g.source=ga.Base64.encode(ga.UTF8.encode(d.code)),a.scripts.push(g)):console.log("options: Strange script: "+d.name)}}return JSON.stringify(a)},g=function(a){if(""!=a.trim()){var b=null;try{b=JSON.parse(a)}catch(c){if(-1!=a.search("<body>")){var b=a.indexOf("<body>"),d=a.lastIndexOf("</body>");
-1!=b&&-1!=d&&(a=a.substr(b+6,d-(b+6)),g(a))}else x.alert(e.getMessage("Unable_to_parse_this_"));return}wa(b,{reload:!0}).done(function(a){a.err&&x.alert(a.err)})}},q=function(a){var b="";switch(a.code){case FileError.QUOTA_EXCEEDED_ERR:b="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:b="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:b="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:b="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:b="INVALID_STATE_ERR";break;
default:b="Unknown Error"}x.alert("Error: "+b)},h=l.createButton(b.name,b.id+"_i_ta",e.getMessage("Import_from_Textarea"),function(){g(B.value)}),m=l.createButton(b.name,b.id+"_i_ls",e.getMessage("Import_from_SandboxFS"),function(){window.requestFileSystem(window.PERSISTENT,1048576,function(a){a.root.getFile("scripts.tmx",{},function(a){a.file(function(a){var b=new FileReader;b.onloadend=function(a){g(this.result)};b.readAsText(a)},q)},q)},q)}),c=p("input",b.name,b.id+"_i_file","file"),t=function(a){a=
a.target.files;for(var b=[],c=function(){g(b.pop())},d=0,f;f=a[d];d++){var e=new FileReader;e.onload=function(a){return function(a){b.push(a.target.result);window.setTimeout(c,10)}}(f);e.readAsText(f)}};c.inserted||(c.type="file",c.addEventListener("change",t,!1));var n=l.createButton(b.name,b.id+"_e_ta",e.getMessage("Export_to_Textarea"),function(){B.value=f()}),t=l.createButton(b.name,b.id+"_e_doc",e.getMessage("Export_to_file"),function(){var a=f(),a=new Blob([a],{type:"text/plain"});saveAs(a,
"tmScripts.txt")}),F=l.createButton(b.name,b.id+"_e_ls",e.getMessage("Export_to_SandboxFS"),function(){var a=f();window.requestFileSystem(window.PERSISTENT,1048576,function(b){b.root.getFile("scripts.tmx",{create:!0},function(b){b.createWriter(function(b){b.onwriteend=function(a){console.log("Write completed.")};b.onerror=function(a){console.log("Write failed: "+a.toString())};var c=new Blob([a],{type:"text/plain"});b.write(c)},q)},q)},q)}),B=k("textarea","importta",b.name,b.id,"ta"),v=k("div","section",
b.name,b.id,"ta"),w=k("div","section_head",b.name,b.id,"head_ta"),L=k("div","section_content",b.name,b.id,"content_ta");w.textContent=e.getMessage("TextArea");L.appendChild(n);L.appendChild(h);L.appendChild(B);v.appendChild(w);v.appendChild(L);h=k("div","section",b.name,b.id,"sb");n=k("div","section_head",b.name,b.id,"head_sb");w=k("div","section_content",b.name,b.id,"content_sb");n.textContent=e.getMessage("SandboxFS");h.appendChild(n);h.appendChild(w);w.appendChild(F);w.appendChild(m);m=k("div",
"section",b.name,b.id,"fi");F=k("div","section_head",b.name,b.id,"head_fi");n=k("div","section_content",b.name,b.id,"content_fi");F.textContent=e.getMessage("File");m.appendChild(F);m.appendChild(n);n.appendChild(t);n.appendChild(c);a.appendChild(m);a.appendChild(h);a.appendChild(v);x.each([h,v],function(a){var b=a.getAttribute("class"),b=50>s.configMode?b+" hide":b.replace(" hide","");a.setAttribute("class",b)});d.appendChild(a)},I=function(a,b,c){var d=b.item,f=d.uuid+b.id,g=(c?"orig_":"use_")+
b.id,q=function(a){return"select_"+x.createUniqueId(a,d.uuid)+"_sel1"},h=k("div","cludes",a,f,"cb1");if(document.getElementById(q(g)))return{elem:h};var m=p("span",d.name,f,"cb2");if(c){var t="merge_"+b.id;a=l.createCheckbox(a,{id:t,uuid:d.uuid,enabled:d.options&&d.options.override&&d.options.override[t]?!0:!1},function(){"checkbox"==this.type&&M(this.uuid,this.key,!this.oldvalue)});m.appendChild(a.elem)}else m.textContent=a;h.title=d.desc?d.desc:"";a=d.options&&d.options.override&&d.options.override[g]?
d.options.override[g]:[];var n=k("select","cludes",g,d.uuid,"sel1");n.setAttribute("size","6");n.setAttribute("multiple","true");for(g=0;g<a.length;g++)t=document.createElement("option"),t.value=t.text=a[g],n.appendChild(t);h.appendChild(m);h.appendChild(n);var F=function(a){var b=[];a=a&&a.options;for(var c=0,d=a.length;c<d;c++)a[c].selected&&b.push(a[c]);return b};a=function(){var a=q("use_"+("excludes"==b.id?"includes":"excludes")),c=document.getElementById(a),a=F(n),d=!1,g="matches"==b.id;a.forEach(function(a){var b=
g?"/"+pa.getRegExpFromMatch(a.value)+"/":a.value;a&&!c.querySelector('option[value="'+b+'"]')&&(a=a.cloneNode(!0),g&&(a.value=b,a.textContent=b),c.appendChild(a),d=!0)});d&&v()};var t=function(){var a=prompt(e.getMessage("Enter_the_new_rule"));if(a){var b=document.createElement("option");b.value=b.text=a.trim();n.appendChild(b);v()}},g=function(){var a=n.options[n.selectedIndex];if(a){var b=prompt(e.getMessage("Enter_the_new_rule"),a.value);b&&(a.value=a.text=b.trim(),v())}},m=function(){var a=!1;
F(n).forEach(function(b){b&&(b.parentNode.removeChild(b),a=!0)});a&&v()},B=function(a){for(var b=[],c=0;c<a.options.length;c++)b.push(a.options[c].value);return b},v=function(){var a={includes:B(document.getElementById(q("use_includes"))),matches:B(document.getElementById(q("use_matches"))),excludes:B(document.getElementById(q("use_excludes")))};ya(d.uuid,a);return!0};c?(f=p("button",d.name,f,"btn1"),f.innerHTML=e.getMessage("Add_as_0clude0",c),f.addEventListener("click",a,!1)):(c=p("button",d.name,
f,"btn2"),c.innerHTML=e.getMessage("Add")+"...",c.addEventListener("click",t,!1),h.appendChild(c),c=p("button",d.name,f,"btn3"),c.innerHTML=e.getMessage("Edit")+"...",c.addEventListener("click",g,!1),h.appendChild(c),f=p("button",d.name,f,"btn4"),f.innerHTML=e.getMessage("Remove"),f.addEventListener("click",m,!1));h.appendChild(f);return{elem:h}},za=function(){var a=function(b,c){return b.tagName==c?b:b.parentNode?a(b.parentNode,c):null},b=null,c=[],d=0,f;for(f in K){var g=K[f].sort;delete K[f].sort;
if(g){var e=a(g.dom,"TR");if(e){var h=a(e,"TBODY");b?h&&b!=h&&console.warn("options: different parents?!?!"):b=h;d++;c.push({tr:e,position:g.pos?g.pos:1E3+d});e.inserted=!1;e.parentNode&&e.parentNode.removeChild(e)}else console.log("options: unable to sort script at pos "+g.pos)}else console.warn("options: something went wrong!",f)}c=function(a){a.sort(function(a,b){return a.position-b.position});return a}(c);for(f=0;f<d;f++)b.appendChild(c[f].tr)},Ca=function(a,b,c,d,f){var g=k("div","",b.name,b.uuid,
"script_tab_head");c=g.inserted;var e=k("div","heading",b.name,"heading"),h=k("img","nameNicon64",b.name,"heading_icon"),m=b.icon64?b.icon64:b.icon;h.src=m;var t=k("div","nameNname64",b.name,"heading_name");t.textContent=b.name;m&&e.appendChild(h);e.appendChild(t);h=k("div","author",b.name,"author");b.author?h.textContent="by "+b.author:b.copyright&&(h.innerHTML="&copy; ",h.textContent+=b.copyright);var m=k("table","noborder p100100",b.name,"table"),t=k("tr","script_tab_head",b.name,"tr1"),n=k("tr",
"details",b.name,"tr2"),l=k("td","",b.name,"td1"),p=k("td","",b.name,"td2");e.appendChild(h);g.appendChild(e);l.appendChild(g);t.appendChild(l);n.appendChild(p);m.appendChild(t);m.appendChild(n);d.appendChild(m);d=ea.create("_details"+x.createUniqueId(b.name,b.uuid),p,{tv:"tv tv_alt",tv_table:"tv_table tv_table_alt",tr_tabs:"tr_tabs tr_tabs_alt",tr_content:"tr_content tr_content_alt",td_content:"td_content td_content_alt",td_tabs:"td_tabs td_tabs_alt",tv_tabs_align:"tv_tabs_align tv_tabs_align_alt",
tv_tabs_fill:"tv_tabs_fill tv_tabs_fill_alt",tv_tabs_table:"tv_tabs_table tv_tabs_table_alt",tv_contents:"tv_contents tv_contents_alt",tv_tab_selected:"tv_tab tv_selected tv_tab_alt tv_selected_alt",tv_tab_close:"",tv_tab:"tv_tab tv_tab_alt",tv_content:"tv_content tv_content_alt"});var v=Aa(b,d,f),w=b.nnew||b.system?{}:Ba(b,d);if(c)return J["tab"+b.uuid];var u=function(b){var c=!1;if("keydown"==b.type&&(27==b.keyCode&&"windows"==s.editor_keyMap&&(a.isSelected()&&window.setTimeout(f,1),c=!0),c))return b.stopPropagation(),
b.preventDefault(),!1};d={onShow:function(){if(w.onShow)w.onShow();if(v.onShow)v.onShow();window.addEventListener("keydown",u,!0)},onClose:function(a){if(w.onClose&&w.onClose(a)||v.onClose&&v.onClose(a))return!0;window.removeEventListener("keydown",u,!0)},onSelect:function(){if(w.onSelect&&w.onSelect()||v.onClose&&v.onSelect())return!0},beforeClose:function(a){var c=!1;w.beforeClose&&(c|=w.beforeClose(a));v.beforeClose&&(c|=v.beforeClose(a));return c&&!b.nnew}};return J["tab"+b.uuid]=d},Ba=function(a,
b){var c=p("div",a.name,a.uuid,"script_setting_h"),d=c.inserted;c.textContent=e.getMessage("Settings");var f=p("div",a.name,a.uuid,"script_settings_c"),g=function(){if("checkbox"==this.type||"button"==this.type)M(this.uuid,this.key,!this.oldvalue);else if("text"==this.type||"textarea"==this.type||"select-one"==this.type){var a=this.value;if("native"===this.valtype)if("undefined"===a)a=void 0;else if("null"===a)a=null;else try{a=JSON.parse(a)}catch(b){}M(this.uuid,this.key,a)}},q=l.createPosition(e.getMessage("Position_")+
": ",{id:"position",uuid:a.uuid,name:a.name,pos:a.position,posof:a.positionof},g),h=l.createDropDown(e.getMessage("Run_at"),{id:"run_at",uuid:a.uuid,name:a.name,value:a.run_at},[{name:"document-start",value:"document-start"},{name:"document-body",value:"document-body"},{name:"document-end",value:"document-end"},{name:e.getMessage("Default"),value:null}],g),m=l.createDropDown(e.getMessage("No_frames"),{id:"noframes",uuid:a.uuid,name:a.name,value:a.noframes},[{name:e.getMessage("Yes"),value:!0},{name:e.getMessage("No"),
value:!1},{name:e.getMessage("Default"),value:null}],g),t=I(e.getMessage("Original_includes"),{id:"includes",item:a},e.getMessage("User_excludes")),n=I(e.getMessage("Original_matches"),{id:"matches",item:a},e.getMessage("User_excludes")),s=I(e.getMessage("Original_excludes"),{id:"excludes",item:a},e.getMessage("User_includes")),B=k("div","clear",a.name,a.uuid,"clear"),v=I(e.getMessage("User_includes"),{id:"includes",item:a}),w=I(e.getMessage("User_matches"),{id:"matches",item:a}),u=I(e.getMessage("User_excludes"),
{id:"excludes",item:a}),r=l.createCheckbox(e.getMessage("Apply_compatibility_options_to_required_script_too"),{id:"compatopts_for_requires",uuid:a.uuid,name:a.name,enabled:a.compatopts_for_requires},g),y=l.createCheckbox(e.getMessage("Fix_wrappedJSObject_property_access"),{id:"compat_wrappedjsobject",uuid:a.uuid,name:a.name,enabled:a.compat_wrappedjsobject},g),x=l.createCheckbox(e.getMessage("Convert_CDATA_sections_into_a_chrome_compatible_format"),{id:"compat_metadata",uuid:a.uuid,name:a.name,enabled:a.compat_metadata},
g),C=l.createCheckbox(e.getMessage("Replace_for_each_statements"),{id:"compat_foreach",uuid:a.uuid,name:a.name,enabled:a.compat_foreach},g),A=l.createCheckbox(e.getMessage("Fix_for_var_in_statements"),{id:"compat_forvarin",uuid:a.uuid,name:a.name,enabled:a.compat_forvarin},g),z=l.createCheckbox(e.getMessage("Convert_Array_Assignements"),{id:"compat_arrayleft",uuid:a.uuid,name:a.name,enabled:a.compat_arrayleft},g),G=l.createCheckbox(e.getMessage("Add_toSource_function_to_Object_Prototype"),{id:"compat_prototypes",
uuid:a.uuid,name:a.name,enabled:a.compat_prototypes},g),r=[r,y,x,C,A,z,G],y=k("div","section",a.name,a.uuid,"ta_opt"),C=k("div","section_head",a.name,a.uuid,"head_ta_opt"),x=k("div","section_content",a.name,a.uuid,"content_ta_opt");C.textContent=e.getMessage("Settings");y.appendChild(C);y.appendChild(x);C=k("div","section",a.name,a.uuid,"ta_cludes");A=k("div","section_head",a.name,a.uuid,"head_ta_cludes");G=k("div","section_content",a.name,a.uuid,"content_ta_cludes");A.textContent=e.getMessage("Includes_Excludes");
C.appendChild(A);C.appendChild(G);var A=k("div","section",a.name,a.uuid,"ta_compat"),na=k("div","section_head",a.name,a.uuid,"head_ta_compat"),z=k("div","section_content",a.name,a.uuid,"content_ta_compat");na.textContent=e.getMessage("GM_compat_options_");A.appendChild(na);A.appendChild(z);x.appendChild(q);a.user_agent||x.appendChild(h.elem);x.appendChild(m.elem);G.appendChild(t.elem);G.appendChild(n.elem);G.appendChild(s.elem);G.appendChild(B);G.appendChild(v.elem);G.appendChild(w.elem);G.appendChild(u.elem);
p("span",a.name,a.uuid).textContent=e.getMessage("Settings");q=p("div",a.name,a.uuid,"tab_content_settings");q.appendChild(y);q.appendChild(C);if(!a.user_agent){for(h=0;h<r.length;h++)z.appendChild(r[h].elem);if(a.awareOfChrome)for(var O in r)r[O].input.setAttribute("disabled","disabled"),r[O].elem.setAttribute("title",e.getMessage("This_script_runs_in_Chrome_mode"));q.appendChild(A)}var ba=l.createTextarea(null,{name:a.name,uuid:a.uuid,id:"comment",value:a.options.comment});ba.elem.setAttribute("class",
"script_setting_wrapper");O=p("div",a.name,a.uuid,"save");h=l.createButton(a.name,a.id,e.getMessage("Save"),function(){g.apply(ba.textarea,[])});O.appendChild(h);h=k("div","section",a.name,a.uuid,"ta_comment");m=k("div","section_head",a.name,a.uuid,"head_ta_comment");B=k("div","section_content",a.name,a.uuid,"content_ta_comment");m.textContent=e.getMessage("Comment");h.appendChild(m);h.appendChild(B);B.appendChild(ba.elem);B.appendChild(O);q.appendChild(h);f.appendChild(q);b.appendTab("script_settings_tab"+
a.uuid,c,f);if(d)return J["settings"+a.uuid];c={beforeClose:function(){var a=!1;t.beforeClose&&(a|=t.beforeClose());n.beforeClose&&(a|=n.beforeClose());s.beforeClose&&(a|=s.beforeClose());v.beforeClose&&(a|=v.beforeClose());w.beforeClose&&(a|=w.beforeClose());u.beforeClose&&(a|=u.beforeClose());return a}};return J["settings"+a.uuid]=c},Aa=function(a,b,c){var d=k("tr","editor_container p100100",a.name,a.uuid,"container");if(!a.nnew&&H(a.uuid,"lastI"))return[];a.nnew&&(a.code=a.code.replace("<$URL$>",
N.url||"http://*/*"));var f=p("div",a.name,a.uuid,"script_editor_h"),g=f.inserted;f.textContent=e.getMessage("Editor");var q=p("div",a.name,a.uuid,"script_editor_c"),h=k("tr","editormenubar",a.name,a.uuid,"container_menu"),m=k("table","editor_container_o p100100 noborder",a.name,a.uuid,"container_o");m.appendChild(h);m.appendChild(d);q.appendChild(m);var t=function(b){H(a.uuid,"saveEm")},n=function(a,b){c&&c(b)},m=l.createImageButton(a.uuid,"save_to_disk",e.getMessage("Save_to_disk"),chrome.extension.getURL("/layout/default/images/harddrive2.png"),
function(b){b=d.editor&&s.editor_enabled?d.editor.mirror.getValue():y.value;b=new Blob([b],{type:"text/plain"});saveAs(b,a.name+".tamper.js")}),F=l.createImageButton(a.uuid,"save",e.getMessage("Save"),chrome.extension.getURL("/layout/default/images/filesave.png"),t),B=l.createImageButton(a.uuid,"cancel",e.getMessage("Editor_reset"),chrome.extension.getURL("/layout/default/images/editor_cancel.png"),function(){confirm(e.getMessage("Really_reset_all_changes_"))&&(d.editor&&s.editor_enabled?d.editor.mirror.setValue(a.code):
y.textContent=a.code)}),v=l.createImageButton(a.uuid,"reset",e.getMessage("Full_reset"),chrome.extension.getURL("/layout/default/images/script_cancel.png"),function(){ca(a.uuid,null,{old_url:r.input?r.input.oldvalue:"",new_url:r.input?r.input.value:"",clean:!0,reload:!0}).done(function(a){a.cleaned&&n(null,!0)});u[a.uuid].fullReset()}),w=l.createImageButton(a.uuid,"close_script",e.getMessage("Close"),chrome.extension.getURL("/layout/default/images/exit.png"),n),x=l.createImageButton(a.uuid,"lint_script",
e.getMessage("Run_syntax_check"),chrome.extension.getURL("/layout/default/images/check.png"),function(){z.wait();window.setTimeout(function(){P.run(d.editor);z.hide()},1)}),r=l.createInput(e.getMessage("Update_URL_"),{id:"file_url",name:a.name,value:a.file_url});r.input.setAttribute("class","updateurl_input");r.elem.setAttribute("class","updateurl");var y=k("textarea","editorta",a.name,a.uuid);y.setAttribute("wrap","off");var D=k("td","editor_outer",a.name,a.uuid,"edit"),C=k("div","editor_100 editor_border",
a.name,a.uuid,"edit"),A=k("div","editormenu",a.name,a.uuid,"editormenu");D.appendChild(C);h.appendChild(A);h.appendChild(r.elem);d.inserted||(C.appendChild(y),d.appendChild(D));a.system||(u[a.uuid].saveEm=function(){var b=!0;s.showFixedSrc&&!a.user_agent&&(b=confirm(e.getMessage("Do_you_really_want_to_store_fixed_code_",e.getMessage("Show_fixed_source"))));var c=d.editor&&s.editor_enabled?d.editor.mirror.getValue():y.value;b&&ca(a.uuid,c,{old_url:r.input?r.input.oldvalue:"",new_url:r.input?r.input.value:
"",clean:!1,new_script:a.nnew,reload:!0,lastModified:u[a.uuid].saveEm_lastModified}).done(function(b){b.installed&&(a.nnew||b.renamed?n(null,!0):(d.editor.changed=!1,b.lastModified&&(a.lastModified=b.lastModified)))});return b},A.appendChild(m),A.appendChild(F),A.appendChild(B));a.nnew||A.appendChild(v);A.appendChild(w);!a.system&&s.editor_enabled&&A.appendChild(x);b.appendTab("script_editor_tab"+a.uuid,f,q);if(g)return J["editor"+a.uuid];var E=function(){var b=!1;s.editor_enabled?d.editor&&(b|=d.editor.changed&&
d.editor.mirror.historySize().undo):b=y.value!=a.code;return b},G=function(){s.editor_autoSave&&E()&&H(a.uuid,"saveEm")};b={onSelect:function(){d.editor&&d.editor.mirror.refresh()},onShow:function(){var b=q.getElementsByTagName("textarea");u[a.uuid].lastI=function(){return a};if(b.length&&(b=b[0],!d.editor)){var c=function(){d.editor&&(d.editor.changed=!0)};if(s.editor_enabled){var g=b.parentNode,f={search:e.getMessage("Search"),replace:e.getMessage("Replace"),jump:e.getMessage("Jump_to_line"),macro:e.getMessage("Insert_constructor"),
reindentall:e.getMessage("Auto_Indent_all")};g.removeChild(b);d.editor=new MirrorFrame(g,{value:a.code,indentUnit:Number(s.editor_indentUnit),indentWithTabs:"tabs"==s.editor_indentWithTabs,smartIndent:"classic"!=s.editor_tabMode,enterMode:s.editor_enterMode,electricChars:"true"==s.editor_electricChars.toString(),lineNumbers:!0,extraKeys:{Enter:"newlineAndIndentContinueComment"},keyMap:s.editor_keyMap,gutters:["gutter","CodeMirror-linenumbers"],matchBrackets:!0},{save:t,close:n,find:function(a){d.editor.searchText=
d.editor.search()},findNext:function(a){d.editor.searchText=d.editor.search(d.editor.searchText)},findPrev:function(a){d.editor.searchText=d.editor.search(d.editor.searchText,!0)}},{change:c,blur:G},f)}else b.value=a.code}},onClose:function(b){var c=function(){d.editor=null;delete u[a.uuid].lastI};if(E()&&!b)return(b=confirm(e.getMessage("There_are_unsaved_changed_")))&&c(),!b;c();return!1}};return J["editor"+a.uuid]=b},ta=function(a,b,c){u[a.uuid]||(u[a.uuid]={});var d,f,g=a.icon&&!a.nativeScript,
q=["script_name"];a.nativeScript||q.push("clickable");a.blacklisted&&q.push("crossedout");var h=k("span",q.join(" "),"",a.uuid,"sname"),m=k("img","nameNicon16 icon16","",a.uuid,"sname_img"),t=k("span",g?"nameNname16":"","",a.uuid,"sname_name"),n=a.homepage?a.homepage:a.namespace&&0==a.namespace.search("http://")?a.namespace:null;t.textContent=35<a.name.length?a.name.substr(0,35)+"...":a.name;q=p("span","",a.uuid,"sversion");q.textContent=a.version?a.version:"";g&&(m.src=a.icon,h.appendChild(m));var g=
[],F=function(){d&&(d.remove(),d=null);delete J["tab"+a.uuid];delete J["settings"+a.uuid];delete J["editor"+a.uuid]},B=function(){window.setTimeout(function(){for(var d in K){var g=K[d].script;if(g.uuid==a.uuid){T(b,[g],null,c);break}}la()},1)},v=function(b){a.uuid&&x.getUrlArgs(!0).open==a.uuid&&(window.location.hash="");var c=!0;if(f&&(f.beforeClose&&(c=!f.beforeClose(b)),f.onClose&&f.onClose(b)))return;F();h.parentNode&&h.parentNode.removeChild(h);!b&&c&&B()},w=function(){f&&f.onSelect&&f.onSelect()},
z=function(g,h){if(!d){var m=null;a.nnew?(m=k("div","head_icon","",a.uuid,"details_h"),m.appendChild(l.createImage(a.imageURL,"",a.uuid,"new_script_head"))):m=k("div","","",a.uuid,"details_h");var q=p("div","",a.uuid,"details_c");d=c.insertTab(null,"details_"+a.uuid,m,q,w,a.nnew?null:v);a.nnew||d.setHeading(e.getMessage("Edit")+" - "+(25<a.name.length?a.name.substr(0,25)+"...":a.name));f=Ca(d,a,b,q,v)}if(f&&f.onShow)f.onShow();d.show();g&&1==g.button||h||d.select();t.setAttribute("open","true");!a.nnew&&
a.uuid&&(window.location.hash="open="+a.uuid)};"true"==t.getAttribute("open")&&z(null,!0);m=p("span","",a.uuid,"hp");if(n){var r=p("a","",a.uuid,"hp");r.setAttribute("href",n);r.setAttribute("target","_blank");n=l.createImage(chrome.extension.getURL("/layout/default/images/home.png"),"",a.uuid,"hp","");r.appendChild(n);m.appendChild(r)}var n=function(a,b){var c=a.getTime(),d=b.getTime(),g=Math.abs(c-d),c=Math.round(g/6E4),d=Math.round(g/36E5),g=Math.round(g/864E5);return 60>=c?c+" min":48>=d?d+" h":
g+" d"},y=p("span","",a.uuid,"last_updated"),r="";if(a.nativeScript||a.nnew||a.system)r="";else if(t.inserted||(y.addEventListener("click",function(){H(a.uuid,"scriptUpdate")}),y.setAttribute("class","clickable"),y.title=e.getMessage("Check_for_Updates")),u[a.uuid].scriptUpdate=function(){var b=y.textContent;y.textContent="";y.appendChild(l.createImage("/layout/default/images/download.gif","down",a.uuid));Da(a.uuid,function(c){y.textContent=b;c?(y.style.color="green",y.title=e.getMessage("There_is_an_update_for_0name0_avaiable_",
a.name),F(),h.parentNode&&h.parentNode.removeChild(h),M(null,!1)):(y.style.color="red",y.title=e.getMessage("No_update_found__sry_"))})},a.lastUpdated)try{r=n(new Date,new Date(a.lastUpdated))}catch(E){console.log("o: error calculating time "+E.message)}else r="?";y.textContent=r;var C=p("div","",a.uuid,"imported"),A="";D.push(function(){s.sync_enabled&&(A=a.nativeScript||a.nnew||a.system?"":a.sync&&a.sync.imported?!0===a.sync.imported||a.sync.imported==ha.types.ePASTEBIN?'<img src="http://pastebin.com/favicon.ico" class="icon16" title="pastebin.com"/>':
a.sync.imported==ha.types.eCHROMESYNC?'<img src="http://www.google.com/images/icons/product/chrome-16.png" class="icon16" title="Google Sync"/>':'<img src="/layout/default/images/update.png" class="icon16" />':'<img src="/layout/default/images/no.png" class="icon16" />',C.innerHTML=A,C=null)});a.origin&&(r=p("a","",a.uuid,"hp"),r.setAttribute("href",a.origin.url),r.setAttribute("target","_blank"),n=l.createImage(R.origin(a.origin.token),"",a.uuid,a.origin.token,""),r.appendChild(n),m.appendChild(r));
u[a.uuid].saveEm_lastModified=a.lastModified;u[a.uuid].fullReset=function(){b.parentNode.removeChild(b)};u[a.uuid].reportAnIssue=function(){Ea(a.uuid)};u[a.uuid].deleteScript=function(c,d){if(a.nativeScript){var g=d||confirm(e.getMessage("Really_delete_0name0__",a.name));!0==g&&(da(a.uuid,"installed","false"),b.parentNode.removeChild(b))}else g=d||confirm(e.getMessage("Really_delete_0name0__",a.name)),!0==g&&(ca(a.uuid,null,{reload:!d}),b.parentNode.removeChild(b))};n=[];if(a.nativeScript){u[a.uuid].importNativeScript=
function(c,d){!0==(d||confirm(e.getMessage("Really_import_0name0__",a.name)))&&(da(a.uuid,"imported","true"),b.parentNode.removeChild(b))};var I=l.createImage(chrome.extension.getURL("/layout/default/images/import.png"),"",a.uuid,"import",e.getMessage("Import"),function(){H(a.uuid,"importNativeScript")});l.addClass(I,"hidden");n.push(I);D.push(function(){s.native_import&&l.toggleClass(I,"hidden")})}a.nnew||a.system||(r=l.createImage(chrome.extension.getURL("/layout/default/images/delete.png"),"",
a.uuid,"delete",e.getMessage("Delete"),function(){H(a.uuid,"deleteScript")}),n.push(r));a.nnew||a.system||!a.origin||(r=l.createImage(chrome.extension.getURL("/layout/default/images/flag.png"),"",a.uuid,"issue",e.getMessage("Report_this_as_spam_or_malicious"),function(){H(a.uuid,"reportAnIssue")}),n.push(r));h.inserted||a.nativeScript||h.addEventListener("click",z);h.appendChild(t);r=[a.name];a.description&&r.push(a.description);a.blacklisted&&(r=[e.getMessage("This_script_is_blacklisted_")]);h.title=
r.join("\n\n").replace(/\"/,"");g.push(a.nnew||a.system?null:Fa(a));g.push(function(){var b=a.blacklisted?"enabler_warning":a.enabled?"enabler_enabled":"enabler_disabled",c=a.blacklisted?e.getMessage("This_script_is_blacklisted_"):a.enabled?e.getMessage("Enabled"):e.getMessage("Disabled"),d=a.position,b=l.createEnabler(b,a.uuid,"enabled","enabled",c,function(){H(a.uuid,a.nativeScript?"switchNativeEnabled":"switchEnabled")},a.nativeScript?"":d);u[a.uuid].switchEnabled=function(b,c,d){void 0===c&&(c=
!a.enabled);M(a.uuid,"enabled",c,d)};u[a.uuid].switchNativeEnabled=function(b,c,d){void 0===c&&(c=!a.enabled);da(a.uuid,"enabled",c,d)};return b}());g.push(h);g.push(q);g.push(Ga(a));g.push(C);g.push(Ha(a));g.push(Ia(a));g.push(m);g.push(y);g.push(Ja(a));g.push(function(a,b){var c=p("span","",a.uuid,"wrap");b&&("Array"===x.toType(b)?x.each(b,function(a,b){c.appendChild(a)}):c.appendChild(b));return c}(a,n));for(q=g.length;10>q;q++)g.push(null);a.nnew&&D.push(function(){z(null,!0)});!S&&N.open&&a.uuid===
N.open&&D.push(z);return g},Ga=function(a){var b=p("span","",a.uuid,"pos_type",!0);if(a.nnew)return b;a.user_agent?(a=l.createImage("images/user_agent.png","",a.uuid,"user_agent",e.getMessage("This_only_changes_the_user_agent_string")),b.appendChild(a)):a.nativeScript?(a=l.createImage(a.icon,"",a.uuid,"chrome_ext",e.getMessage("This_is_a_chrome_extension")),b.appendChild(a)):a.userscript&&(a=l.createImage("images/txt.png","",a.uuid,"user_agent",e.getMessage("This_is_a_userscript")),b.appendChild(a));
return b},Ia=function(a){var b=p("span","",a.uuid,"pos_features",!0);if(a.nnew)return b;if(a.system){var c=l.createImage(chrome.extension.getURL("/layout/default/images/lock.png"),"",a.uuid,"lock",e.getMessage("This_is_a_system_script"));b.appendChild(c)}if(a.awareOfChrome||a.nativeScript)c=l.createImage("http://www.google.com/images/icons/product/chrome-16.png","",a.uuid,"chrome_mode",e.getMessage("This_script_runs_in_Chrome_mode")),b.appendChild(c);if(a.nativeScript)return b;var c=!1,d={includes:!0,
matches:!0},f;for(f in d)if(a[f]){for(d=0;d<a[f].length;d++)if(a[f][d]&&(-1!=a[f][d].search("https")||-1!=a[f][d].search(/^\*:\/\//))){c=l.createImage(chrome.extension.getURL("/layout/default/images/halfencrypted.png"),"",a.uuid,"encrypt",e.getMessage("This_script_has_access_to_https_pages"));b.appendChild(c);c=!0;break}if(c)break}if(a.user_agent)return b;-1!=a.code.search("GM_xmlhttpRequest")&&(c=l.createImage(chrome.extension.getURL("/layout/default/images/web.png"),"",a.uuid,"web",e.getMessage("This_script_has_full_web_access")),
b.appendChild(c));-1!=a.code.search("GM_setValue")&&(c=l.createImage(chrome.extension.getURL("/layout/default/images/db.png"),"",a.uuid,"db",e.getMessage("This_script_stores_data")),b.appendChild(c));-1!=a.code.search("unsafeWindow")&&(c=l.createImage(chrome.extension.getURL("/layout/default/images/resources.png"),"",a.uuid,"resource",e.getMessage("This_script_has_access_to_webpage_scripts")),b.appendChild(c));for(f in a.options)if(-1!=f.search("compat_")&&a.options[f]){c=l.createImage(chrome.extension.getURL("/layout/default/images/critical.png"),
"",a.uuid,"crit",e.getMessage("One_or_more_compatibility_options_are_set"));b.appendChild(c);break}return b},Ka=function(){var a=null,b=null,c=null,d=0,f=0,g=function(b){var d=c.x+b.pageX;a.style.top=c.y+b.pageY+"px";a.style.left=d+"px"},e=function(c){if(a){var e=null;for(g(c);e!=f;){var e=f,k=b.previousSibling,q=b.nextSibling,l=b.parentNode,p=h(b);c.pageY>p.y+d&&q?(l.removeChild(q),l.insertBefore(q,b),f++):c.pageY<p.y&&1<f&&(l.removeChild(k),q?l.insertBefore(k,q):l.appendChild(k),f--)}}},h=function(a){for(var b=
a.offsetLeft,c=a.offsetTop;a=a.offsetParent;)b+=a.offsetLeft,c+=a.offsetTop;return{x:b,y:c}};return self={start:function(){document.addEventListener("mousemove",e);document.addEventListener("scroll",e)},stop:function(){document.removeEventListener("mousemove",e);document.removeEventListener("scroll",e)},handleEvent:function(e,k){a?(a.style.position="static",M(a.uuid,a.key,f),a=b=c=null,self.stop()):(self.start(),a=this,b=a.parentNode.parentNode.parentNode,d=b.offsetHeight,c=h(b.parentNode.parentNode),
c.x=-c.x-a.offsetWidth/2,c.y=-c.y-a.offsetHeight/2,a.style.position="absolute",g(e),f=k)}}}(),Ja=function(a){var b=p("span","",a.uuid,"pos_images",!0);if(a.nnew||a.nativeScript)return b;if(1<a.position||a.position<a.positionof){var c=k("span","clickable movable","position",a.uuid,!0);c.innerHTML="&#9776;";c.title=e.getMessage("Click_here_to_move_this_script");c.uuid=a.uuid;c.key="position";c.addEventListener("click",function(b){Ka.handleEvent.apply(this,[b,a.position])});b.appendChild(c)}return b},
Ha=function(a){var b=p("span","",a.uuid,"site_images"),c=null;b.inserted&&(c=b,c.setAttribute("id",c.id+"foo"),b=p("span","",a.uuid,"site_images"));if(a.includes||a.matches)for(var d=0,f=a.includes.length?a.includes:a.matches,g={},e=0;e<f.length;e++){var h=f[e];if(h){if(7<d){a=k("span","",a.uuid,"tbc");a.textContent="...";b.appendChild(a,!0);break}var m=l.getInfoFromUrl(h);if(null==m)h=l.createFavicon("?","",a.uuid,h,h),b.appendChild(h,!0),d++;else{if("*"==m.tld){h=l.createImage(chrome.extension.getURL("/layout/default/images/web.png"),
"",a.uuid,h,h);b.appendChild(h,!0);break}if(!g[m.dom]){var t="com",n="";"*"!=m.tld&&"tld"!=m.tld&&(t=m.tld);m.subdom.length&&(n=m.subdom.join(".")+".");var s=("chrome://favicon/http://"+n+m.dom+"."+t+"/").replace(/\*/g,""),t=("http://"+n+m.dom+"."+t+"/favicon.ico").replace(/\*/g,""),s=[t,s];if(0==t.search("http://userscripts.org/")||0==t.search("http://userscripts.com/"))s=R.origin("uso");h=l.createFavicon(s,"",a.uuid,h,h);b.appendChild(h,!0);g[m.dom]=!0;d++}}}else console.log("o: Warn: script '"+
a.name+"' has invalid include (index: "+e+")")}c&&c.parentNode.removeChild(c);return b},Fa=function(a){var b=p("input","",a.uuid,"sel");b.type="checkbox";b.s_id=a.uuid;b.name="scriptselectors";b.s_type=a.nativeScript?"n":"s";b.inserted||b.addEventListener("click",function(){u.multiselect.single_click()});return b},qa=function(a){var b=p("input","sms","all",null,!0);b.type="checkbox";b.mode=0;b.addEventListener("click",u.multiselect.un_selectAll);var c=0,d=[{name:e.getMessage("__Please_choose__"),
value:0},{name:e.getMessage("Enable"),value:1},{name:e.getMessage("Disable"),value:2},{name:e.getMessage("Trigger_Update"),value:5},{name:e.getMessage("Remove"),value:6}],d=l.createDropDown(e.getMessage("Apply_this_action_to_the_selected_scripts"),{value:0,uuid:"sms-select",name:"select"},d,function(){0==this.value?f.setAttribute("disabled","true"):f.removeAttribute("disabled");c=this.value});d.elem.setAttribute("class","float");var f=l.createButton("MultiSelectButton","button",e.getMessage("Start"),
function(){if(0==c)console.log("option: ?!?!");else if(6!=c||confirm(e.getMessage("Really_delete_the_selected_items_"))){for(var a=document.getElementsByName("scriptselectors"),b=[],d=0;d<a.length;d++)b.push(a[d]);for(var f=!1,k=100,d=0;d<b.length;d++)b[d].checked&&(1==c||2==c?(a="n"==b[d].s_type?"switchNativeEnabled":"switchEnabled",H(b[d].s_id,a,null,1==c,!1),f=!0):5==c?(a="scriptUpdate",H(b[d].s_id,a)):6==c&&(a="deleteScript",H(b[d].s_id,a,null,!0),f=!0,k=1500));f&&(z.wait(e.getMessage("Please_wait___")),
window.setTimeout(function(){M(null,!1,null,!0)},k))}});f.setAttribute("class","action_button");f.setAttribute("disabled","true");a=p("div",a.name,a.id,"actions");a.appendChild(d.elem);a.appendChild(f);return{selAll:b,actionBox:a}};(function(){var a=0;u.multiselect={};u.multiselect.single_click=function(){for(var b=0,c=document.getElementsByName("scriptselectors"),d=!0,f=!1,g=!1,e=!0,h=!1,k=!1,l=0;l<c.length;l++)"n"==c[l].s_type?(g=!0,d=d&&c[l].checked,f=f||c[l].checked):"s"==c[l].s_type&&(k=!0,e=
e&&c[l].checked,h=h||c[l].checked);g?d&&!h?b=1:e&&!f&&h&&(b=2):k&&e&&(b=3);b!=a&&(a=b,p("input","sms","all").checked=0!=b)};u.multiselect.un_selectAll=function(){3<++a&&(a=0);for(var b=!1,c=document.getElementsByName("scriptselectors"),d=0;d<c.length;d++)0!=d||1!=a&&3!=a||"s"!=c[d].s_type||3<++a&&(a=0),b|="s"==c[d].s_type,c[d].checked=3==a||1==a&&"n"==c[d].s_type||2==a&&"s"==c[d].s_type;1<a&&!b&&(a=0);this.checked=0!=a}})();var P={options:{maxerr:999,newcap:!0,es5:!0,sloppy:!0,browser:!0,white:!0,
plusplus:!0,nomen:!0,"continue":!0,todo:!0,eqeq:!0,passfail:!1,unparam:!0,devel:!0},JSLINT_GLOBALS:"CDATA XPathResult xpath uneval escape unescape console JSON TM_info GM_info TM_addStyle TM_deleteValue TM_listValues TM_getValue TM_log TM_registerMenuCommand TM_unregisterMenuCommand TM_openInTab TM_setValue TM_addValueChangeListener TM_removeValueChangeListener TM_xmlhttpRequest TM_getTab TM_setTab TM_saveTab TM_getTabs TM_runNative TM_execUnsafe TM_notification TM_getResourceText TM_getResourceURL GM_addStyle GM_deleteValue GM_listValues GM_getValue GM_log GM_registerMenuCommand GM_unregisterMenuCommand GM_openInTab GM_setValue GM_addValueChangeListener GM_removeValueChangeListener GM_xmlhttpRequest GM_getTab GM_setTab GM_saveTab GM_getTabs GM_setClipboard GM_notification GM_getResourceText GM_getResourceURL".split(" "),
cleanGutters:function(a,b){a.clearGutter("gutter")},setGutters:function(a,b){for(var c in b)if(b.hasOwnProperty(c)){var d=b[c],f=0,g=null,k=[];d.marks=[];for(var h=0;h<d.length;h++){var m="",l=d[h];l.stop?(g="no",f=3):l.warn?(1>f&&(g="critical",f=1),m=e.getMessage("Warning")+": "):l.info?(0==f&&(g="info"),m=e.getMessage("Info")+": "):2>f&&(g="error",f=2,m=e.getMessage("Error")+": ");k.push((1<d.length?m:"")+l.text.replace(/\"/g,'\\"'));l.stop||d.marks.push(a.markText({line:l.line-1,ch:l.character-
1},{line:l.line-1,ch:l.character-1+l.evle},{className:"CodeMirror-highlight-"+g}))}d='<span class="editor_gutter" title="'+k.join("\n\n")+'"><span width="15px"><img class="editor_gutter_img" src="/layout/default/images/'+g+'.png"/></span></span>';f=document.createElement("span");f.innerHTML=d;a.setGutterMarker(Number(c)-1,"gutter",f)}return b},run:function(a){a.oldGutters&&P.cleanGutters(a.mirror,a.oldGutters);var b=a.mirror.getValue(),c=null;try{c=JSLINT}catch(d){}var f="/*global "+P.JSLINT_GLOBALS.join(": true, ")+
"*/\n";if(c&&!c(f+b,P.options)){var b={},g;for(g in JSLINT.errors)if((f=JSLINT.errors[g])&&1<f.line){var c=f.line-1,e=f.character,h=0,k=-1!=f.reason.search("Mixed spaces and tabs"),l=0;try{var n=!!f.evidence&&!k;if(n)for(var p=0,u=0;p<e&&u<e;p++,u++)9==f.evidence.charCodeAt(p)&&(u+=s.editor_indentUnit-1,h+=1);e-=h*(s.editor_indentUnit-1);if(n||k)var v=f.evidence.length>e?f.evidence.substr(e-1):"",w=k?v.match(/([ \t])*/):v.match(/([a-zA-Z0-9_])*/),l=w&&w.length?w[0].length:0}catch(x){console.log("jslint: error parsing source "+
x.message)}h=l||1;f={line:c,stop:0==f.reason.search("Stopping"),info:k||-1!=f.reason.search("Combine this with the previous 'var'")||-1!=f.reason.search("Expected '{' and instead saw")||-1!=f.reason.search("Move 'var' declarations to the top"),warn:"(error)"!=f.id||-1!=f.reason.search("used before it was defined"),character:e,evle:h,text:f.reason.replace(/.$/,"")};f.stop&&c++;b[c]||(b[c]=[]);b[c].push(f)}a.oldGutters=P.setGutters(a.mirror,b)}}},Q=null,U=null,E=function(a){null!=Q?(window.clearTimeout(Q),
Q=null,E(a?a:U.items)):(U={items:a},Q=window.setTimeout(function(){Q=null;K=[];var a=U.items;if(a){var c=document.getElementById("options"),d=k("div","main_container p100100","options","main");if(c){var e=c.parentNode;e.removeChild(c);e.appendChild(d);document.body.setAttribute("class","main")}var c=k("div","head_container","opt","head_container"),e=k("div","tv_container","opt","tv_container"),g=p("a","head_link","fire","head_link");g.href="http://tampermonkey.net";g.target="_blank";var l=k("div",
"float margin4","fire","head1"),h=k("img","banner","fire");h.src=chrome.extension.getURL("images/icon128.png");var m=k("div","float head margin4","fire","head2"),t=p("div","fire"),n=k("div","version","version","version");n.textContent=" by Jan Biniok";var s=p("div","search","box","");t.textContent="Tampermonkey";l.appendChild(h);m.appendChild(t);m.appendChild(n);g.appendChild(l);g.appendChild(m);c.appendChild(g);c.appendChild(s);d.appendChild(c);d.appendChild(e);d=ea.create("_main",e);T(null,a,null,
d);za();D.push(u.multiselect.single_click);xa(d);N.selected&&!S&&(a=d.getTabById(N.selected))&&a.select();S=!0;z.hide();la()}else console.log("options: items is empty!");U=null},50))},aa=function(a,b){try{var c=function(c){chrome.tabs.sendMessage(c.id,{method:"loadUrl",url:a,newtab:b},function(a){})};b?sendMessage({method:"openInTab",url:a},function(a){}):chrome.tabs.getSelected(null,c)}catch(d){console.log("lU: "+d.message)}},wa=function(a,b,c){var d=ia();try{sendMessage({method:"importFromJson",
json:a,reload:b.reload},function(a){z.hide();a.items&&E(a.items);b.reload&&z.hide();a.err?d.reject(a):d.resolve(a)}),z.wait(e.getMessage("Please_wait___"))}catch(f){console.log("sS: "+f.message),d.reject({err:f.message})}return d.promise()},ca=function(a,b,c){var d=ia();void 0===c.reload&&(c.reload=!0);try{sendMessage({method:"saveScript",uuid:a,code:b,clean:c.clean,force:c.force,new_script:c.new_script,force_url:c.new_url&&c.new_url!=c.old_url?c.new_url:"",lastModified:c.lastModified,reload:c.reload},
function(a){a.items&&E(a.items);!b&&c.reload&&z.hide();d.resolve(a)}),z.wait(e.getMessage("Please_wait___"))}catch(f){console.log("sS: "+f.message),d.reject({err:f.message})}return d.promise()},Y=function(a,b,c){try{sendMessage({method:"setOption",name:a,value:b},function(a){s=a.options||s;c||E(a.items)}),z.wait(e.getMessage("Please_wait___"))}catch(d){console.log("sO: "+d.message)}},sa=function(a,b,c,d){try{sendMessage({method:"buttonPress",name:a},function(a){d?window.location.reload():c?z.hide():
E(a.items)}),z.wait(e.getMessage("Please_wait___"))}catch(f){console.log("sO: "+f.message)}},ya=function(a,b,c){void 0==c&&(c=!0);try{a={method:"modifyScriptOptions",uuid:a,reload:c};for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);sendMessage(a,function(a){s=a.options||s;a.items&&E(a.items)});z.wait(e.getMessage("Please_wait___"))}catch(f){console.log("mSo: "+f.message)}},M=function(a,b,c,d){void 0===d&&(d=!0);try{a={method:"modifyScriptOptions",uuid:a,reload:d},b&&""!=b&&(a[b]=c),sendMessage(a,function(a){s=
a.options||s;a.i18n&&e.setLocale(a.i18n);a.items&&E(a.items)}),z.wait(e.getMessage("Please_wait___"))}catch(f){console.log("mSo: "+f.message)}},da=function(a,b,c,d){void 0===d&&(d=!0);try{sendMessage({method:"modifyNativeScript",nid:a,actionid:b,value:c,reload:d},function(a){a.items&&E(a.items)}),z.wait(e.getMessage("Please_wait___"))}catch(f){console.log("mSo: "+f.message)}},Da=function(a,b){try{sendMessage({method:"buttonPress",name:"run_script_updates",scriptuid:a},function(a){b&&b(a.updatable)})}catch(c){console.log("rSu: "+
c.message)}},Ea=function(a,b){try{sendMessage({method:"reportAnIssue",uuid:a},function(a){b&&b()})}catch(c){console.log("rRi: "+c.message)}};chrome.extension.onMessage.addListener(function(a,b,c){if("updateOptions"==a.method)s=a.options||s,E(a.items),c({});else if("confirm"==a.method)x.confirm(a.msg,function(a){c({confirm:a})});else if("showMsg"==a.method)x.alert(a.msg),c({});else return!1;return!0});sendMessage({method:"modifyScriptOptions"},function(a){s=a.options||s;a.i18n&&e.setLocale(a.i18n);
a.items&&E(a.items)})})});
